
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/hooks/">Hooks</a></span><span class="is-current-page">comment_text</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>comment_text</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="hook-func">apply_filters</span>( ‘comment_text’,  <nobr><span class="arg-type">string</span> <span class="arg-name">$comment_text</span></nobr>,  <nobr><span class="arg-type">WP_Comment|null</span> <span class="arg-name">$comment</span></nobr>,  <nobr><span class="arg-type">array</span> <span class="arg-name">$args</span></nobr> )</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Filters the text of a comment to be displayed.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <h3 class="is-toc-heading has-heading-5-font-size" id="see-also" tabindex="-1"><a href="#see-also">See also</a></h3><ul><li><a href="https://developer.notmatt.press/reference/classes/Walker_Comment/comment">Walker_Comment::comment()</a></li>
</ul></section>
<section class="wp-block-wporg-code-reference-parameters"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="parameters" tabindex="-1"><a href="#parameters">Parameters</a></h2> <dl><dt><code>$comment_text</code><span class="type"><span class="string">string</span></span></dt><dd><div class="desc"><span class="description">Text of the comment.</span></div></dd><dt><code>$comment</code><span class="type"><span class="WP_Comment"><a href="https://developer.notmatt.press/reference/classes/wp_comment/" rel="class">WP_Comment</a></span>|<span class="null">null</span></span></dt><dd><div class="desc"><span class="description">The comment object. Null if not found.</span></div></dd><dt><code>$args</code><span class="type"><span class="array">array</span></span></dt><dd><div class="desc"><span class="description">An array of arguments.</span></div></dd></dl></section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="1094"><code class="language-php line-numbers" id="wporg-source-code" lang="php">echo apply_filters( 'comment_text', $comment_text, $comment, $args );
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/comment-template.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/comment-template.php#L1094">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/comment-template.php#L1094-L1094">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-related" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="related" tabindex="-1"><a href="#related">Related</a></h2> <section class="wp-block-wporg-code-table" id="used-by" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Used by</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_comments_controller/prepare_item_for_response/">WP_REST_Comments_Controller::prepare_item_for_response()</a><code>wp-includes/rest-api/endpoints/class-wp-rest-comments-controller.php</code></td><td><p>Prepares a single comment output for response.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/functions/comment_text/">comment_text()</a><code>wp-includes/comment-template.php</code></td><td><p>Displays the text of the current comment.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/functions/check_comment/">check_comment()</a><code>wp-includes/comment.php</code></td><td><p>Checks whether a comment passes internal checks to be allowed to add.</p>
</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/1.2.0/">1.2.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-gblsm even thread-odd thread-alt depth-1" data-comment-id="1591" id="comment-1591">
<article class="comment-body" id="div-comment-1591">
<a class="screen-reader-text" href="#comment-content-1591">Skip to note 4 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-1591">
<p><a>#24913 (comment_text filter used differently in two places in core) – WordPress Trac</a></p>
<p>In the first (<code>/wp-includes/comment.php</code>), the <code>$comment</code> variable contains just the comment text. In the second (<code>/wp-includes/comment-template.php</code>), the <code>$comment</code> variable contains the actual comment object itself (based on the return of <code>get_comment( $comment_ID )</code>).<br/>
So the filters are filtering the same fields. The issue then becomes the number of parameters and that, too, is not a bug.<br/>
The first comment text filter is used specifically to filter the text of the comment before things like inserting it into the database. The second is used when filtering the text of the comment before displaying it on a page – this follows the pattern of not trusting data before inserting it in the DB and also not trusting the data when pulling it back out. Using the same filter here helps us use exactly the same rules to filter the content both pre and post DB.<br/>
If the problem is the number of fields, simply make the second parameter of your function optional:</p>
<pre class="wp-block-code"><code class="language-php" lang="php">function filter_text( $comment_text, $comment = null ) {
    // Do something to the comment, possibly switching based on the presence of $comment
}
add_filter( 'comment_text', 'filter_text', 10, 2 );</code></pre>
<p>If you only want to do things when the comment is inserted into the DB, just verify that <code>null === $comment</code> in the function above. If you only want to do things when comments are displayed, verify that <code>null !== $comment</code>.<br/>
IMO this isn’t a bug but a pretty powerful differentiating factor between a filter that can be used in different places to do either the same or different things.</p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-1591">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-wordpresssites odd alt thread-even depth-1" data-comment-id="2313" id="comment-2313">
<article class="comment-body" id="div-comment-2313">
<a class="screen-reader-text" href="#comment-content-2313">Skip to note 5 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-2313">
<p>Remove rel=”nofollow” from comment content text</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">add_filter( 'comment_text', 'remove_rel_nofollow_attribute' );
function remove_rel_nofollow_attribute( $comment_text ) {
	$comment_text = str_ireplace(' rel="nofollow"', '', $comment_text );
	return $comment_text;
}</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-2313">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-mgruson even thread-odd thread-alt depth-1" data-comment-id="2320" id="comment-2320">
<article class="comment-body" id="div-comment-2320">
<a class="screen-reader-text" href="#comment-content-2320">Skip to note 6 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-2320">
<p>Apparently this filter is not called in the “recent comments” widget of the activity (in the dashboard). Too bad (I’m trying to use this filter to obfuscate the content of selected comments, in case the user don’t have the rights to see the commented post).</p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="1" id="feedback-2320">
<ul class="children">
<li class="comment byuser comment-author-mediaformat odd alt depth-2" data-comment-id="6357" id="comment-6357">
<article class="comment-body" id="div-comment-6357">
<div class="wporg-has-embedded-code comment-content" id="comment-content-6357">
<div>To filter the comment content appearing in wp_dashboard_recent_comments (widget) you can use the <a href="https://developer.notmatt.press/reference/hooks/comment_excerpt/" rel="ugc">comment_excerpt</a> filter.</div>
<div><a class="url" href="https://profiles.wordpress.org/mediaformat/" rel="external nofollow">Django</a> <a class="comment-date" href="https://developer.notmatt.press/reference/hooks/comment_text/#comment-6357"><time datetime="2023-02-21T14:53:07+00:00">2 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
