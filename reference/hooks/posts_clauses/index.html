
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/hooks/">Hooks</a></span><span><a href="https://developer.wordpress.org/reference/classes/wp_query/get_posts/">WP_Query::get_posts</a></span><span class="is-current-page">posts_clauses</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>posts_clauses</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="hook-func">apply_filters_ref_array</span>( ‘posts_clauses’,  <nobr><span class="arg-type">string[]</span> <span class="arg-name">$clauses</span></nobr>,  <nobr><span class="arg-type">WP_Query</span> <span class="arg-name">$query</span></nobr> )</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Filters all query clauses at once, for convenience.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>Covers the WHERE, GROUP BY, JOIN, ORDER BY, DISTINCT, fields (SELECT), and LIMIT clauses.</p>
</section>
<section class="wp-block-wporg-code-reference-parameters"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="parameters" tabindex="-1"><a href="#parameters">Parameters</a></h2> <dl><dt><code>$clauses</code><span class="type"><span class="string[]">string[]</span></span></dt><dd><div class="desc"><span class="description">Associative array of the clauses for the query.<br/>
<ul class="param-hash"><li><code>where</code> <span class="type">string</span><div class="desc">The WHERE clause of the query.</div></li>
<li><code>groupby</code> <span class="type">string</span><div class="desc">The GROUP BY clause of the query.</div></li>
<li><code>join</code> <span class="type">string</span><div class="desc">The JOIN clause of the query.</div></li>
<li><code>orderby</code> <span class="type">string</span><div class="desc">The ORDER BY clause of the query.</div></li>
<li><code>distinct</code> <span class="type">string</span><div class="desc">The DISTINCT clause of the query.</div></li>
<li><code>fields</code> <span class="type">string</span><div class="desc">The SELECT clause of the query.</div></li>
<li><code>limits</code> <span class="type">string</span><div class="desc">The LIMIT clause of the query.</div></li>
</ul>
</span></div></dd><dt><code>$query</code><span class="type"><span class="WP_Query"><a href="https://developer.notmatt.press/reference/classes/wp_query/" rel="class">WP_Query</a></span></span></dt><dd><div class="desc"><span class="description">The <a href="https://developer.notmatt.press/reference/classes/wp_query/" rel="class">WP_Query</a> instance (passed by reference).</span></div></dd></dl></section>
<section class="wporg-has-embedded-code wp-block-wporg-code-reference-explanation"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="more-information" tabindex="-1"><a href="#more-information">More Information</a></h2>
<p>The <code>posts_clauses</code> filter runs before the query gets executed and is essentially the sum of all filters that run immediately before it. So it should be used if you don’t intend to let another plugin override it, or if you need to alter several different parts of the query at once. If you’re only modifying a particular clause, you should probably use one of these clause-specific filters:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">* posts_where_paged
* posts_groupby
* posts_join_paged
* posts_orderby
* posts_distinct
* post_limits
* posts_fields</code></pre>
<p>Note: If you’re working on a caching plugin, use the <a href="https://developer.notmatt.press/reference/hooks/posts_clauses_request/">posts_clauses_request</a> filter instead. It’s basically the same filter, but it runs later (and after <a href="https://developer.notmatt.press/reference/hooks/posts_selection/">posts_selection</a>), specifically so that “regular” plugins can execute their filters <em>before</em> your caching plugin does anything.</p>
</section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="2955"><code class="language-php line-numbers" id="wporg-source-code" lang="php">$clauses = (array) apply_filters_ref_array( 'posts_clauses', array( compact( $pieces ), &amp;$this ) );
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/class-wp-query.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/class-wp-query.php#L2955">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/class-wp-query.php#L2955-L2955">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-related" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="related" tabindex="-1"><a href="#related">Related</a></h2> <section class="wp-block-wporg-code-table" id="used-by" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Used by</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_query/get_posts/">WP_Query::get_posts()</a><code>wp-includes/class-wp-query.php</code></td><td><p>Retrieves an array of posts based on query variables.</p>
</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/3.1.0/">3.1.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-stevenlinx odd alt thread-odd thread-alt depth-1" data-comment-id="4529" id="comment-4529">
<article class="comment-body" id="div-comment-4529">
<a class="screen-reader-text" href="#comment-content-4529">Skip to note 2 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-4529">
<p>Example migrated from Codex:</p>
<p>In the following example, you can see how you can inspect the current query.</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">&lt;?php
/**
 * Alter different parts of the query
 * 
 * @param array $pieces
 * 
 * @return array $pieces
 */
function intercept_query_clauses( $pieces )
{
	echo '&lt;style&gt;#post-clauses-dump { display: block; background-color: #777; color: #fff; white-space: pre-line; }&lt;/style&gt;';
	// &gt;&gt;&gt;&gt; Inspect &amp; Debug the Query 
	// NEVER EVER show this to anyone other than an admin user - unless you're in your local installation
	if ( current_user_can( 'manage_options' ) )
	{
		$dump = var_export( $pieces, true );
		echo "&lt; PRE id='post-clauses-dump'&gt;{$dump}&lt;/ PRE &gt;";
	}

	return $pieces;
}
add_filter( 'posts_clauses', 'intercept_query_clauses', 20, 1 );</code></pre>
<p>If you need to alter anything, simply set the <code>$pieces['whatever_part']</code> string to what you need. Be sure to use appropriate <a href="https://developer.notmatt.press/reference/classes/wpdb/">$wpdb</a> properties and methods (e.g. <code>$wpdb-&gt;prefix, $wpdb-&gt;prepare()</code>) in your SQL to prevent injection attacks, handle table prefix variations, and so forth.</p>
<p>This would be the output on the Admin “All Posts” example.com/wp-admin/edit.php screen:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">array (
	'where' =&gt; ' AND wp_posts.post_type = \'post\' AND (wp_posts.post_status = \'publish\' OR wp_posts.post_status = \'future\' OR wp_posts.post_status = \'draft\' OR wp_posts.post_status = \'pending\' OR wp_posts.post_status = \'private\')',
	'groupby' =&gt; '',
	'join' =&gt; '',
	'orderby' =&gt; 'wp_posts.post_date DESC',
	'distinct' =&gt; '',
	'fields' =&gt; 'wp_posts.*',
	'limits' =&gt; 'LIMIT 0, 20',
)</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-4529">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
