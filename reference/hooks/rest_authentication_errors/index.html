
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/hooks/">Hooks</a></span><span><a href="https://developer.wordpress.org/reference/classes/wp_rest_server/check_authentication/">WP_REST_Server::check_authentication</a></span><span class="is-current-page">rest_authentication_errors</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>rest_authentication_errors</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="hook-func">apply_filters</span>( ‘rest_authentication_errors’,  <nobr><span class="arg-type">WP_Error|null|true</span> <span class="arg-name">$errors</span></nobr> )</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Filters REST API authentication errors.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>This is used to pass a <a href="https://developer.notmatt.press/reference/classes/wp_error/" rel="class">WP_Error</a> from an authentication method back to the API.</p>
<p>Authentication methods should check first if they’re being used, as multiple authentication methods can be enabled on a site (cookies, HTTP basic auth, OAuth). If the authentication method hooked in is not actually being attempted, null should be returned to indicate another authentication method should check instead. Similarly, callbacks should ensure the value is <code>null</code> before checking for errors.</p>
<p>A <a href="https://developer.notmatt.press/reference/classes/wp_error/" rel="class">WP_Error</a> instance can be returned if an error occurs, and this should match the format used by API methods internally (that is, the <code>status</code> data should be used). A callback can return <code>true</code> to indicate that the authentication method was used, and it succeeded.</p>
</section>
<section class="wp-block-wporg-code-reference-parameters"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="parameters" tabindex="-1"><a href="#parameters">Parameters</a></h2> <dl><dt><code>$errors</code><span class="type"><span class="WP_Error"><a href="https://developer.notmatt.press/reference/classes/wp_error/" rel="class">WP_Error</a></span>|<span class="null">null</span>|<span class="true">true</span></span></dt><dd><div class="desc"><span class="description"><a href="https://developer.notmatt.press/reference/classes/wp_error/" rel="class">WP_Error</a> if authentication error, null if authentication                                   method wasn’t used, true if authentication succeeded.</span></div></dd></dl></section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="197"><code class="language-php line-numbers" id="wporg-source-code" lang="php">return apply_filters( 'rest_authentication_errors', null );
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/rest-api/class-wp-rest-server.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/rest-api/class-wp-rest-server.php#L197">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/rest-api/class-wp-rest-server.php#L197-L197">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-related" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="related" tabindex="-1"><a href="#related">Related</a></h2> <section class="wp-block-wporg-code-table" id="used-by" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Used by</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_server/check_authentication/">WP_REST_Server::check_authentication()</a><code>wp-includes/rest-api/class-wp-rest-server.php</code></td><td><p>Checks the authentication headers if supplied.</p>
</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/4.4.0/">4.4.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-andrewmrobbins odd alt thread-odd thread-alt depth-1" data-comment-id="6463" id="comment-6463">
<article class="comment-body" id="div-comment-6463">
<a class="screen-reader-text" href="#comment-content-6463">Skip to note 2 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-6463">
<p>I needed to use this hook to fix a nonce expiration bug.</p>
<p>My plugin uses the WP REST API to fetch data on the front-end. A longstanding issue has been that other caching plugins could sometimes cache this nonce, throwing a 403 error for my users.</p>
<p>I used this solution: </p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">public function wpdocs_sanitize_nonce( $errors ) {

    // Bail if rest_route isn't defined (shouldn't happen!)
    if ( empty( $GLOBALS['wp']-&gt;query_vars['rest_route'] ) ) {
        return $errors;
    }

    $route = ltrim( $GLOBALS['wp']-&gt;query_vars['rest_route'], '/' );

    // Ensure we're dealing with our REST request only
    if ( strpos( $route, 'shopwp/v1' ) !== 0 ) {
        return $errors;
    }

    if ( ! empty( $_SERVER['HTTP_X_WP_NONCE'] ) ) {
        $nonce = $_SERVER['HTTP_X_WP_NONCE'];

        if ( ! wp_verify_nonce($nonce, 'wp_rest') ) {
            // Nonce check failed, so create a new one.
            $_SERVER['HTTP_X_WP_NONCE'] = wp_create_nonce( 'wp_rest' );
        }
    }

    return $errors;
}</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-6463">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
