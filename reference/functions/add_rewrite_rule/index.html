
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/functions/">Functions</a></span><span class="is-current-page">add_rewrite_rule()</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>add_rewrite_rule()</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;">add_rewrite_rule( <span class="arg-type">string</span> <span class="arg-name">$regex</span>,  <span class="arg-type">string|array</span> <span class="arg-name">$query</span>,  <span class="arg-type">string</span> <span class="arg-name">$after</span> = <span class="arg-default">'bottom'</span> )</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Adds a rewrite rule that transforms a URL structure to a set of query vars.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>Any value in the $after parameter that isn’t ‘bottom’ will result in the rule being placed at the top of the rewrite rules.</p>
</section>
<section class="wp-block-wporg-code-reference-parameters"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="parameters" tabindex="-1"><a href="#parameters">Parameters</a></h2> <dl><dt><code>$regex</code><span class="type"><span class="string">string</span></span><span class="required">required</span></dt><dd><div class="desc"><span class="description">Regular expression to match request against.</span></div></dd><dt><code>$query</code><span class="type"><span class="string">string</span>|<span class="array">array</span></span><span class="required">required</span></dt><dd><div class="desc"><span class="description">The corresponding query vars for this rewrite rule.</span></div></dd><dt><code>$after</code><span class="type"><span class="string">string</span></span><span class="required">optional</span></dt><dd><div class="desc"><span class="description">Priority of the new rule. Accepts <code>'top'</code>                            or <code>'bottom'</code>. Default <code>'bottom'</code>.</span></div><p class="default">Default:<code>'bottom'</code></p></dd></dl></section>
<section class="wporg-has-embedded-code wp-block-wporg-code-reference-explanation"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="more-information" tabindex="-1"><a href="#more-information">More Information</a></h2>
<p><a href="https://developer.notmatt.press/reference/functions/add_rewrite_rule/" rel="function">add_rewrite_rule()</a>  allows you to specify additional rewrite rules for WordPress. It is most commonly used in conjunction with <a href="https://developer.notmatt.press/reference/functions/add_rewrite_tag/" title="Rewrite API/add rewrite tag">add_rewrite_tag()</a> (which allows WordPress to recognize custom post/get variables).</p>
</section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="140"><code class="language-php line-numbers" id="wporg-source-code" lang="php">function add_rewrite_rule( $regex, $query, $after = 'bottom' ) {
	global $wp_rewrite;

	$wp_rewrite-&gt;add_rule( $regex, $query, $after );
}
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/rewrite.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/rewrite.php#L140">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/rewrite.php#L140-L144">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-related" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="related" tabindex="-1"><a href="#related">Related</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Uses</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rewrite/add_rule/">WP_Rewrite::add_rule()</a><code>wp-includes/class-wp-rewrite.php</code></td><td><p>Adds a rewrite rule that transforms a URL structure to a set of query vars.</p>
</td></tr></tbody></table></figure></section> <section class="wp-block-wporg-code-table" id="used-by" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Used by</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_sitemaps/register_rewrites/">WP_Sitemaps::register_rewrites()</a><code>wp-includes/sitemaps/class-wp-sitemaps.php</code></td><td><p>Registers sitemap rewrite tags and routing rules.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_post_type/add_rewrite_rules/">WP_Post_Type::add_rewrite_rules()</a><code>wp-includes/class-wp-post-type.php</code></td><td><p>Adds the necessary rewrite rules for the post type.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/functions/rest_api_register_rewrites/">rest_api_register_rewrites()</a><code>wp-includes/rest-api.php</code></td><td><p>Adds REST rewrite rules.</p>
</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/4.4.0/">4.4.0</a></td><td><span class="since-description">Array support was added to the <code>$query</code> parameter.</span></td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/since/2.1.0/">2.1.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-anthonyeden even thread-odd thread-alt depth-1" data-comment-id="3503" id="comment-3503">
<article class="comment-body" id="div-comment-3503">
<a class="screen-reader-text" href="#comment-content-3503">Skip to note 12 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-3503">
<p>Here is a simple example of how to register a new rewrite rule, and pass it off to a PHP file for rendering:</p>
<p>1. Setup a rule:</p>
<pre class="wp-block-code"><code class="language-php" lang="php">add_action( 'init',  function() {
    add_rewrite_rule( 'myparamname/([a-z0-9-]+)[/]?$', 'index.php?myparamname=$matches[1]', 'top' );
} );</code></pre>
<p>2. Flush permalinks. Go to WP Admin &gt; Settings &gt; Permalinks &gt; Save. This doesn’t happen automatically after you add this code</p>
<p>3. Whitelist the query param:</p>
<pre class="wp-block-code"><code class="language-php" lang="php">add_filter( 'query_vars', function( $query_vars ) {
    $query_vars[] = 'myparamname';
    return $query_vars;
} );</code></pre>
<p>4. Add a handler to send it off to a template file:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">add_filter( 'template_include', function( $template ) {
    if ( get_query_var( 'myparamname' ) == false || get_query_var( 'myparamname' ) == '' ) {
        return $template;
    }

    return get_template_directory() . '/template-name.php';
} );</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="2" id="feedback-3503">
<ul class="children">
<li class="comment byuser comment-author-signmein odd alt depth-2" data-comment-id="4006" id="comment-4006">
<article class="comment-body" id="div-comment-4006">
<div class="wporg-has-embedded-code comment-content" id="comment-content-4006">
<div>I added a modification for #4 to fix the 404 page issue. 
<pre class="wp-block-code"><code class="language-php" lang="php"></code></pre>
<p>add_action( ‘template_include’, function( $template ) {                  if ( get_query_var( ‘myparamname’ ) == false || get_query_var( ‘myparamname’ ) == ” ) {             return $template;         }          if ( <a href="https://developer.notmatt.press/reference/functions/is_404/" rel="function">is_404()</a>  ) {              status_header( 404 );             get_template_part( 404 ); exit();          }               return <a href="https://developer.notmatt.press/reference/functions/get_template_directory/" rel="function">get_template_directory()</a>  . ‘/template-name.php’;     } ); </p>
<pre class="wp-block-code"><code class="language-php" lang="php"></code></pre>
</div>
<div><a class="url" href="https://profiles.wordpress.org/signmein/" rel="external nofollow">signmein</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/add_rewrite_rule/#comment-4006"><time datetime="2020-06-24T10:03:19+00:00">5 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
<li class="comment byuser comment-author-elcondorito even depth-2" data-comment-id="5745" id="comment-5745">
<article class="comment-body" id="div-comment-5745">
<div class="wporg-has-embedded-code comment-content" id="comment-content-5745">
<div>When defining the RegExp (step 1), I had to change <code>index.php?myparamname=$matches[1]</code> to <code>index.php?myparamname=$1</code>, otherwise it was not working properly.</div>
<div><a class="url" href="https://profiles.wordpress.org/elcondorito/" rel="external nofollow">elcondorito</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/add_rewrite_rule/#comment-5745"><time datetime="2022-03-18T20:30:48+00:00">3 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-tomasdev odd alt thread-even depth-1" data-comment-id="2038" id="comment-2038">
<article class="comment-body" id="div-comment-2038">
<a class="screen-reader-text" href="#comment-content-2038">Skip to note 13 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-2038">
<p>Things that were in WP Codex site and did not get migrated for whatever reason.</p>
<p><strong>NOTE</strong>: When using $matches[] to retrieve the values of a matched URL, capture group data starts at 1, not 0.</p>
<p><strong>IMPORTANT</strong>: Do not forget to flush and regenerate the rewrite rules database after modifying rules. From WordPress Administration Screens, Select Settings -&gt; Permalinks and just click Save Changes without any changes.</p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="1" id="feedback-2038">
<ul class="children">
<li class="comment byuser comment-author-jbeninger even depth-2" data-comment-id="3336" id="comment-3336">
<article class="comment-body" id="div-comment-3336">
<div class="wporg-has-embedded-code comment-content" id="comment-content-3336">
<div>When adding multiple rules, note that (as of 4.9.8) rules are applied in the order added, <em>regardless of whether they’re at the top or the bottom</em>  E.g.: 
<pre class="wp-block-code"><code class="language-php" lang="php">add_rewrite_rule('^animals/(.*)', 'index.php?pagename=display-animal&amp;amp;animal=matches[1]', 'top'); add_rewrite_rule('^animals/mammals/(.*)', 'index.php?pagename=display-mammal&amp;amp;mammal-name=matches[1]', 'top');</code></pre>
<p>  The second rule will never match, because the first rule always matches before the second one is processed.</p></div>
<div><a class="url" href="https://profiles.wordpress.org/jbeninger/" rel="external nofollow">jbeninger</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/add_rewrite_rule/#comment-3336"><time datetime="2019-08-13T17:32:26+00:00">5 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-elhardoum odd alt thread-odd thread-alt depth-1" data-comment-id="1629" id="comment-1629">
<article class="comment-body" id="div-comment-1629">
<a class="screen-reader-text" href="#comment-content-1629">Skip to note 14 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-1629">
<p>A quick example: processing rules to make a subscribers page, hoping it helps.</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">add_action('init', function() {

	$page_id = 2; // update 2 (sample page) to your custom page ID where you can get the subscriber(s) data later
	$page_data = get_post( $page_id );

	if( ! is_object($page_data) ) { // post not there
		return;
	}

	add_rewrite_rule(
		$page_data-&gt;post_name . '/subscriber/([^/]+)/?$',
		'index.php?pagename=' . $page_data-&gt;post_name . '&amp;my_subscribers=1&amp;my_subscriber=$matches[1]',
		'top'
	);

});</code></pre>
<p>Now in your page template ( if you have one, or while filtering this custom page’s content ), you can get the displayed subscriber slug by calling <code>get_query_var('my_subscriber')</code>, but first, pass <code>'my_subscriber'</code> to the query variables:</p>
<pre class="wp-block-code"><code class="language-php" lang="php">add_filter('query_vars', function($vars) {
    $vars[] = "my_subscriber";
    return $vars;
});</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="1" id="feedback-1629">
<ul class="children">
<li class="comment byuser comment-author-okvee even depth-2" data-comment-id="6801" id="comment-6801">
<article class="comment-body" id="div-comment-6801">
<div class="wporg-has-embedded-code comment-content" id="comment-content-6801">
<div>I’ll leave feedback here because you use <code>-&gt;post_name</code> column. I recommend that anyone who will try to use the code above, make sure to wrap <code>post_name</code> with <code>rawurldecode()</code> inside <code>regex</code> argument. For example: <code>add_rewrite_rule(rawurldecode($page_data-&gt;post_name), 'bla', 'top');</code>.  In many case if your <code>post_name</code> or known as URL slug is in English using pattern without <code>rawurldecode()</code> works fine.   But whenever your <code>post_name</code> is in some other language like Thai, the character <strong>ค</strong> will be <strong>%E0%B8%84</strong> when user type from address bar but inside WordPress DB it is <strong>%e0%b8%84</strong>.  It is different case, yes! but that may lead you to 404 page while you are still confuse that all the characters you type is correct.  Wrap <code>post_name</code> with <code>rawurldecode()</code> will be fine and works well.</div>
<div><a class="url" href="https://profiles.wordpress.org/okvee/" rel="external nofollow">vee</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/add_rewrite_rule/#comment-6801"><time datetime="2023-12-02T16:00:42+00:00">1 year ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-atachibana odd alt thread-even depth-1" data-comment-id="4554" id="comment-4554">
<article class="comment-body" id="div-comment-4554">
<a class="screen-reader-text" href="#comment-content-4554">Skip to note 15 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-4554">
<p>(From Codex)<br/>
<strong>Using Custom Templates with custom querystring</strong></p>
<p>Let’s assume you are creating a “Nutrition” page for showing nutritional information. This page uses a custom template and takes two variables, food and variety. Create a file named my-custom-template.php in your themes root directory as following:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">/**
 * Template Name: Nutritional Information
 */
get_header(); 

global $wp_query;
echo 'Food : ' . $wp_query-&gt;query_vars['food'];
echo '&lt;br /&gt;';
echo 'Variety : ' . $wp_query-&gt;query_vars['variety'];
// ... more ...
get_footer();</code></pre>
<p>Using this template, create a page. In Add New of Pages screen, select “Nutritional Information” from Template dropdown box. You may leave blank for title or contents. Click Publish to publish the page. Write down the ID of created page from All Pages screen. Move a mouse cursor on the page title to show the link information in status bar of Web browser. You will see the ID after the POST= in URL. In this example, assume the ID is 12.</p>
<p>Use <a href="https://developer.notmatt.press/reference/functions/add_rewrite_tag/" rel="function">add_rewrite_tag()</a>  to make WordPress aware of custom querystring variables food and variety. Add the following code to the functions.php file,</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">function custom_rewrite_tag() {
  add_rewrite_tag('%food%', '([^&amp;]+)');
  add_rewrite_tag('%variety%', '([^&amp;]+)');
}
add_action('init', 'custom_rewrite_tag', 10, 0);</code></pre>
<p>You can call the page as following:<br/>
<a href="http://example.com/index.php?page_id=12&amp;food=milkshake&amp;variety=strawberry" rel="nofollow ugc">http://example.com/index.php?page_id=12&amp;food=milkshake&amp;variety=strawberry</a><br/>
The page will show two values passed by querystring variables.</p>
<p>Now, instead of passing ugly querystring variables to the page, you can set up a rewrite rule to create some custom pretty URLs. Add the following rule to the functions.php file and replace the page ID 12 by the ID that you investigated in above step. Don’t forget to click Save Changes in Permalinks Settings. (refer above IMPORTANT)</p>
<pre class="wp-block-code"><code class="language-php" lang="php">function custom_rewrite_rule() {
    add_rewrite_rule('^nutrition/([^/]*)/([^/]*)/?','index.php?page_id=12&amp;food=$matches[1]&amp;variety=$matches[2]','top');
}
add_action('init', 'custom_rewrite_rule', 10, 0);</code></pre>
<p>User can access the same page with following URL:<br/>
<a href="http://example.com/nutrition/milkshakes/strawberry/" rel="nofollow ugc">http://example.com/nutrition/milkshakes/strawberry/</a></p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-4554">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-iqbalbary even thread-odd thread-alt depth-1" data-comment-id="2465" id="comment-2465">
<article class="comment-body" id="div-comment-2465">
<a class="screen-reader-text" href="#comment-content-2465">Skip to note 16 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-2465">
<p>						Example to add rewrite rule query as optional,hope it helps.</p>
<pre class="wp-block-code"><code class="language-php" lang="php">function custom_rewrite_rule() {
	add_rewrite_rule('^nutrition/?([^/]*)/?','index.php?page_id=12&amp;food=$matches[1]','top');
}
add_action('init', 'custom_rewrite_rule', 10, 0);</code></pre>
<p>The main things here is to add <strong>?</strong> in the start of your regex. Like <code>?([^/]*)</code></p>
<p>Now, you can set default value for optional query where you will use the query. </p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">$food = $wp_query-&gt;get( 'food' );
if( isset($food) &amp;&amp; !empty($food) ) {
	$nutrition = $food;
}else{
	$nutrition = 'strawberry'; //default value
}</code></pre>
<p>Now you will get the same result for <code>http://example.com/nutrition/strawberry</code> or <code>http://example.com/nutrition/</code></p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="1" id="feedback-2465">
<ul class="children">
<li class="comment byuser comment-author-wtlwp odd alt depth-2" data-comment-id="4117" id="comment-4117">
<article class="comment-body" id="div-comment-4117">
<div class="wporg-has-embedded-code comment-content" id="comment-content-4117">
<div>I am very confused on why the /?([^/]*)/? is necessary.  If you can explain it, that will be great.  * means 0 or more, but if you change it to + (1 or more) it fails to match.  Why have the /? when the forward slash is necessary?  The ? means 1 or 0. I removed ? and it (url matching) failed.</div>
<div><a class="url" href="https://profiles.wordpress.org/wtlwp/" rel="external nofollow">wtlwp</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/add_rewrite_rule/#comment-4117"><time datetime="2020-08-07T15:39:05+00:00">5 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-atachibana even thread-even depth-1" data-comment-id="4555" id="comment-4555">
<article class="comment-body" id="div-comment-4555">
<a class="screen-reader-text" href="#comment-content-4555">Skip to note 17 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-4555">
<p>(From Codex)<br/>
<strong>Using rewrite rules to redirect to scripts other than index.php</strong></p>
<p>The $redirect argument works slightly differently when redirecting to a custom PHP script because WordPress delegates these redirects to .htaccess instead of processing them itself. For this reason, querystring variables should be written like $1 instead of $matches[1]. Given we’re redirecting to a custom PHP script, adding the same rewrite rule from our previous example would look like this:</p>
<pre class="wp-block-code"><code class="language-php" lang="php">function custom_rewrite_rule() {
    add_rewrite_rule('^nutrition/([^/]*)/([^/]*)/?','url/to/my/script.php?food=$1&amp;variety=$2','top');
}
add_action('init', 'custom_rewrite_rule', 10, 0);</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-4555">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-aminurislam01 odd alt thread-odd thread-alt depth-1" data-comment-id="4787" id="comment-4787">
<article class="comment-body" id="div-comment-4787">
<a class="screen-reader-text" href="#comment-content-4787">Skip to note 18 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-4787">
<p>Rewrite rules with optional parameters.</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">// siteurl.com/wpdocs-product-category/edit-product-category/43 for edit product category
add_rewrite_rule(
	'^wpdocs-product-category/([^/]*)/([^/]*)/?',
	'index.php?pagename=wpdocs-product-category&amp;wpdocs-pro-category-action=$matches[1]&amp;wpdocs-product-cat-id=$matches[2]',
	'top'
);

// Product Category Add Page
// siteurl.com/wpdocs-product-category/add-product-category for add product category
add_rewrite_rule(
	'^wpdocs-product-category/([^/]*)/?',
	'index.php?pagename=wpdocs-product-category&amp;wpdocs-pro-category-action=$matches[1]',
	'top'
);</code></pre>
<p>Filters the query variables allowed before processing.</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">add_filter( 'query_vars', function( $vars ) {
	$vars[] = 'wpdocs-pro-category-action';
	$vars[] = 'wpdocs-product-cat-id';
	$vars[] = 'wpdocs-category-action';

    return $vars;
} );</code></pre>
<p>Retrieve query parameters values</p>
<pre class="wp-block-code"><code class="language-php" lang="php">$pro_category_action = get_query_var( 'wpdocs-pro-category-action' );
$product_cat_id = get_query_var( 'wpdocs-product-cat-id' );</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-4787">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-atachibana even thread-even depth-1" data-comment-id="4553" id="comment-4553">
<article class="comment-body" id="div-comment-4553">
<a class="screen-reader-text" href="#comment-content-4553">Skip to note 19 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-4553">
<p>(From Codex)<br/>
<strong>Basic Usage</strong></p>
<p>You can retrieve any page by specifying ID in URL as following:<br/>
<a href="http://example.com/?p=95" rel="nofollow ugc">http://example.com/?p=95</a><br/>
If you add the following rule to the functions.php file, you can provide custom formed URL to access.</p>
<pre class="wp-block-code"><code class="language-php" lang="php">function custom_rewrite_basic() {
  add_rewrite_rule('^leaf/([0-9]+)/?', 'index.php?page_id=$matches[1]', 'top');
}
add_action('init', 'custom_rewrite_basic');</code></pre>
<p><strong>NOTE</strong>: When using $matches[] to retrieve the values of a matched URL, capture group data starts at 1, not 0.</p>
<p><strong>IMPORTANT</strong>: Do not forget to flush and regenerate the rewrite rules database after modifying rules. From WordPress Administration Screens, Select Settings -&gt; Permalinks and just click Save Changes without any changes.</p>
<p>Now, you can access the same page as<br/>
<a href="http://example.com/leaf/95" rel="nofollow ugc">http://example.com/leaf/95</a></p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-4553">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-2winfactor odd alt thread-odd thread-alt depth-1" data-comment-id="6412" id="comment-6412">
<article class="comment-body" id="div-comment-6412">
<a class="screen-reader-text" href="#comment-content-6412">Skip to note 20 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-6412">
<p>If you are distributing this in a plugin or theme, you may want to build in flushing rewrite rules. You can actually check to see if it has been set before you <code>flush_rewrite_rules();</code> using the <code>rewrite_rules</code> option. </p>
<p>This option is autoloaded, so there is no extra database call. </p>
<p>Here’s a snippet:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">add_action( 'init',  function() {
    // get registered rewrite rules.
    $rules = get_option( 'rewrite_rules', array() );

    // set the regex.
    $regex = 'wpdocsparam/([a-z0-9-]+)[/]?$';

    // add the rewrite rule.
    add_rewrite_rule( $regex, 'index.php?wpdocsparam=$matches[1]', 'top' );

    // maybe flush rewrite rules if it was not previously in the option.
    if ( ! isset( $rules[ $regex ] ) ) {
        flush_rewrite_rules();
    }
} );</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-6412">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-pektsekye even thread-even depth-1" data-comment-id="6864" id="comment-6864">
<article class="comment-body" id="div-comment-6864">
<a class="screen-reader-text" href="#comment-content-6864">Skip to note 21 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-6864">
<p>IMPORTANT NOTE:</p>
<p>Your code with the <strong><a href="https://developer.notmatt.press/reference/functions/add_rewrite_rule/" rel="function">add_rewrite_rule()</a> </strong> function should be available for the (Settings / Permalinks) <strong>back-end page</strong>.</p>
<p>I have spend much time to find out why my rewrite rule is not registered.<br/>
The problem was that my code with the <a href="https://developer.notmatt.press/reference/functions/add_rewrite_rule/" rel="function">add_rewrite_rule()</a>  was available only for the front-end pages. So it could not be executed when I tried to flush the permalink settings in the back-end.</p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-6864">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-khoipro odd alt thread-odd thread-alt depth-1" data-comment-id="6045" id="comment-6045">
<article class="comment-body" id="div-comment-6045">
<a class="screen-reader-text" href="#comment-content-6045">Skip to note 22 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-6045">
<p>If you need to keep custom taxonomy and post type using same slug, there is a way to use add_rewrite_rule for doing that. A simple case:</p>
<p>Example:</p>
<ul>
<li>/course/course-post-name (custom post type)</li>
<li>/course/course-category-name (custom term)</li>
</ul>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">function wpdocs_add_course_category_rewrites() {
	$rules = array();
	$tax = 'course_category';
	$post_type = 'course';

	$terms = get_terms( array(
		'taxonomy' =&gt; $tax,
		'hide_empty' =&gt; false,
	) );

	foreach ( $terms as $term ) {
		add_rewrite_rule( '^course/(' . $term-&gt;slug . ')[/]?$', 'index.php?post_type=' . $post_type . '&amp;' . $tax . '=$matches[1]', 'top' );
	}
}
add_action( 'init', 'wpdocs_add_course_category_rewrites' );</code></pre>
<p>Remember to flush permalinks (Settings / Permalinks) once to apply changes.</p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-6045">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
