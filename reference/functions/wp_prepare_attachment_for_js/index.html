
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/functions/">Functions</a></span><span class="is-current-page">wp_prepare_attachment_for_js()</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>wp_prepare_attachment_for_js()</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;">wp_prepare_attachment_for_js( <span class="arg-type">int|WP_Post</span> <span class="arg-name">$attachment</span> ): <span class="return-type">array|void</span></h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Prepares an attachment post object for JS, where it is expected to be JSON-encoded and fit into an Attachment model.</p>
</section>
<section class="wp-block-wporg-code-reference-parameters"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="parameters" tabindex="-1"><a href="#parameters">Parameters</a></h2> <dl><dt><code>$attachment</code><span class="type"><span class="int">int</span>|<span class="WP_Post"><a href="https://developer.notmatt.press/reference/classes/wp_post/" rel="class">WP_Post</a></span></span><span class="required">required</span></dt><dd><div class="desc"><span class="description">Attachment ID or object.</span></div></dd></dl></section>
<section class="wporg-has-embedded-code wp-block-wporg-code-reference-return-value"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="return" tabindex="-1"><a href="#return">Return</a></h2> <span class="return-type">array|void</span> Array of attachment details, or void if the parameter does not correspond to an attachment.<br/>
<ul class="param-hash"><li><code>alt</code> <span class="type">string</span><div class="desc">Alt text of the attachment.</div></li>
<li><code>author</code> <span class="type">string</span><div class="desc">ID of the attachment author, as a string.</div></li>
<li><code>authorName</code> <span class="type">string</span><div class="desc">Name of the attachment author.</div></li>
<li><code>caption</code> <span class="type">string</span><div class="desc">Caption for the attachment.</div></li>
<li><code>compat</code> <span class="type">array</span><div class="desc">Containing item and meta.</div></li>
<li><code>context</code> <span class="type">string</span><div class="desc">Context, whether it’s used as the site icon for example.</div></li>
<li><code>date</code> <span class="type">int</span><div class="desc">Uploaded date, timestamp in milliseconds.</div></li>
<li><code>dateFormatted</code> <span class="type">string</span><div class="desc">Formatted date (e.g. June 29, 2018).</div></li>
<li><code>description</code> <span class="type">string</span><div class="desc">Description of the attachment.</div></li>
<li><code>editLink</code> <span class="type">string</span><div class="desc">URL to the edit page for the attachment.</div></li>
<li><code>filename</code> <span class="type">string</span><div class="desc">File name of the attachment.</div></li>
<li><code>filesizeHumanReadable</code> <span class="type">string</span><div class="desc">Filesize of the attachment in human readable format (e.g. 1 MB).</div></li>
<li><code>filesizeInBytes</code> <span class="type">int</span><div class="desc">Filesize of the attachment in bytes.</div></li>
<li><code>height</code> <span class="type">int</span><div class="desc">If the attachment is an image, represents the height of the image in pixels.</div></li>
<li><code>icon</code> <span class="type">string</span><div class="desc">Icon URL of the attachment (e.g. /wp-includes/images/media/archive.png).</div></li>
<li><code>id</code> <span class="type">int</span><div class="desc">ID of the attachment.</div></li>
<li><code>link</code> <span class="type">string</span><div class="desc">URL to the attachment.</div></li>
<li><code>menuOrder</code> <span class="type">int</span><div class="desc">Menu order of the attachment post.</div></li>
<li><code>meta</code> <span class="type">array</span><div class="desc">Meta data for the attachment.</div></li>
<li><code>mime</code> <span class="type">string</span><div class="desc">Mime type of the attachment (e.g. image/jpeg or application/zip).</div></li>
<li><code>modified</code> <span class="type">int</span><div class="desc">Last modified, timestamp in milliseconds.</div></li>
<li><code>name</code> <span class="type">string</span><div class="desc">Name, same as title of the attachment.</div></li>
<li><code>nonces</code> <span class="type">array</span><div class="desc">Nonces for update, delete and edit.</div></li>
<li><code>orientation</code> <span class="type">string</span><div class="desc">If the attachment is an image, represents the image orientation (landscape or portrait).</div></li>
<li><code>sizes</code> <span class="type">array</span><div class="desc">If the attachment is an image, contains an array of arrays for the images sizes: thumbnail, medium, large, and full.</div></li>
<li><code>status</code> <span class="type">string</span><div class="desc">Post status of the attachment (usually <code>'inherit'</code>).</div></li>
<li><code>subtype</code> <span class="type">string</span><div class="desc">Mime subtype of the attachment (usually the last part, e.g. jpeg or zip).</div></li>
<li><code>title</code> <span class="type">string</span><div class="desc">Title of the attachment (usually slugified file name without the extension).</div></li>
<li><code>type</code> <span class="type">string</span><div class="desc">Type of the attachment (usually first part of the mime type, e.g. image).</div></li>
<li><code>uploadedTo</code> <span class="type">int</span><div class="desc">Parent post to which the attachment was uploaded.</div></li>
<li><code>uploadedToLink</code> <span class="type">string</span><div class="desc">URL to the edit page of the parent post of the attachment.</div></li>
<li><code>uploadedToTitle</code> <span class="type">string</span><div class="desc">Post title of the parent of the attachment.</div></li>
<li><code>url</code> <span class="type">string</span><div class="desc">Direct URL to the attachment file (from wp-content).</div></li>
<li><code>width</code> <span class="type">int</span><div class="desc">If the attachment is an image, represents the width of the image in pixels.</div></li>
</ul>
</section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="4313"><code class="language-php line-numbers" id="wporg-source-code" lang="php">
	// Check if HEIC images can be edited.
	if ( ! wp_image_editor_supports( array( 'mime_type' =&gt; 'image/heic' ) ) ) {
		$defaults['heic_upload_error'] = true;
	}

	/**
	 * Filters the Plupload default settings.
	 *
	 * @since 3.4.0
	 *
	 * @param array $defaults Default Plupload settings array.
	 */
	$defaults = apply_filters( 'plupload_default_settings', $defaults );

	$params = array(
		'action' =&gt; 'upload-attachment',
	);

	/**
	 * Filters the Plupload default parameters.
	 *
	 * @since 3.4.0
	 *
	 * @param array $params Default Plupload parameters array.
	 */
	$params = apply_filters( 'plupload_default_params', $params );

	$params['_wpnonce'] = wp_create_nonce( 'media-form' );

	$defaults['multipart_params'] = $params;

	$settings = array(
		'defaults'      =&gt; $defaults,
		'browser'       =&gt; array(
			'mobile'    =&gt; wp_is_mobile(),
			'supported' =&gt; _device_can_upload(),
		),
		'limitExceeded' =&gt; is_multisite() &amp;&amp; ! is_upload_space_available(),
	);

	$script = 'var _wpPluploadSettings = ' . wp_json_encode( $settings ) . ';';

	if ( $data ) {
		$script = "$data\n$script";
	}

	$wp_scripts-&gt;add_data( 'wp-plupload', 'data', $script );
}

/**
 * Prepares an attachment post object for JS, where it is expected
 * to be JSON-encoded and fit into an Attachment model.
 *
 * @since 3.5.0
 *
 * @param int|WP_Post $attachment Attachment ID or object.
 * @return array|void {
 *     Array of attachment details, or void if the parameter does not correspond to an attachment.
 *
 *     @type string $alt                   Alt text of the attachment.
 *     @type string $author                ID of the attachment author, as a string.
 *     @type string $authorName            Name of the attachment author.
 *     @type string $caption               Caption for the attachment.
 *     @type array  $compat                Containing item and meta.
 *     @type string $context               Context, whether it's used as the site icon for example.
 *     @type int    $date                  Uploaded date, timestamp in milliseconds.
 *     @type string $dateFormatted         Formatted date (e.g. June 29, 2018).
 *     @type string $description           Description of the attachment.
 *     @type string $editLink              URL to the edit page for the attachment.
 *     @type string $filename              File name of the attachment.
 *     @type string $filesizeHumanReadable Filesize of the attachment in human readable format (e.g. 1 MB).
 *     @type int    $filesizeInBytes       Filesize of the attachment in bytes.
 *     @type int    $height                If the attachment is an image, represents the height of the image in pixels.
 *     @type string $icon                  Icon URL of the attachment (e.g. /wp-includes/images/media/archive.png).
 *     @type int    $id                    ID of the attachment.
 *     @type string $link                  URL to the attachment.
 *     @type int    $menuOrder             Menu order of the attachment post.
 *     @type array  $meta                  Meta data for the attachment.
 *     @type string $mime                  Mime type of the attachment (e.g. image/jpeg or application/zip).
 *     @type int    $modified              Last modified, timestamp in milliseconds.
 *     @type string $name                  Name, same as title of the attachment.
 *     @type array  $nonces                Nonces for update, delete and edit.
 *     @type string $orientation           If the attachment is an image, represents the image orientation
 *                                         (landscape or portrait).
 *     @type array  $sizes                 If the attachment is an image, contains an array of arrays
 *                                         for the images sizes: thumbnail, medium, large, and full.
 *     @type string $status                Post status of the attachment (usually 'inherit').
 *     @type string $subtype               Mime subtype of the attachment (usually the last part, e.g. jpeg or zip).
 *     @type string $title                 Title of the attachment (usually slugified file name without the extension).
 *     @type string $type                  Type of the attachment (usually first part of the mime type, e.g. image).
 *     @type int    $uploadedTo            Parent post to which the attachment was uploaded.
 *     @type string $uploadedToLink        URL to the edit page of the parent post of the attachment.
 *     @type string $uploadedToTitle       Post title of the parent of the attachment.
 *     @type string $url                   Direct URL to the attachment file (from wp-content).
 *     @type int    $width                 If the attachment is an image, represents the width of the image in pixels.
 * }
 *
 */
function wp_prepare_attachment_for_js( $attachment ) {
	$attachment = get_post( $attachment );

	if ( ! $attachment ) {
		return;
	}

	if ( 'attachment' !== $attachment-&gt;post_type ) {
		return;
	}

	$meta = wp_get_attachment_metadata( $attachment-&gt;ID );
	if ( str_contains( $attachment-&gt;post_mime_type, '/' ) ) {
		list( $type, $subtype ) = explode( '/', $attachment-&gt;post_mime_type );
	} else {
		list( $type, $subtype ) = array( $attachment-&gt;post_mime_type, '' );
	}

	$attachment_url = wp_get_attachment_url( $attachment-&gt;ID );
	$base_url       = str_replace( wp_basename( $attachment_url ), '', $attachment_url );

	$response = array(
		'id'            =&gt; $attachment-&gt;ID,
		'title'         =&gt; $attachment-&gt;post_title,
		'filename'      =&gt; wp_basename( get_attached_file( $attachment-&gt;ID ) ),
		'url'           =&gt; $attachment_url,
		'link'          =&gt; get_attachment_link( $attachment-&gt;ID ),
		'alt'           =&gt; get_post_meta( $attachment-&gt;ID, '_wp_attachment_image_alt', true ),
		'author'        =&gt; $attachment-&gt;post_author,
		'description'   =&gt; $attachment-&gt;post_content,
		'caption'       =&gt; $attachment-&gt;post_excerpt,
		'name'          =&gt; $attachment-&gt;post_name,
		'status'        =&gt; $attachment-&gt;post_status,
		'uploadedTo'    =&gt; $attachment-&gt;post_parent,
		'date'          =&gt; strtotime( $attachment-&gt;post_date_gmt ) * 1000,
		'modified'      =&gt; strtotime( $attachment-&gt;post_modified_gmt ) * 1000,
		'menuOrder'     =&gt; $attachment-&gt;menu_order,
		'mime'          =&gt; $attachment-&gt;post_mime_type,
		'type'          =&gt; $type,
		'subtype'       =&gt; $subtype,
		'icon'          =&gt; wp_mime_type_icon( $attachment-&gt;ID, '.svg' ),
		'dateFormatted' =&gt; mysql2date( __( 'F j, Y' ), $attachment-&gt;post_date ),
		'nonces'        =&gt; array(
			'update' =&gt; false,
			'delete' =&gt; false,
			'edit'   =&gt; false,
		),
		'editLink'      =&gt; false,
		'meta'          =&gt; false,
	);

	$author = new WP_User( $attachment-&gt;post_author );

	if ( $author-&gt;exists() ) {
		$author_name            = $author-&gt;display_name ? $author-&gt;display_name : $author-&gt;nickname;
		$response['authorName'] = html_entity_decode( $author_name, ENT_QUOTES, get_bloginfo( 'charset' ) );
		$response['authorLink'] = get_edit_user_link( $author-&gt;ID );
	} else {
		$response['authorName'] = __( '(no author)' );
	}

	if ( $attachment-&gt;post_parent ) {
		$post_parent = get_post( $attachment-&gt;post_parent );
		if ( $post_parent ) {
			$response['uploadedToTitle'] = $post_parent-&gt;post_title ? $post_parent-&gt;post_title : __( '(no title)' );
			$response['uploadedToLink']  = get_edit_post_link( $attachment-&gt;post_parent, 'raw' );
		}
	}

	$attached_file = get_attached_file( $attachment-&gt;ID );

	if ( isset( $meta['filesize'] ) ) {
		$bytes = $meta['filesize'];
	} elseif ( file_exists( $attached_file ) ) {
		$bytes = wp_filesize( $attached_file );
	} else {
		$bytes = '';
	}

	if ( $bytes ) {
		$response['filesizeInBytes']       = $bytes;
		$response['filesizeHumanReadable'] = size_format( $bytes );
	}

	$context             = get_post_meta( $attachment-&gt;ID, '_wp_attachment_context', true );
	$response['context'] = ( $context ) ? $context : '';

	if ( current_user_can( 'edit_post', $attachment-&gt;ID ) ) {
		$response['nonces']['update'] = wp_create_nonce( 'update-post_' . $attachment-&gt;ID );
		$response['nonces']['edit']   = wp_create_nonce( 'image_editor-' . $attachment-&gt;ID );
		$response['editLink']         = get_edit_post_link( $attachment-&gt;ID, 'raw' );
	}

	if ( current_user_can( 'delete_post', $attachment-&gt;ID ) ) {
		$response['nonces']['delete'] = wp_create_nonce( 'delete-post_' . $attachment-&gt;ID );
	}

	if ( $meta &amp;&amp; ( 'image' === $type || ! empty( $meta['sizes'] ) ) ) {
		$sizes = array();

		/** This filter is documented in wp-admin/includes/media.php */
		$possible_sizes = apply_filters(
			'image_size_names_choose',
			array(
				'thumbnail' =&gt; __( 'Thumbnail' ),
				'medium'    =&gt; __( 'Medium' ),
				'large'     =&gt; __( 'Large' ),
				'full'      =&gt; __( 'Full Size' ),
			)
		);
		unset( $possible_sizes['full'] );

		/*
		 * Loop through all potential sizes that may be chosen. Try to do this with some efficiency.
		 * First: run the image_downsize filter. If it returns something, we can use its data.
		 * If the filter does not return something, then image_downsize() is just an expensive way
		 * to check the image metadata, which we do second.
		 */
		foreach ( $possible_sizes as $size =&gt; $label ) {

			/** This filter is documented in wp-includes/media.php */
			$downsize = apply_filters( 'image_downsize', false, $attachment-&gt;ID, $size );

			if ( $downsize ) {
				if ( empty( $downsize[3] ) ) {
					continue;
				}

				$sizes[ $size ] = array(
					'height'      =&gt; $downsize[2],
					'width'       =&gt; $downsize[1],
					'url'         =&gt; $downsize[0],
					'orientation' =&gt; $downsize[2] &gt; $downsize[1] ? 'portrait' : 'landscape',
				);
			} elseif ( isset( $meta['sizes'][ $size ] ) ) {
				// Nothing from the filter, so consult image metadata if we have it.
				$size_meta = $meta['sizes'][ $size ];

				/*
				 * We have the actual image size, but might need to further constrain it if content_width is narrower.
				 * Thumbnail, medium, and full sizes are also checked against the site's height/width options.
				 */
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/media.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/media.php#L4313">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/media.php#L4313-L4553">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/3.5.0/">3.5.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-slushman even thread-even depth-1" data-comment-id="1879" id="comment-1879">
<article class="comment-body" id="div-comment-1879">
<a class="screen-reader-text" href="#comment-content-1879">Skip to note 3 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-1879">
<p>Here are the fields returned by this function:</p>
<ul>
<li>id
	</li>
<li>title
	</li>
<li>filename
	</li>
<li>url
	</li>
<li>link
	</li>
<li>alt
	</li>
<li>author
	</li>
<li>description
	</li>
<li>caption
	</li>
<li>name
	</li>
<li>status
	</li>
<li>uploadedTo
	</li>
<li>date
	</li>
<li>modified
	</li>
<li>menuOrder
	</li>
<li>mime
	</li>
<li>type
	</li>
<li>subtype
	</li>
<li>icon
	</li>
<li>dateFormatted
	</li>
<li>nonces – this is an array containing each nonce
	</li>
<li>editLink
	</li>
<li>sizes: this sub-array contains the following for each size:
<ul>
<li>height
			</li>
<li>width
			</li>
<li>url
			</li>
<li>orientation
		</li>
</ul>
</li>
<li>width
	</li>
<li>height
	</li>
<li>fileLength
	</li>
<li>combat
<ul></ul>
</li>
</ul>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-1879">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-codex odd alt thread-odd thread-alt depth-1" data-comment-id="1322" id="comment-1322">
<article class="comment-body" id="div-comment-1322">
<a class="screen-reader-text" href="#comment-content-1322">Skip to note 4 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-1322">
<p><strong>Example</strong></p>
<p>Pass image data to a js gallery.</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">&lt;?php
function wpdocs_my_js_gallery_add_gallery_images() {
	$post = get_post();

	$gallery_images = array();

	$attachments = get_posts( array(
		'post_type'      =&gt; 'attachment',
		'post_status'    =&gt; 'inherit',
		'post_parent'    =&gt; $post-&gt;ID,
		'post_mime_type' =&gt; 'image',
	) );

	foreach( $attachments as $attachment )
		$gallery_images[] = wp_prepare_attachment_for_js( $attachment-&gt;ID );

	wp_localize_script( 'my-js-gallery', 'my_js_gallery', array(
		'images' =&gt; $gallery_images,
	) );
}
add_action( 'wp_head', 'wpdocs_my_js_gallery_add_gallery_images', 1 );</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-1322">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
