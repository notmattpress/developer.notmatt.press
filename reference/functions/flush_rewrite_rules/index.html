
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/functions/">Functions</a></span><span class="is-current-page">flush_rewrite_rules()</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>flush_rewrite_rules()</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;">flush_rewrite_rules( <span class="arg-type">bool</span> <span class="arg-name">$hard</span> = <span class="arg-default">true</span> )</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Removes rewrite rules and then recreate rewrite rules.</p>
</section>
<section class="wp-block-wporg-code-reference-parameters"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="parameters" tabindex="-1"><a href="#parameters">Parameters</a></h2> <dl><dt><code>$hard</code><span class="type"><span class="bool">bool</span></span><span class="required">optional</span></dt><dd><div class="desc"><span class="description">Whether to update .htaccess (hard flush) or just update                   rewrite_rules option (soft flush). Default is true (hard).</span></div><p class="default">Default:<code>true</code></p></dd></dl></section>
<section class="wporg-has-embedded-code wp-block-wporg-code-reference-explanation"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="more-information" tabindex="-1"><a href="#more-information">More Information</a></h2>
<p>This function is useful when used with custom post types as it allows for automatic flushing of the WordPress rewrite rules (usually needs to be done manually for new custom post types). However, <b>this is an expensive operation</b> so it should only be used when necessary.</p>
</section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="278"><code class="language-php line-numbers" id="wporg-source-code" lang="php">function flush_rewrite_rules( $hard = true ) {
	global $wp_rewrite;

	if ( is_callable( array( $wp_rewrite, 'flush_rules' ) ) ) {
		$wp_rewrite-&gt;flush_rules( $hard );
	}
}
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/rewrite.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/rewrite.php#L278">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/rewrite.php#L278-L284">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-related" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="related" tabindex="-1"><a href="#related">Related</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Uses</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rewrite/flush_rules/">WP_Rewrite::flush_rules()</a><code>wp-includes/class-wp-rewrite.php</code></td><td><p>Removes rewrite rules and then recreate rewrite rules.</p>
</td></tr></tbody></table></figure></section> <section class="wp-block-wporg-code-table" id="used-by" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Used by</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/functions/update_home_siteurl/">update_home_siteurl()</a><code>wp-admin/includes/misc.php</code></td><td><p>Flushes rewrite rules if <code>siteurl</code>, <code>home</code> or <code>page_on_front</code> changed.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/functions/populate_network/">populate_network()</a><code>wp-admin/includes/schema.php</code></td><td><p>Populate network settings.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/functions/wp_install/">wp_install()</a><code>wp-admin/includes/upgrade.php</code></td><td><p>Installs the site.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/functions/check_theme_switched/">check_theme_switched()</a><code>wp-includes/theme.php</code></td><td><p>Checks if a theme has been changed and runs ‘after_switch_theme’ hook on the next WP load.</p>
</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/3.0.0/">3.0.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-nsrw0rk even thread-odd thread-alt depth-1" data-comment-id="2645" id="comment-2645">
<article class="comment-body" id="div-comment-2645">
<a class="screen-reader-text" href="#comment-content-2645">Skip to note 8 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-2645">
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">register_activation_hook( __FILE__, 'plugin_activation' );
function plugin_activation() {
	update_option('plugin_permalinks_flushed', 0);
}

add_action( 'init', 'custom_query_vars' );
function custom_query_vars() {
	global $wp;

	$wp-&gt;add_query_var( 'newfeed' );
	add_rewrite_rule( '^newfeed/([^/]*)/?', 'index.php?newfeed=$matches[1]', 'top' );

	if( !get_option('plugin_permalinks_flushed') ) {

		flush_rewrite_rules(false);
		update_option('plugin_permalinks_flushed', 1);

	}
}</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="3" id="feedback-2645">
<ul class="children">
<li class="comment byuser comment-author-princeofabyss odd alt depth-2" data-comment-id="5886" id="comment-5886">
<article class="comment-body" id="div-comment-5886">
<div class="wporg-has-embedded-code comment-content" id="comment-content-5886">
<div>This is brilliant! I had to write a rewrite rule where I had to use <code>wc_get_page_id( '' )</code>, and then run a flush_rewrite_rules, but at the point <a href="https://developer.notmatt.press/reference/functions/register_activation_hook/" rel="function">register_activation_hook()</a>  is called, WC isn’t even initialized, so I used your code to run the flush_rewrite_rules delayed enough and still only call it once after my plugin’s installation! Thank you very much for the idea!</div>
<div><a class="url" href="https://profiles.wordpress.org/princeofabyss/" rel="external nofollow">princeofabyss</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/#comment-5886"><time datetime="2022-06-26T04:22:01+00:00">3 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
<li class="comment byuser comment-author-gon123 even depth-2" data-comment-id="6512" id="comment-6512">
<article class="comment-body" id="div-comment-6512">
<div class="wporg-has-embedded-code comment-content" id="comment-content-6512">
<div>It doesn’t seems to work for me. I don’t know if someting changed and now you cannot call flush on the init but I use your code and it doesn’t updates while using the button on admin area it does :S</div>
<div><a class="url" href="https://profiles.wordpress.org/gon123/" rel="external nofollow">gon123</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/#comment-6512"><time datetime="2023-06-16T16:43:01+00:00">2 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
<li class="comment byuser comment-author-okvee odd alt depth-2" data-comment-id="6800" id="comment-6800">
<article class="comment-body" id="div-comment-6800">
<div class="wporg-has-embedded-code comment-content" id="comment-content-6800">
<div>To make it easier to understand about important part. The flush have to be done **after** add rewrite rule. I have just added flush to activate plugin but it didn’t work until I read this code.   Thanks.</div>
<div><a class="url" href="https://profiles.wordpress.org/okvee/" rel="external nofollow">vee</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/#comment-6800"><time datetime="2023-12-02T08:19:56+00:00">1 year ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-ravanh even thread-even depth-1" data-comment-id="4023" id="comment-4023">
<article class="comment-body" id="div-comment-4023">
<a class="screen-reader-text" href="#comment-content-4023">Skip to note 9 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-4023">
<p>A relatively simple way to flush rewrite rules on activation and deactivation hooks is not using <a href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/" rel="function">flush_rewrite_rules()</a>  at all. Instead just clear the rewrite_rules option to force WordPress to recreate them at the right time.</p>
<p>Example:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">register_activation_hook( __FILE__, 'wpdocs_wpdev_activate' );

function wpdocs_wpdev_activate() {
	// force rewrite rules to be recreated at the right time
	delete_option( 'rewrite_rules' );
}</code></pre>
<p>This avoids having to do complicated stuff like registering your custom post types in the activation hook or throwing and catching dedicated db option or transients as suggested in other notes…</p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="2" id="feedback-4023">
<ul class="children">
<li class="comment byuser comment-author-ravanh odd alt depth-2" data-comment-id="5904" id="comment-5904">
<article class="comment-body" id="div-comment-5904">
<div class="wporg-has-embedded-code comment-content" id="comment-content-5904">
<div>Not sure why this contribution gets down voted but maybe it needs a bit more explanation…   There is one <strong>big</strong> problem with <code>flush_rewrite_rules()</code> when not called at the right time: it not only removes the old rewrite rules but also creates new ones, based on the (custom) post types and rewrite rules filters registered registered at that point in time. So if your plugin or theme calls <code>flush_rewrite_rules()</code> on an awkward moment where not everything is in place, wrong or incomplete rewrite rules will be generated. For example: when updating a plugin setting that warrants new rewrite rules, calling <code>flush_rewrite_rules()</code> from withing the option sanitization hook will likely cause problems. Or when calling it on a deactivation hook, without first removing your custom post type, <code>flush_rewrite_rules()</code> will likely not have the desired effect.  Others like @nsrw0rk (up voted for good reason) have suggested an elegant solution: save an option to the database that will trigger <code>flush_rewrite_rules()</code> on the next init. But this will not always work, like in case of the deactivation hook (where the next init will be without your plugin) or in Multisite mode where rewrite rules <strong>can’t be flushed during switch to blog</strong>.   So that is why I suggested the less elegant, but effective work-around: <code>delete_option( 'rewrite_rules' )</code> :)</div>
<div><a class="url" href="https://profiles.wordpress.org/ravanh/" rel="external nofollow">Rolf Allard van Hagen</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/#comment-5904"><time datetime="2022-07-03T22:19:50+00:00">3 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
<li class="comment byuser comment-author-pizza2mozzarella even depth-2" data-comment-id="7032" id="comment-7032">
<article class="comment-body" id="div-comment-7032">
<div class="wporg-has-embedded-code comment-content" id="comment-content-7032">
<div>This is THE ONLY solution. …and works like a charm, thank you! When building a plugin with classes (like the one in the boilerplate) the activation class runs before the main class that contains the registration of the custom post types. Hence if you just <a href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/" rel="function">flush_rewrite_rules()</a>  you rewrite the rules without your custom post types. You need to rewrite them AFTER having registered them, and you also want to rewrite them only once after activation, not every single time. So you just delete them upon activation, then your main code registers them, then wordpress notice the rules are empty and tries to rebuild them but your post have already been registered. Smooth, elegant, effective!</div>
<div><a class="url" href="https://profiles.wordpress.org/pizza2mozzarella/" rel="external nofollow">pizza2mozzarella</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/#comment-7032"><time datetime="2024-05-22T10:44:34+00:00">9 months ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-arnaim odd alt thread-odd thread-alt depth-1" data-comment-id="2212" id="comment-2212">
<article class="comment-body" id="div-comment-2212">
<a class="screen-reader-text" href="#comment-content-2212">Skip to note 10 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-2212">
<p>If you want to flush rules while updating posts based on post type: </p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">function wpdoc_flush_rules_on_save_posts( $post_id ) {

    // Check the correct post type.
    // Example to check, if the post type isn't 'post' then don't flush, just return.
    if ( ! empty( $_POST['post_type'] &amp;&amp; $_POST['post_type'] != 'post' ) {
        return;
    }

    flush_rewrite_rules();

}

add_action( 'save_post', 'wpdoc_flush_rules_on_save_posts', 20, 2);</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="1" id="feedback-2212">
<ul class="children">
<li class="comment byuser comment-author-ahsynv even depth-2" data-comment-id="5397" id="comment-5397">
<article class="comment-body" id="div-comment-5397">
<div class="wporg-has-embedded-code comment-content" id="comment-content-5397">
<div><a href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/" rel="function">flush_rewrite_rules()</a>  does not work on “save_post”, and instead of doing $_POST.. you can pass as a 2nd parameter like ($post_id, $post) and get $post-&gt;post_type</div>
<div><a class="url" href="https://profiles.wordpress.org/ahsynv/" rel="external nofollow">ahsynv</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/#comment-5397"><time datetime="2021-10-11T12:20:37+00:00">3 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-codex odd alt thread-even depth-1" data-comment-id="598" id="comment-598">
<article class="comment-body" id="div-comment-598">
<a class="screen-reader-text" href="#comment-content-598">Skip to note 11 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-598">
<p>This is how you would flush rules on theme activation:</p>
<pre class="wp-block-code"><code class="language-php" lang="php">/* Flush rewrite rules for custom post types. */
add_action( 'after_switch_theme', 'flush_rewrite_rules' );</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-598">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-codex even thread-odd thread-alt depth-1 bad-note" data-comment-id="599" id="comment-599">
<article class="comment-body" id="div-comment-599">
<a class="screen-reader-text" href="#comment-content-599">Skip to note 12 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-599">
<p>If you’re developing a theme, while building it you can use this snippet of code that will flush rewrite rules when the file containing it is changed, or every 48 hours:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">// do not use on live/production servers
add_action( 'init','maybe_rewrite_rules' );

/**
 * Flush rewrite rules if the current file has changed and at least every 48 hours.
 */
function maybe_rewrite_rules() {
	if ( ! is_admin() ) {
		return;
	}

	$ver = filemtime( __FILE__ ); // Get the file time for this file as the version number
	$defaults = array( 'version' =&gt; 0, 'time' =&gt; time() );
	$r = wp_parse_args( get_option( __CLASS__ . '_flush', array() ), $defaults );

	if ( $r['version'] != $ver || $r['time'] + 172800 &lt; time() ) { // Flush if ver changes or if 48hrs has passed.
		flush_rewrite_rules();
		// trace( 'flushed' );
		$args = array( 'version' =&gt; $ver, 'time' =&gt; time() );
		if ( ! update_option( __CLASS__ . '_flush', $args ) )
			add_option( __CLASS__ . '_flush', $args );
	}

}</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="1" id="feedback-599">
<ul class="children">
<li class="comment byuser comment-author-azaozz odd alt depth-2" data-comment-id="2701" id="comment-2701">
<article class="comment-body" id="div-comment-2701">
<div class="wporg-has-embedded-code comment-content" id="comment-content-2701">
<div>“Flushing” the rewrite rules should only happen in wp-admin, see <a href="https://core.trac.wordpress.org/ticket/44142" rel="nofollow ugc">https://core.trac.wordpress.org/ticket/44142</a>. It is possible to do from the front-end while developing a theme or a plugin, but is a pretty bad idea if ever done in production.In that terms I’d add: <code>if ( ! is_admin() ) { return; }</code> at the top of the above function.</div>
<div><a class="url" href="https://profiles.wordpress.org/azaozz/" rel="external nofollow">Andrew Ozz</a> <a class="comment-date" href="https://developer.notmatt.press/reference/functions/flush_rewrite_rules/#comment-2701"><time datetime="2018-05-21T09:52:40+00:00">7 years ago</time></a></div>
</div><!-- .comment-content -->
</article>
</li>
</ul>
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-codex even thread-even depth-1 bad-note" data-comment-id="597" id="comment-597">
<article class="comment-body" id="div-comment-597">
<a class="screen-reader-text" href="#comment-content-597">Skip to note 13 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-597">
<p>This is how you would flush rewrite rules when a plugin is activated or deactivated:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">register_deactivation_hook( __FILE__, 'flush_rewrite_rules' );
register_activation_hook( __FILE__, 'wdocs_flush_rewrites' );


/**
 * Flush rewrite rules on activation
 */
function wpdocs_flush_rewrites() {
	// call your CPT registration function here (it should also be hooked into 'init')
	wpdocs_custom_post_types_registration();
	flush_rewrite_rules();
}</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-597">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-elhardoum odd alt thread-odd thread-alt depth-1 bad-note" data-comment-id="1628" id="comment-1628">
<article class="comment-body" id="div-comment-1628">
<a class="screen-reader-text" href="#comment-content-1628">Skip to note 14 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-1628">
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">// flush rules and serve new rules instantly without page refresh
add_action('init', function() {
    flush_rewrite_rules();
});
// Or, hook into wp tag, flush rules and do an internal refresh
add_action('wp', function() {
    if( "1" !== get_option("my_rules_have_been_flushed") ) {
        flush_rewrite_rules();
        update_option('my_rules_have_been_flushed', '1');
        // now, redirect the request.
        wp_redirect( $_SERVER['REQUEST_URI'] );
        exit;
    }
});</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-1628">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
