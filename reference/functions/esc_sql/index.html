
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.notmatt.press">Home</a></span><span><a href="https://developer.notmatt.press/reference/">Reference</a></span><span><a href="https://developer.notmatt.press/reference/functions/">Functions</a></span><span class="is-current-page">esc_sql()</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>esc_sql()</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;">esc_sql( <span class="arg-type">string|array</span> <span class="arg-name">$data</span> ): <span class="return-type">string|array</span></h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Escapes data for use in a MySQL query.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>Usually you should prepare queries using <a href="https://developer.notmatt.press/reference/classes/wpdb/prepare/" rel="method">wpdb::prepare()</a>.<br/>Sometimes, spot-escaping is required or useful. One example is preparing an array for use in an IN clause.</p>
<p>NOTE: Since 4.8.3, ‘%’ characters will be replaced with a placeholder string, this prevents certain SQLi attacks from taking place. This change in behavior may cause issues for code that expects the return value of <a href="https://developer.notmatt.press/reference/functions/esc_sql/" rel="function">esc_sql()</a>  to be usable for other purposes.</p>
</section>
<section class="wp-block-wporg-code-reference-parameters"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="parameters" tabindex="-1"><a href="#parameters">Parameters</a></h2> <dl><dt><code>$data</code><span class="type"><span class="string">string</span>|<span class="array">array</span></span><span class="required">required</span></dt><dd><div class="desc"><span class="description">Unescaped data.</span></div></dd></dl></section>
<section class="wporg-has-embedded-code wp-block-wporg-code-reference-return-value"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="return" tabindex="-1"><a href="#return">Return</a></h2> <span class="return-type">string|array</span> Escaped data, in the same type as supplied.</section>
<section class="wporg-has-embedded-code wp-block-wporg-code-reference-explanation"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="more-information" tabindex="-1"><a href="#more-information">More Information</a></h2>
<ul class="wp-block-list">
<li>Be careful in using this function correctly. <strong>It will only escape values to be used in strings in the query</strong>. That is, it only provides escaping for values that will be within quotes in the SQL (as in <code>field = '{$escaped_value}'</code>). If your value is not going to be within quotes, your code will still be vulnerable to SQL injection. For example, this is vulnerable, because the escaped value is not surrounded by quotes in the SQL query: <code>ORDER BY {$escaped_value}</code>. As such, <strong>this function does not escape unquoted numeric values, field names, or SQL keywords</strong>.</li>
<li><a href="https://developer.notmatt.press/reference/classes/wpdb/prepare/"><code>$wpdb-&gt;prepare()</code></a> is generally preferred as it corrects some common formatting errors.</li>
<li>This function was formerly just an alias for <a href="https://developer.notmatt.press/reference/classes/wpdb/escape/"><code>$wpdb-&gt;escape()</code></a>, but that function has now been deprecated.</li>
</ul>
</section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="4438"><code class="language-php line-numbers" id="wporg-source-code" lang="php">function esc_sql( $data ) {
	global $wpdb;
	return $wpdb-&gt;_escape( $data );
}
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/formatting.php/">View all references</a> <a href="https://core.trac.notmatt.press/browser/tags/6.7/src/wp-includes/formatting.php#L4438">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/formatting.php#L4438-L4441">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-related" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="related" tabindex="-1"><a href="#related">Related</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Uses</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wpdb/_escape/">wpdb::_escape()</a><code>wp-includes/class-wpdb.php</code></td><td><p>Escapes data. Works on arrays.</p>
</td></tr></tbody></table></figure></section> <section class="wp-block-wporg-code-table" id="used-by" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Used by</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_user_query/parse_orderby/">WP_User_Query::parse_orderby()</a><code>wp-includes/class-wp-user-query.php</code></td><td><p>Parses and sanitizes ‘orderby’ keys passed to the user query.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_comment_query/parse_orderby/">WP_Comment_Query::parse_orderby()</a><code>wp-includes/class-wp-comment-query.php</code></td><td><p>Parse and sanitize ‘orderby’ keys passed to the comment query.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_date_query/get_sql_for_clause/">WP_Date_Query::get_sql_for_clause()</a><code>wp-includes/class-wp-date-query.php</code></td><td><p>Turns a first-order date query into SQL for a WHERE clause.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_query/get_posts/">WP_Query::get_posts()</a><code>wp-includes/class-wp-query.php</code></td><td><p>Retrieves an array of posts based on query variables.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/functions/_pad_term_counts/">_pad_term_counts()</a><code>wp-includes/taxonomy.php</code></td><td><p>Adds count of children to parent count.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/functions/_update_post_term_count/">_update_post_term_count()</a><code>wp-includes/taxonomy.php</code></td><td><p>Updates term count based on object types of the current taxonomy.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_date_query/__construct/">WP_Date_Query::__construct()</a><code>wp-includes/class-wp-date-query.php</code></td><td><p>Constructor.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/functions/wp_load_alloptions/">wp_load_alloptions()</a><code>wp-includes/option.php</code></td><td><p>Loads and caches all autoloaded options, if available or all options.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/functions/get_page_by_path/">get_page_by_path()</a><code>wp-includes/post.php</code></td><td><p>Retrieves a page given its path.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/functions/get_page_by_title/">get_page_by_title()</a><code>wp-includes/deprecated.php</code></td><td><p>Retrieves a page given its title.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/functions/redirect_guess_404_permalink/">redirect_guess_404_permalink()</a><code>wp-includes/canonical.php</code></td><td><p>Attempts to guess the correct URL for a 404 request based on query vars.</p>
</td></tr></tbody></table></figure><a class="wp-block-wporg-code-table-show-more" href="#">Show 6 more</a><a class="wp-block-wporg-code-table-show-less" href="#">Show less</a></section> </section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/2.8.0/">2.8.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-jdgrimes even thread-even depth-1" data-comment-id="253" id="comment-253">
<article class="comment-body" id="div-comment-253">
<a class="screen-reader-text" href="#comment-content-253">Skip to note 3 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-253">
<p>It should be noted that this function <strong>will only escape values to be used in strings</strong> in the query. That is, it only provides escaping for values that will be within quotes in the SQL (as in <code>field = '{$escaped_value}'</code>). If your value is not going to be within quotes, your code will still be vulnerable to SQL injection. For example, this is vulnerable, because the escaped value is not surrounded by quotes in the SQL query: <code>ORDER BY {$escaped_value}</code>. As such, <strong>this function does not escape unquoted numeric values, field names, or SQL keywords.</strong>.</p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-253">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-codex odd alt thread-odd thread-alt depth-1 bad-note" data-comment-id="1101" id="comment-1101">
<article class="comment-body" id="div-comment-1101">
<a class="screen-reader-text" href="#comment-content-1101">Skip to note 4 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-1101">
<p><strong>Basic Example</strong></p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">&lt;?php

$name   = esc_sql( $name );
$status = esc_sql( $status );

$wpdb-&gt;get_var( "SELECT something FROM table WHERE foo = '$name' and status = '$status'" );

?&gt;</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-1101">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
