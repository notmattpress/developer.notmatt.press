
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/classes/">Classes</a></span><span class="is-current-page">WP_HTML_Active_Formatting_Elements</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>WP_HTML_Active_Formatting_Elements</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="keyword">class</span> WP_HTML_Active_Formatting_Elements {}</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Core class used by the HTML processor during HTML parsing for managing the stack of active formatting elements.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>This class is designed for internal use by the HTML processor.</p>
<blockquote>
<p>Initially, the list of active formatting elements is empty.<br/>It is used to handle mis-nested formatting element tags.</p>
<p>The list contains elements in the formatting category, and markers.<br/>The markers are inserted when entering applet, object, marquee, template, td, th, and caption elements, and are used to prevent formatting from "leaking" into applet, object, marquee, template, td, th, and caption elements.</p>
<p>In addition, each element in the list of active formatting elements is associated with the token for which it was created, so that further elements can be created for that token if necessary.</p>
</blockquote>
<h3 class="is-toc-heading has-heading-5-font-size" id="see-also" tabindex="-1"><a href="#see-also">See also</a></h3><ul><li><a href="https://html.spec.whatwg.org/#list-of-active-formatting-elements">https://html.spec.whatwg.org/#list-of-active-formatting-elements</a></li>
<li><a href="https://developer.notmatt.press/reference/classes/wp_html_processor">WP_HTML_Processor</a></li>
</ul></section>
<section class="wp-block-wporg-code-reference-methods"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="methods" tabindex="-1"><a href="#methods">Methods</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Name</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/clear_up_to_last_marker/">WP_HTML_Active_Formatting_Elements::clear_up_to_last_marker</a></td><td>Clears the list of active formatting elements up to the last marker.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/contains_node/">WP_HTML_Active_Formatting_Elements::contains_node</a></td><td>Reports if a specific node is in the stack of active formatting elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/count/">WP_HTML_Active_Formatting_Elements::count</a></td><td>Returns how many nodes are currently in the stack of active formatting elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/current_node/">WP_HTML_Active_Formatting_Elements::current_node</a></td><td>Returns the node at the end of the stack of active formatting elements, if one exists. If the stack is empty, returns null.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/insert_marker/">WP_HTML_Active_Formatting_Elements::insert_marker</a></td><td>Inserts a “marker” at the end of the list of active formatting elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/push/">WP_HTML_Active_Formatting_Elements::push</a></td><td>Pushes a node onto the stack of active formatting elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/remove_node/">WP_HTML_Active_Formatting_Elements::remove_node</a></td><td>Removes a node from the stack of active formatting elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/walk_down/">WP_HTML_Active_Formatting_Elements::walk_down</a></td><td>Steps through the stack of active formatting elements, starting with the top element (added first) and walking downwards to the one added last.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_active_formatting_elements/walk_up/">WP_HTML_Active_Formatting_Elements::walk_up</a></td><td>Steps through the stack of active formatting elements, starting with the bottom element (added last) and walking upwards to the one added first.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="36"><code class="language-php line-numbers" id="wporg-source-code" lang="php">class WP_HTML_Active_Formatting_Elements {
	/**
	 * Holds the stack of active formatting element references.
	 *
	 * @since 6.4.0
	 *
	 * @var WP_HTML_Token[]
	 */
	private $stack = array();

	/**
	 * Reports if a specific node is in the stack of active formatting elements.
	 *
	 * @since 6.4.0
	 *
	 * @param WP_HTML_Token $token Look for this node in the stack.
	 * @return bool Whether the referenced node is in the stack of active formatting elements.
	 */
	public function contains_node( WP_HTML_Token $token ) {
		foreach ( $this-&gt;walk_up() as $item ) {
			if ( $token-&gt;bookmark_name === $item-&gt;bookmark_name ) {
				return true;
			}
		}

		return false;
	}

	/**
	 * Returns how many nodes are currently in the stack of active formatting elements.
	 *
	 * @since 6.4.0
	 *
	 * @return int How many node are in the stack of active formatting elements.
	 */
	public function count() {
		return count( $this-&gt;stack );
	}

	/**
	 * Returns the node at the end of the stack of active formatting elements,
	 * if one exists. If the stack is empty, returns null.
	 *
	 * @since 6.4.0
	 *
	 * @return WP_HTML_Token|null Last node in the stack of active formatting elements, if one exists, otherwise null.
	 */
	public function current_node() {
		$current_node = end( $this-&gt;stack );

		return $current_node ? $current_node : null;
	}

	/**
	 * Inserts a "marker" at the end of the list of active formatting elements.
	 *
	 * &gt; The markers are inserted when entering applet, object, marquee,
	 * &gt; template, td, th, and caption elements, and are used to prevent
	 * &gt; formatting from "leaking" into applet, object, marquee, template,
	 * &gt; td, th, and caption elements.
	 *
	 * @see https://html.spec.whatwg.org/#concept-parser-marker
	 *
	 * @since 6.7.0
	 */
	public function insert_marker(): void {
		$this-&gt;push( new WP_HTML_Token( null, 'marker', false ) );
	}

	/**
	 * Pushes a node onto the stack of active formatting elements.
	 *
	 * @since 6.4.0
	 *
	 * @see https://html.spec.whatwg.org/#push-onto-the-list-of-active-formatting-elements
	 *
	 * @param WP_HTML_Token $token Push this node onto the stack.
	 */
	public function push( WP_HTML_Token $token ) {
		/*
		 * &gt; If there are already three elements in the list of active formatting elements after the last marker,
		 * &gt; if any, or anywhere in the list if there are no markers, that have the same tag name, namespace, and
		 * &gt; attributes as element, then remove the earliest such element from the list of active formatting
		 * &gt; elements. For these purposes, the attributes must be compared as they were when the elements were
		 * &gt; created by the parser; two elements have the same attributes if all their parsed attributes can be
		 * &gt; paired such that the two attributes in each pair have identical names, namespaces, and values
		 * &gt; (the order of the attributes does not matter).
		 *
		 * @todo Implement the "Noah's Ark clause" to only add up to three of any given kind of formatting elements to the stack.
		 */
		// &gt; Add element to the list of active formatting elements.
		$this-&gt;stack[] = $token;
	}

	/**
	 * Removes a node from the stack of active formatting elements.
	 *
	 * @since 6.4.0
	 *
	 * @param WP_HTML_Token $token Remove this node from the stack, if it's there already.
	 * @return bool Whether the node was found and removed from the stack of active formatting elements.
	 */
	public function remove_node( WP_HTML_Token $token ) {
		foreach ( $this-&gt;walk_up() as $position_from_end =&gt; $item ) {
			if ( $token-&gt;bookmark_name !== $item-&gt;bookmark_name ) {
				continue;
			}

			$position_from_start = $this-&gt;count() - $position_from_end - 1;
			array_splice( $this-&gt;stack, $position_from_start, 1 );
			return true;
		}

		return false;
	}

	/**
	 * Steps through the stack of active formatting elements, starting with the
	 * top element (added first) and walking downwards to the one added last.
	 *
	 * This generator function is designed to be used inside a "foreach" loop.
	 *
	 * Example:
	 *
	 *     $html = '&lt;em&gt;&lt;strong&gt;&lt;a&gt;We are here';
	 *     foreach ( $stack-&gt;walk_down() as $node ) {
	 *         echo "{$node-&gt;node_name} -&gt; ";
	 *     }
	 *     &gt; EM -&gt; STRONG -&gt; A -&gt;
	 *
	 * To start with the most-recently added element and walk towards the top,
	 * see WP_HTML_Active_Formatting_Elements::walk_up().
	 *
	 * @since 6.4.0
	 */
	public function walk_down() {
		$count = count( $this-&gt;stack );

		for ( $i = 0; $i &lt; $count; $i++ ) {
			yield $this-&gt;stack[ $i ];
		}
	}

	/**
	 * Steps through the stack of active formatting elements, starting with the
	 * bottom element (added last) and walking upwards to the one added first.
	 *
	 * This generator function is designed to be used inside a "foreach" loop.
	 *
	 * Example:
	 *
	 *     $html = '&lt;em&gt;&lt;strong&gt;&lt;a&gt;We are here';
	 *     foreach ( $stack-&gt;walk_up() as $node ) {
	 *         echo "{$node-&gt;node_name} -&gt; ";
	 *     }
	 *     &gt; A -&gt; STRONG -&gt; EM -&gt;
	 *
	 * To start with the first added element and walk towards the bottom,
	 * see WP_HTML_Active_Formatting_Elements::walk_down().
	 *
	 * @since 6.4.0
	 */
	public function walk_up() {
		for ( $i = count( $this-&gt;stack ) - 1; $i &gt;= 0; $i-- ) {
			yield $this-&gt;stack[ $i ];
		}
	}

	/**
	 * Clears the list of active formatting elements up to the last marker.
	 *
	 * &gt; When the steps below require the UA to clear the list of active formatting elements up to
	 * &gt; the last marker, the UA must perform the following steps:
	 * &gt;
	 * &gt; 1. Let entry be the last (most recently added) entry in the list of active
	 * &gt;    formatting elements.
	 * &gt; 2. Remove entry from the list of active formatting elements.
	 * &gt; 3. If entry was a marker, then stop the algorithm at this point.
	 * &gt;    The list has been cleared up to the last marker.
	 * &gt; 4. Go to step 1.
	 *
	 * @see https://html.spec.whatwg.org/multipage/parsing.html#clear-the-list-of-active-formatting-elements-up-to-the-last-marker
	 *
	 * @since 6.7.0
	 */
	public function clear_up_to_last_marker(): void {
		foreach ( $this-&gt;walk_up() as $item ) {
			array_pop( $this-&gt;stack );
			if ( 'marker' === $item-&gt;node_name ) {
				break;
			}
		}
	}
}
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/html-api/class-wp-html-active-formatting-elements.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/html-api/class-wp-html-active-formatting-elements.php#L36">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/html-api/class-wp-html-active-formatting-elements.php#L36-L229">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.4.0/">6.4.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
