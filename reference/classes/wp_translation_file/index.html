
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/classes/">Classes</a></span><span class="is-current-page">WP_Translation_File</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>WP_Translation_File</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="keyword">class</span> WP_Translation_File {}</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Class <a href="https://developer.notmatt.press/reference/classes/wp_translation_file/" rel="class">WP_Translation_File</a>.</p>
</section>
<section class="wp-block-wporg-code-reference-methods"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="methods" tabindex="-1"><a href="#methods">Methods</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Name</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/__construct/">WP_Translation_File::__construct</a></td><td>Constructor.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/create/">WP_Translation_File::create</a></td><td>Creates a new <a href="https://developer.notmatt.press/reference/classes/wp_translation_file/" rel="class">WP_Translation_File</a> instance for a given file.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/entries/">WP_Translation_File::entries</a></td><td>Returns all entries.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/error/">WP_Translation_File::error</a></td><td>Returns the current error information.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/export/">WP_Translation_File::export</a></td><td>Exports translation contents as a string.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/get_file/">WP_Translation_File::get_file</a></td><td>Returns the file name.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/get_plural_expression_from_header/">WP_Translation_File::get_plural_expression_from_header</a></td><td>Returns the plural forms expression as a tuple.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/get_plural_form/">WP_Translation_File::get_plural_form</a></td><td>Returns the plural form for a given number.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/headers/">WP_Translation_File::headers</a></td><td>Returns all headers.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/import/">WP_Translation_File::import</a></td><td>Imports translations from another file.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/make_plural_form_function/">WP_Translation_File::make_plural_form_function</a></td><td>Makes a function, which will return the right translation index, according to the plural forms header.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/parse_file/">WP_Translation_File::parse_file</a></td><td>Parses the file.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/transform/">WP_Translation_File::transform</a></td><td>Creates a new <a href="https://developer.notmatt.press/reference/classes/wp_translation_file/" rel="class">WP_Translation_File</a> instance for a given file.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file/translate/">WP_Translation_File::translate</a></td><td>Translates a given string.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="15"><code class="language-php line-numbers" id="wporg-source-code" lang="php">abstract class WP_Translation_File {
	/**
	 * List of headers.
	 *
	 * @since 6.5.0
	 * @var array&lt;string, string&gt;
	 */
	protected $headers = array();

	/**
	 * Whether file has been parsed.
	 *
	 * @since 6.5.0
	 * @var bool
	 */
	protected $parsed = false;

	/**
	 * Error information.
	 *
	 * @since 6.5.0
	 * @var string|null Error message or null if no error.
	 */
	protected $error;

	/**
	 * File name.
	 *
	 * @since 6.5.0
	 * @var string
	 */
	protected $file = '';

	/**
	 * Translation entries.
	 *
	 * @since 6.5.0
	 * @var array&lt;string, string&gt;
	 */
	protected $entries = array();

	/**
	 * Plural forms function.
	 *
	 * @since 6.5.0
	 * @var callable|null Plural forms.
	 */
	protected $plural_forms = null;

	/**
	 * Constructor.
	 *
	 * @since 6.5.0
	 *
	 * @param string $file File to load.
	 */
	protected function __construct( string $file ) {
		$this-&gt;file = $file;
	}

	/**
	 * Creates a new WP_Translation_File instance for a given file.
	 *
	 * @since 6.5.0
	 *
	 * @param string      $file     File name.
	 * @param string|null $filetype Optional. File type. Default inferred from file name.
	 * @return false|WP_Translation_File
	 */
	public static function create( string $file, ?string $filetype = null ) {
		if ( ! is_readable( $file ) ) {
			return false;
		}

		if ( null === $filetype ) {
			$pos = strrpos( $file, '.' );
			if ( false !== $pos ) {
				$filetype = substr( $file, $pos + 1 );
			}
		}

		switch ( $filetype ) {
			case 'mo':
				return new WP_Translation_File_MO( $file );
			case 'php':
				return new WP_Translation_File_PHP( $file );
			default:
				return false;
		}
	}

	/**
	 * Creates a new WP_Translation_File instance for a given file.
	 *
	 * @since 6.5.0
	 *
	 * @param string $file     Source file name.
	 * @param string $filetype Desired target file type.
	 * @return string|false Transformed translation file contents on success, false otherwise.
	 */
	public static function transform( string $file, string $filetype ) {
		$source = self::create( $file );

		if ( false === $source ) {
			return false;
		}

		switch ( $filetype ) {
			case 'mo':
				$destination = new WP_Translation_File_MO( '' );
				break;
			case 'php':
				$destination = new WP_Translation_File_PHP( '' );
				break;
			default:
				return false;
		}

		$success = $destination-&gt;import( $source );

		if ( ! $success ) {
			return false;
		}

		return $destination-&gt;export();
	}

	/**
	 * Returns all headers.
	 *
	 * @since 6.5.0
	 *
	 * @return array&lt;string, string&gt; Headers.
	 */
	public function headers(): array {
		if ( ! $this-&gt;parsed ) {
			$this-&gt;parse_file();
		}
		return $this-&gt;headers;
	}

	/**
	 * Returns all entries.
	 *
	 * @since 6.5.0
	 *
	 * @return array&lt;string, string[]&gt; Entries.
	 */
	public function entries(): array {
		if ( ! $this-&gt;parsed ) {
			$this-&gt;parse_file();
		}

		return $this-&gt;entries;
	}

	/**
	 * Returns the current error information.
	 *
	 * @since 6.5.0
	 *
	 * @return string|null Error message or null if no error.
	 */
	public function error() {
		return $this-&gt;error;
	}

	/**
	 * Returns the file name.
	 *
	 * @since 6.5.0
	 *
	 * @return string File name.
	 */
	public function get_file(): string {
		return $this-&gt;file;
	}

	/**
	 * Translates a given string.
	 *
	 * @since 6.5.0
	 *
	 * @param string $text String to translate.
	 * @return false|string Translation(s) on success, false otherwise.
	 */
	public function translate( string $text ) {
		if ( ! $this-&gt;parsed ) {
			$this-&gt;parse_file();
		}

		return $this-&gt;entries[ $text ] ?? false;
	}

	/**
	 * Returns the plural form for a given number.
	 *
	 * @since 6.5.0
	 *
	 * @param int $number Count.
	 * @return int Plural form.
	 */
	public function get_plural_form( int $number ): int {
		if ( ! $this-&gt;parsed ) {
			$this-&gt;parse_file();
		}

		if ( null === $this-&gt;plural_forms &amp;&amp; isset( $this-&gt;headers['plural-forms'] ) ) {
			$expression         = $this-&gt;get_plural_expression_from_header( $this-&gt;headers['plural-forms'] );
			$this-&gt;plural_forms = $this-&gt;make_plural_form_function( $expression );
		}

		if ( is_callable( $this-&gt;plural_forms ) ) {
			/**
			 * Plural form.
			 *
			 * @var int $result Plural form.
			 */
			$result = call_user_func( $this-&gt;plural_forms, $number );

			return $result;
		}

		// Default plural form matches English, only "One" is considered singular.
		return ( 1 === $number ? 0 : 1 );
	}

	/**
	 * Returns the plural forms expression as a tuple.
	 *
	 * @since 6.5.0
	 *
	 * @param string $header Plural-Forms header string.
	 * @return string Plural forms expression.
	 */
	protected function get_plural_expression_from_header( string $header ): string {
		if ( preg_match( '/^\s*nplurals\s*=\s*(\d+)\s*;\s+plural\s*=\s*(.+)$/', $header, $matches ) ) {
			return trim( $matches[2] );
		}

		return 'n != 1';
	}

	/**
	 * Makes a function, which will return the right translation index, according to the
	 * plural forms header.
	 *
	 * @since 6.5.0
	 *
	 * @param string $expression Plural form expression.
	 * @return callable(int $num): int Plural forms function.
	 */
	protected function make_plural_form_function( string $expression ): callable {
		try {
			$handler = new Plural_Forms( rtrim( $expression, ';' ) );
			return array( $handler, 'get' );
		} catch ( Exception $e ) {
			// Fall back to default plural-form function.
			return $this-&gt;make_plural_form_function( 'n != 1' );
		}
	}

	/**
	 * Imports translations from another file.
	 *
	 * @since 6.5.0
	 *
	 * @param WP_Translation_File $source Source file.
	 * @return bool True on success, false otherwise.
	 */
	protected function import( WP_Translation_File $source ): bool {
		if ( null !== $source-&gt;error() ) {
			return false;
		}

		$this-&gt;headers = $source-&gt;headers();
		$this-&gt;entries = $source-&gt;entries();
		$this-&gt;error   = $source-&gt;error();

		return null === $this-&gt;error;
	}

	/**
	 * Parses the file.
	 *
	 * @since 6.5.0
	 */
	abstract protected function parse_file();

	/**
	 * Exports translation contents as a string.
	 *
	 * @since 6.5.0
	 *
	 * @return string Translation file contents.
	 */
	abstract public function export();
}
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/l10n/class-wp-translation-file.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/l10n/class-wp-translation-file.php#L15">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/l10n/class-wp-translation-file.php#L15-L312">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-related" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="related" tabindex="-1"><a href="#related">Related</a></h2> <section class="wp-block-wporg-code-table" id="used-by" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Used by</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file_mo/">WP_Translation_File_MO</a><code>wp-includes/l10n/class-wp-translation-file-mo.php</code></td><td><p>Class <a href="https://developer.notmatt.press/reference/classes/wp_translation_file_mo/" rel="class">WP_Translation_File_MO</a>.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_file_php/">WP_Translation_File_PHP</a><code>wp-includes/l10n/class-wp-translation-file-php.php</code></td><td><p>Class <a href="https://developer.notmatt.press/reference/classes/wp_translation_file_php/" rel="class">WP_Translation_File_PHP</a>.</p>
</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.5.0/">6.5.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
