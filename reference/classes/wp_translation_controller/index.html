
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/classes/">Classes</a></span><span class="is-current-page">WP_Translation_Controller</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>WP_Translation_Controller</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="keyword">class</span> WP_Translation_Controller {}</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Class <a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/" rel="class">WP_Translation_Controller</a>.</p>
</section>
<section class="wp-block-wporg-code-reference-methods"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="methods" tabindex="-1"><a href="#methods">Methods</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Name</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/get_entries/">WP_Translation_Controller::get_entries</a></td><td>Returns all entries for a given text domain.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/get_files/">WP_Translation_Controller::get_files</a></td><td>Returns all translation files for a given text domain.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/get_headers/">WP_Translation_Controller::get_headers</a></td><td>Returns all existing headers for a given text domain.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/get_instance/">WP_Translation_Controller::get_instance</a></td><td>Utility method to retrieve the main instance of the class.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/get_locale/">WP_Translation_Controller::get_locale</a></td><td>Returns the current locale.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/is_textdomain_loaded/">WP_Translation_Controller::is_textdomain_loaded</a></td><td>Determines whether translations are loaded for a given text domain.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/load_file/">WP_Translation_Controller::load_file</a></td><td>Loads a translation file for a given text domain.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/locate_translation/">WP_Translation_Controller::locate_translation</a></td><td>Locates translation for a given string and text domain.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/normalize_header/">WP_Translation_Controller::normalize_header</a></td><td>Normalizes header names to be capitalized.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/set_locale/">WP_Translation_Controller::set_locale</a></td><td>Sets the current locale.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/translate/">WP_Translation_Controller::translate</a></td><td>Translates a singular string.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/translate_plural/">WP_Translation_Controller::translate_plural</a></td><td>Translates plurals.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/unload_file/">WP_Translation_Controller::unload_file</a></td><td>Unloads a translation file for a given text domain.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_translation_controller/unload_textdomain/">WP_Translation_Controller::unload_textdomain</a></td><td>Unloads all translation files for a given text domain.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="15"><code class="language-php line-numbers" id="wporg-source-code" lang="php">final class WP_Translation_Controller {
	/**
	 * Current locale.
	 *
	 * @since 6.5.0
	 * @var string
	 */
	protected $current_locale = 'en_US';

	/**
	 * Map of loaded translations per locale and text domain.
	 *
	 * [ Locale =&gt; [ Textdomain =&gt; [ ..., ... ] ] ]
	 *
	 * @since 6.5.0
	 * @var array&lt;string, array&lt;string, WP_Translation_File[]&gt;&gt;
	 */
	protected $loaded_translations = array();

	/**
	 * List of loaded translation files.
	 *
	 * [ Filename =&gt; [ Locale =&gt; [ Textdomain =&gt; WP_Translation_File ] ] ]
	 *
	 * @since 6.5.0
	 * @var array&lt;string, array&lt;string, array&lt;string, WP_Translation_File|false&gt;&gt;&gt;
	 */
	protected $loaded_files = array();

	/**
	 * Container for the main instance of the class.
	 *
	 * @since 6.5.0
	 * @var WP_Translation_Controller|null
	 */
	private static $instance = null;

	/**
	 * Utility method to retrieve the main instance of the class.
	 *
	 * The instance will be created if it does not exist yet.
	 *
	 * @since 6.5.0
	 *
	 * @return WP_Translation_Controller
	 */
	public static function get_instance(): WP_Translation_Controller {
		if ( null === self::$instance ) {
			self::$instance = new self();
		}

		return self::$instance;
	}

	/**
	 * Returns the current locale.
	 *
	 * @since 6.5.0
	 *
	 * @return string Locale.
	 */
	public function get_locale(): string {
		return $this-&gt;current_locale;
	}

	/**
	 * Sets the current locale.
	 *
	 * @since 6.5.0
	 *
	 * @param string $locale Locale.
	 */
	public function set_locale( string $locale ) {
		$this-&gt;current_locale = $locale;
	}

	/**
	 * Loads a translation file for a given text domain.
	 *
	 * @since 6.5.0
	 *
	 * @param string $translation_file Translation file.
	 * @param string $textdomain       Optional. Text domain. Default 'default'.
	 * @param string $locale           Optional. Locale. Default current locale.
	 * @return bool True on success, false otherwise.
	 */
	public function load_file( string $translation_file, string $textdomain = 'default', ?string $locale = null ): bool {
		if ( null === $locale ) {
			$locale = $this-&gt;current_locale;
		}

		$translation_file = realpath( $translation_file );

		if ( false === $translation_file ) {
			return false;
		}

		if (
			isset( $this-&gt;loaded_files[ $translation_file ][ $locale ][ $textdomain ] ) &amp;&amp;
			false !== $this-&gt;loaded_files[ $translation_file ][ $locale ][ $textdomain ]
		) {
			return null === $this-&gt;loaded_files[ $translation_file ][ $locale ][ $textdomain ]-&gt;error();
		}

		if (
			isset( $this-&gt;loaded_files[ $translation_file ][ $locale ] ) &amp;&amp;
			array() !== $this-&gt;loaded_files[ $translation_file ][ $locale ]
		) {
			$moe = reset( $this-&gt;loaded_files[ $translation_file ][ $locale ] );
		} else {
			$moe = WP_Translation_File::create( $translation_file );
			if ( false === $moe || null !== $moe-&gt;error() ) {
				$moe = false;
			}
		}

		$this-&gt;loaded_files[ $translation_file ][ $locale ][ $textdomain ] = $moe;

		if ( ! $moe instanceof WP_Translation_File ) {
			return false;
		}

		if ( ! isset( $this-&gt;loaded_translations[ $locale ][ $textdomain ] ) ) {
			$this-&gt;loaded_translations[ $locale ][ $textdomain ] = array();
		}

		$this-&gt;loaded_translations[ $locale ][ $textdomain ][] = $moe;

		return true;
	}

	/**
	 * Unloads a translation file for a given text domain.
	 *
	 * @since 6.5.0
	 *
	 * @param WP_Translation_File|string $file       Translation file instance or file name.
	 * @param string                     $textdomain Optional. Text domain. Default 'default'.
	 * @param string                     $locale     Optional. Locale. Defaults to all locales.
	 * @return bool True on success, false otherwise.
	 */
	public function unload_file( $file, string $textdomain = 'default', ?string $locale = null ): bool {
		if ( is_string( $file ) ) {
			$file = realpath( $file );
		}

		if ( null !== $locale ) {
			if ( isset( $this-&gt;loaded_translations[ $locale ][ $textdomain ] ) ) {
				foreach ( $this-&gt;loaded_translations[ $locale ][ $textdomain ] as $i =&gt; $moe ) {
					if ( $file === $moe || $file === $moe-&gt;get_file() ) {
						unset( $this-&gt;loaded_translations[ $locale ][ $textdomain ][ $i ] );
						unset( $this-&gt;loaded_files[ $moe-&gt;get_file() ][ $locale ][ $textdomain ] );
						return true;
					}
				}
			}

			return true;
		}

		foreach ( $this-&gt;loaded_translations as $l =&gt; $domains ) {
			if ( ! isset( $domains[ $textdomain ] ) ) {
				continue;
			}

			foreach ( $domains[ $textdomain ] as $i =&gt; $moe ) {
				if ( $file === $moe || $file === $moe-&gt;get_file() ) {
					unset( $this-&gt;loaded_translations[ $l ][ $textdomain ][ $i ] );
					unset( $this-&gt;loaded_files[ $moe-&gt;get_file() ][ $l ][ $textdomain ] );
					return true;
				}
			}
		}

		return false;
	}

	/**
	 * Unloads all translation files for a given text domain.
	 *
	 * @since 6.5.0
	 *
	 * @param string $textdomain Optional. Text domain. Default 'default'.
	 * @param string $locale     Optional. Locale. Defaults to all locales.
	 * @return bool True on success, false otherwise.
	 */
	public function unload_textdomain( string $textdomain = 'default', ?string $locale = null ): bool {
		$unloaded = false;

		if ( null !== $locale ) {
			if ( isset( $this-&gt;loaded_translations[ $locale ][ $textdomain ] ) ) {
				$unloaded = true;
				foreach ( $this-&gt;loaded_translations[ $locale ][ $textdomain ] as $moe ) {
					unset( $this-&gt;loaded_files[ $moe-&gt;get_file() ][ $locale ][ $textdomain ] );
				}
			}

			unset( $this-&gt;loaded_translations[ $locale ][ $textdomain ] );

			return $unloaded;
		}

		foreach ( $this-&gt;loaded_translations as $l =&gt; $domains ) {
			if ( ! isset( $domains[ $textdomain ] ) ) {
				continue;
			}

			$unloaded = true;

			foreach ( $domains[ $textdomain ] as $moe ) {
				unset( $this-&gt;loaded_files[ $moe-&gt;get_file() ][ $l ][ $textdomain ] );
			}

			unset( $this-&gt;loaded_translations[ $l ][ $textdomain ] );
		}

		return $unloaded;
	}

	/**
	 * Determines whether translations are loaded for a given text domain.
	 *
	 * @since 6.5.0
	 *
	 * @param string $textdomain Optional. Text domain. Default 'default'.
	 * @param string $locale     Optional. Locale. Default current locale.
	 * @return bool True if there are any loaded translations, false otherwise.
	 */
	public function is_textdomain_loaded( string $textdomain = 'default', ?string $locale = null ): bool {
		if ( null === $locale ) {
			$locale = $this-&gt;current_locale;
		}

		return isset( $this-&gt;loaded_translations[ $locale ][ $textdomain ] ) &amp;&amp;
			array() !== $this-&gt;loaded_translations[ $locale ][ $textdomain ];
	}

	/**
	 * Translates a singular string.
	 *
	 * @since 6.5.0
	 *
	 * @param string $text       Text to translate.
	 * @param string $context    Optional. Context for the string. Default empty string.
	 * @param string $textdomain Optional. Text domain. Default 'default'.
	 * @param string $locale     Optional. Locale. Default current locale.
	 * @return string|false Translation on success, false otherwise.
	 */
	public function translate( string $text, string $context = '', string $textdomain = 'default', ?string $locale = null ) {
		if ( '' !== $context ) {
			$context .= "\4";
		}

		$translation = $this-&gt;locate_translation( "{$context}{$text}", $textdomain, $locale );

		if ( false === $translation ) {
			return false;
		}

		return $translation['entries'][0];
	}

	/**
	 * Translates plurals.
	 *
	 * Checks both singular+plural combinations as well as just singulars,
	 * in case the translation file does not store the plural.
	 *
	 * @since 6.5.0
	 *
	 * @param array       $plurals {
	 *     Pair of singular and plural translations.
	 *
	 *     @type string $0 Singular translation.
	 *     @type string $1 Plural translation.
	 * }
	 * @param int         $number     Number of items.
	 * @param string      $context    Optional. Context for the string. Default empty string.
	 * @param string      $textdomain Optional. Text domain. Default 'default'.
	 * @param string|null $locale     Optional. Locale. Default current locale.
	 * @return string|false Translation on success, false otherwise.
	 */
	public function translate_plural( array $plurals, int $number, string $context = '', string $textdomain = 'default', ?string $locale = null ) {
		if ( '' !== $context ) {
			$context .= "\4";
		}

		$text        = implode( "\0", $plurals );
		$translation = $this-&gt;locate_translation( "{$context}{$text}", $textdomain, $locale );

		if ( false === $translation ) {
			$text        = $plurals[0];
			$translation = $this-&gt;locate_translation( "{$context}{$text}", $textdomain, $locale );

			if ( false === $translation ) {
				return false;
			}
		}

		/** @var WP_Translation_File $source */
		$source = $translation['source'];
		$num    = $source-&gt;get_plural_form( $number );

		// See \Translations::translate_plural().
		return $translation['entries'][ $num ] ?? $translation['entries'][0];
	}

	/**
	 * Returns all existing headers for a given text domain.
	 *
	 * @since 6.5.0
	 *
	 * @param string $textdomain Optional. Text domain. Default 'default'.
	 * @return array&lt;string, string&gt; Headers.
	 */
	public function get_headers( string $textdomain = 'default' ): array {
		if ( array() === $this-&gt;loaded_translations ) {
			return array();
		}

		$headers = array();

		foreach ( $this-&gt;get_files( $textdomain ) as $moe ) {
			foreach ( $moe-&gt;headers() as $header =&gt; $value ) {
				$headers[ $this-&gt;normalize_header( $header ) ] = $value;
			}
		}

		return $headers;
	}

	/**
	 * Normalizes header names to be capitalized.
	 *
	 * @since 6.5.0
	 *
	 * @param string $header Header name.
	 * @return string Normalized header name.
	 */
	protected function normalize_header( string $header ): string {
		$parts = explode( '-', $header );
		$parts = array_map( 'ucfirst', $parts );
		return implode( '-', $parts );
	}

	/**
	 * Returns all entries for a given text domain.
	 *
	 * @since 6.5.0
	 *
	 * @param string $textdomain Optional. Text domain. Default 'default'.
	 * @return array&lt;string, string&gt; Entries.
	 */
	public function get_entries( string $textdomain = 'default' ): array {
		if ( array() === $this-&gt;loaded_translations ) {
			return array();
		}

		$entries = array();

		foreach ( $this-&gt;get_files( $textdomain ) as $moe ) {
			$entries = array_merge( $entries, $moe-&gt;entries() );
		}

		return $entries;
	}

	/**
	 * Locates translation for a given string and text domain.
	 *
	 * @since 6.5.0
	 *
	 * @param string $singular   Singular translation.
	 * @param string $textdomain Optional. Text domain. Default 'default'.
	 * @param string $locale     Optional. Locale. Default current locale.
	 * @return array{source: WP_Translation_File, entries: string[]}|false {
	 *     Translations on success, false otherwise.
	 *
	 *     @type WP_Translation_File $source Translation file instance.
	 *     @type string[]            $entries Array of translation entries.
	 * }
	 */
	protected function locate_translation( string $singular, string $textdomain = 'default', ?string $locale = null ) {
		if ( array() === $this-&gt;loaded_translations ) {
			return false;
		}

		// Find the translation in all loaded files for this text domain.
		foreach ( $this-&gt;get_files( $textdomain, $locale ) as $moe ) {
			$translation = $moe-&gt;translate( $singular );
			if ( false !== $translation ) {
				return array(
					'entries' =&gt; explode( "\0", $translation ),
					'source'  =&gt; $moe,
				);
			}
			if ( null !== $moe-&gt;error() ) {
				// Unload this file, something is wrong.
				$this-&gt;unload_file( $moe, $textdomain, $locale );
			}
		}

		// Nothing could be found.
		return false;
	}

	/**
	 * Returns all translation files for a given text domain.
	 *
	 * @since 6.5.0
	 *
	 * @param string $textdomain Optional. Text domain. Default 'default'.
	 * @param string $locale     Optional. Locale. Default current locale.
	 * @return WP_Translation_File[] List of translation files.
	 */
	protected function get_files( string $textdomain = 'default', ?string $locale = null ): array {
		if ( null === $locale ) {
			$locale = $this-&gt;current_locale;
		}

		return $this-&gt;loaded_translations[ $locale ][ $textdomain ] ?? array();
	}

</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/l10n/class-wp-translation-controller.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/l10n/class-wp-translation-controller.php#L15">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/l10n/class-wp-translation-controller.php#L15-L437">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.5.0/">6.5.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
