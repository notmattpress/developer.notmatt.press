
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/classes/">Classes</a></span><span class="is-current-page">WP_Style_Engine</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>WP_Style_Engine</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="keyword">class</span> WP_Style_Engine {}</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>The main class integrating all other WP_Style_Engine_* classes.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>The Style Engine aims to provide a consistent API for rendering styling for blocks across both client-side and server-side applications.</p>
<p>This class is final and should not be extended.</p>
<p>This class is for internal Core usage and is not supposed to be used by extenders (plugins and/or themes). This is a low-level API that may need to do breaking changes.<br/>Please, use <a href="https://developer.notmatt.press/reference/functions/wp_style_engine_get_styles/" rel="function">wp_style_engine_get_styles()</a>  instead.</p>
</section>
<section class="wp-block-wporg-code-reference-methods"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="methods" tabindex="-1"><a href="#methods">Methods</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Name</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/compile_css/">WP_Style_Engine::compile_css</a></td><td>Returns compiled CSS from CSS declarations.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/compile_stylesheet_from_css_rules/">WP_Style_Engine::compile_stylesheet_from_css_rules</a></td><td>Returns a compiled stylesheet from stored CSS rules.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/get_classnames/">WP_Style_Engine::get_classnames</a></td><td>Returns classnames, and generates classname(s) from a CSS preset property pattern, e.g. `var:preset||`.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/get_css_declarations/">WP_Style_Engine::get_css_declarations</a></td><td>Returns an array of CSS declarations based on valid block style values.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/get_css_var_value/">WP_Style_Engine::get_css_var_value</a></td><td>Util: Generates a CSS var string, e.g. `var(–wp–preset–color–background)` from a preset string such as `var:preset|space|50`.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/get_individual_property_css_declarations/">WP_Style_Engine::get_individual_property_css_declarations</a></td><td>Style value parser that returns a CSS definition array comprising style properties that have keys representing individual style properties, otherwise known as longhand CSS properties.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/get_slug_from_preset_value/">WP_Style_Engine::get_slug_from_preset_value</a></td><td>Util: Extracts the slug in kebab case from a preset string, e.g. `heavenly-blue` from `var:preset|color|heavenlyBlue`.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/get_store/">WP_Style_Engine::get_store</a></td><td>Returns a store by store key.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/get_url_or_value_css_declaration/">WP_Style_Engine::get_url_or_value_css_declaration</a></td><td>Style value parser that constructs a CSS definition array comprising a single CSS property and value.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/is_valid_style_value/">WP_Style_Engine::is_valid_style_value</a></td><td>Util: Checks whether an incoming block style value is valid.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/parse_block_styles/">WP_Style_Engine::parse_block_styles</a></td><td>Returns classnames and CSS based on the values in a styles object.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_style_engine/store_css_rule/">WP_Style_Engine::store_css_rule</a></td><td>Stores a CSS rule using the provided CSS selector and CSS declarations.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="31"><code class="language-php line-numbers" id="wporg-source-code" lang="php">final class WP_Style_Engine {
	/**
	 * Style definitions that contain the instructions to parse/output valid Gutenberg styles from a block's attributes.
	 *
	 * For every style definition, the following properties are valid:
	 *
	 *  - classnames    =&gt; (array) an array of classnames to be returned for block styles. The key is a classname or pattern.
	 *                    A value of `true` means the classname should be applied always. Otherwise, a valid CSS property (string)
	 *                    to match the incoming value, e.g., "color" to match var:preset|color|somePresetSlug.
	 *  - css_vars      =&gt; (array) an array of key value pairs used to generate CSS var values.
	 *                     The key should be the CSS property name that matches the second element of the preset string value,
	 *                     i.e., "color" in var:preset|color|somePresetSlug. The value is a CSS var pattern (e.g. `--wp--preset--color--$slug`),
	 *                     whose `$slug` fragment will be replaced with the preset slug, which is the third element of the preset string value,
	 *                     i.e., `somePresetSlug` in var:preset|color|somePresetSlug.
	 *  - property_keys =&gt; (array) array of keys whose values represent a valid CSS property, e.g., "margin" or "border".
	 *  - path          =&gt; (array) a path that accesses the corresponding style value in the block style object.
	 *  - value_func    =&gt; (string) the name of a function to generate a CSS definition array for a particular style object. The output of this function should be `array( "$property" =&gt; "$value", ... )`.
	 *
	 * @since 6.1.0
	 * @var array
	 */
	const BLOCK_STYLE_DEFINITIONS_METADATA = array(
		'background' =&gt; array(
			'backgroundImage'      =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'background-image',
				),
				'value_func'    =&gt; array( self::class, 'get_url_or_value_css_declaration' ),
				'path'          =&gt; array( 'background', 'backgroundImage' ),
			),
			'backgroundPosition'   =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'background-position',
				),
				'path'          =&gt; array( 'background', 'backgroundPosition' ),
			),
			'backgroundRepeat'     =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'background-repeat',
				),
				'path'          =&gt; array( 'background', 'backgroundRepeat' ),
			),
			'backgroundSize'       =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'background-size',
				),
				'path'          =&gt; array( 'background', 'backgroundSize' ),
			),
			'backgroundAttachment' =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'background-attachment',
				),
				'path'          =&gt; array( 'background', 'backgroundAttachment' ),
			),
		),
		'color'      =&gt; array(
			'text'       =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'color',
				),
				'path'          =&gt; array( 'color', 'text' ),
				'css_vars'      =&gt; array(
					'color' =&gt; '--wp--preset--color--$slug',
				),
				'classnames'    =&gt; array(
					'has-text-color'  =&gt; true,
					'has-$slug-color' =&gt; 'color',
				),
			),
			'background' =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'background-color',
				),
				'path'          =&gt; array( 'color', 'background' ),
				'css_vars'      =&gt; array(
					'color' =&gt; '--wp--preset--color--$slug',
				),
				'classnames'    =&gt; array(
					'has-background'             =&gt; true,
					'has-$slug-background-color' =&gt; 'color',
				),
			),
			'gradient'   =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'background',
				),
				'path'          =&gt; array( 'color', 'gradient' ),
				'css_vars'      =&gt; array(
					'gradient' =&gt; '--wp--preset--gradient--$slug',
				),
				'classnames'    =&gt; array(
					'has-background'                =&gt; true,
					'has-$slug-gradient-background' =&gt; 'gradient',
				),
			),
		),
		'border'     =&gt; array(
			'color'  =&gt; array(
				'property_keys' =&gt; array(
					'default'    =&gt; 'border-color',
					'individual' =&gt; 'border-%s-color',
				),
				'path'          =&gt; array( 'border', 'color' ),
				'classnames'    =&gt; array(
					'has-border-color'       =&gt; true,
					'has-$slug-border-color' =&gt; 'color',
				),
			),
			'radius' =&gt; array(
				'property_keys' =&gt; array(
					'default'    =&gt; 'border-radius',
					'individual' =&gt; 'border-%s-radius',
				),
				'path'          =&gt; array( 'border', 'radius' ),
			),
			'style'  =&gt; array(
				'property_keys' =&gt; array(
					'default'    =&gt; 'border-style',
					'individual' =&gt; 'border-%s-style',
				),
				'path'          =&gt; array( 'border', 'style' ),
			),
			'width'  =&gt; array(
				'property_keys' =&gt; array(
					'default'    =&gt; 'border-width',
					'individual' =&gt; 'border-%s-width',
				),
				'path'          =&gt; array( 'border', 'width' ),
			),
			'top'    =&gt; array(
				'value_func' =&gt; array( self::class, 'get_individual_property_css_declarations' ),
				'path'       =&gt; array( 'border', 'top' ),
				'css_vars'   =&gt; array(
					'color' =&gt; '--wp--preset--color--$slug',
				),
			),
			'right'  =&gt; array(
				'value_func' =&gt; array( self::class, 'get_individual_property_css_declarations' ),
				'path'       =&gt; array( 'border', 'right' ),
				'css_vars'   =&gt; array(
					'color' =&gt; '--wp--preset--color--$slug',
				),
			),
			'bottom' =&gt; array(
				'value_func' =&gt; array( self::class, 'get_individual_property_css_declarations' ),
				'path'       =&gt; array( 'border', 'bottom' ),
				'css_vars'   =&gt; array(
					'color' =&gt; '--wp--preset--color--$slug',
				),
			),
			'left'   =&gt; array(
				'value_func' =&gt; array( self::class, 'get_individual_property_css_declarations' ),
				'path'       =&gt; array( 'border', 'left' ),
				'css_vars'   =&gt; array(
					'color' =&gt; '--wp--preset--color--$slug',
				),
			),
		),
		'shadow'     =&gt; array(
			'shadow' =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'box-shadow',
				),
				'path'          =&gt; array( 'shadow' ),
				'css_vars'      =&gt; array(
					'shadow' =&gt; '--wp--preset--shadow--$slug',
				),
			),
		),
		'dimensions' =&gt; array(
			'aspectRatio' =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'aspect-ratio',
				),
				'path'          =&gt; array( 'dimensions', 'aspectRatio' ),
				'classnames'    =&gt; array(
					'has-aspect-ratio' =&gt; true,
				),
			),
			'minHeight'   =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'min-height',
				),
				'path'          =&gt; array( 'dimensions', 'minHeight' ),
				'css_vars'      =&gt; array(
					'spacing' =&gt; '--wp--preset--spacing--$slug',
				),
			),
		),
		'spacing'    =&gt; array(
			'padding' =&gt; array(
				'property_keys' =&gt; array(
					'default'    =&gt; 'padding',
					'individual' =&gt; 'padding-%s',
				),
				'path'          =&gt; array( 'spacing', 'padding' ),
				'css_vars'      =&gt; array(
					'spacing' =&gt; '--wp--preset--spacing--$slug',
				),
			),
			'margin'  =&gt; array(
				'property_keys' =&gt; array(
					'default'    =&gt; 'margin',
					'individual' =&gt; 'margin-%s',
				),
				'path'          =&gt; array( 'spacing', 'margin' ),
				'css_vars'      =&gt; array(
					'spacing' =&gt; '--wp--preset--spacing--$slug',
				),
			),
		),
		'typography' =&gt; array(
			'fontSize'       =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'font-size',
				),
				'path'          =&gt; array( 'typography', 'fontSize' ),
				'css_vars'      =&gt; array(
					'font-size' =&gt; '--wp--preset--font-size--$slug',
				),
				'classnames'    =&gt; array(
					'has-$slug-font-size' =&gt; 'font-size',
				),
			),
			'fontFamily'     =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'font-family',
				),
				'css_vars'      =&gt; array(
					'font-family' =&gt; '--wp--preset--font-family--$slug',
				),
				'path'          =&gt; array( 'typography', 'fontFamily' ),
				'classnames'    =&gt; array(
					'has-$slug-font-family' =&gt; 'font-family',
				),
			),
			'fontStyle'      =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'font-style',
				),
				'path'          =&gt; array( 'typography', 'fontStyle' ),
			),
			'fontWeight'     =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'font-weight',
				),
				'path'          =&gt; array( 'typography', 'fontWeight' ),
			),
			'lineHeight'     =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'line-height',
				),
				'path'          =&gt; array( 'typography', 'lineHeight' ),
			),
			'textColumns'    =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'column-count',
				),
				'path'          =&gt; array( 'typography', 'textColumns' ),
			),
			'textDecoration' =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'text-decoration',
				),
				'path'          =&gt; array( 'typography', 'textDecoration' ),
			),
			'textTransform'  =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'text-transform',
				),
				'path'          =&gt; array( 'typography', 'textTransform' ),
			),
			'letterSpacing'  =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'letter-spacing',
				),
				'path'          =&gt; array( 'typography', 'letterSpacing' ),
			),
			'writingMode'    =&gt; array(
				'property_keys' =&gt; array(
					'default' =&gt; 'writing-mode',
				),
				'path'          =&gt; array( 'typography', 'writingMode' ),
			),
		),
	);

	/**
	 * Util: Extracts the slug in kebab case from a preset string,
	 * e.g. `heavenly-blue` from `var:preset|color|heavenlyBlue`.
	 *
	 * @since 6.1.0
	 *
	 * @param string $style_value  A single CSS preset value.
	 * @param string $property_key The CSS property that is the second element of the preset string.
	 *                             Used for matching.
	 * @return string The slug, or empty string if not found.
	 */
	protected static function get_slug_from_preset_value( $style_value, $property_key ) {
		if ( is_string( $style_value ) &amp;&amp; is_string( $property_key )
			&amp;&amp; str_contains( $style_value, "var:preset|{$property_key}|" )
		) {
			$index_to_splice = strrpos( $style_value, '|' ) + 1;
			return _wp_to_kebab_case( substr( $style_value, $index_to_splice ) );
		}
		return '';
	}

	/**
	 * Util: Generates a CSS var string, e.g. `var(--wp--preset--color--background)`
	 * from a preset string such as `var:preset|space|50`.
	 *
	 * @since 6.1.0
	 *
	 * @param string   $style_value  A single CSS preset value.
	 * @param string[] $css_vars     An associate array of CSS var patterns
	 *                               used to generate the var string.
	 * @return string The CSS var, or an empty string if no match for slug found.
	 */
	protected static function get_css_var_value( $style_value, $css_vars ) {
		foreach ( $css_vars as $property_key =&gt; $css_var_pattern ) {
			$slug = static::get_slug_from_preset_value( $style_value, $property_key );
			if ( static::is_valid_style_value( $slug ) ) {
				$var = strtr(
					$css_var_pattern,
					array( '$slug' =&gt; $slug )
				);
				return "var($var)";
			}
		}
		return '';
	}

	/**
	 * Util: Checks whether an incoming block style value is valid.
	 *
	 * @since 6.1.0
	 *
	 * @param string $style_value A single CSS preset value.
	 * @return bool
	 */
	protected static function is_valid_style_value( $style_value ) {
		return '0' === $style_value || ! empty( $style_value );
	}

	/**
	 * Stores a CSS rule using the provided CSS selector and CSS declarations.
	 *
	 * @since 6.1.0
	 * @since 6.6.0 Added the `$rules_group` parameter.
	 *
	 * @param string   $store_name       A valid store key.
	 * @param string   $css_selector     When a selector is passed, the function will return
	 *                                   a full CSS rule `$selector { ...rules }`
	 *                                   otherwise a concatenated string of properties and values.
	 * @param string[] $css_declarations An associative array of CSS definitions,
	 *                                   e.g. `array( "$property" =&gt; "$value", "$property" =&gt; "$value" )`.
	 * @param string $rules_group        Optional. A parent CSS selector in the case of nested CSS, or a CSS nested @rule,
	 *                                   such as `@media (min-width: 80rem)` or `@layer module`.
	 */
	public static function store_css_rule( $store_name, $css_selector, $css_declarations, $rules_group = '' ) {
		if ( empty( $store_name ) || empty( $css_selector ) || empty( $css_declarations ) ) {
			return;
		}
		static::get_store( $store_name )-&gt;add_rule( $css_selector, $rules_group )-&gt;add_declarations( $css_declarations );
	}

	/**
	 * Returns a store by store key.
	 *
	 * @since 6.1.0
	 *
	 * @param string $store_name A store key.
	 * @return WP_Style_Engine_CSS_Rules_Store|null
	 */
	public static function get_store( $store_name ) {
		return WP_Style_Engine_CSS_Rules_Store::get_store( $store_name );
	}

	/**
	 * Returns classnames and CSS based on the values in a styles object.
	 *
	 * Return values are parsed based on the instructions in BLOCK_STYLE_DEFINITIONS_METADATA.
	 *
	 * @since 6.1.0
	 *
	 * @param array $block_styles The style object.
	 * @param array $options      {
	 *     Optional. An array of options. Default empty array.
	 *
	 *     @type bool        $convert_vars_to_classnames Whether to skip converting incoming CSS var patterns,
	 *                                                   e.g. `var:preset|&lt;PRESET_TYPE&gt;|&lt;PRESET_SLUG&gt;`,
	 *                                                   to `var( --wp--preset--* )` values. Default false.
	 *     @type string      $selector                   Optional. When a selector is passed,
	 *                                                   the value of `$css` in the return value will comprise
	 *                                                   a full CSS rule `$selector { ...$css_declarations }`,
	 *                                                   otherwise, the value will be a concatenated string
	 *                                                   of CSS declarations.
	 * }
	 * @return array {
	 *     @type string[] $classnames   Array of class names.
	 *     @type string[] $declarations An associative array of CSS definitions,
	 *                                  e.g. `array( "$property" =&gt; "$value", "$property" =&gt; "$value" )`.
	 * }
	 */
	public static function parse_block_styles( $block_styles, $options ) {
		$parsed_styles = array(
			'classnames'   =&gt; array(),
			'declarations' =&gt; array(),
		);
		if ( empty( $block_styles ) || ! is_array( $block_styles ) ) {
			return $parsed_styles;
		}

		// Collect CSS and classnames.
		foreach ( static::BLOCK_STYLE_DEFINITIONS_METADATA as $definition_group_key =&gt; $definition_group_style ) {
			if ( empty( $block_styles[ $definition_group_key ] ) ) {
				continue;
			}
			foreach ( $definition_group_style as $style_definition ) {
				$style_value = _wp_array_get( $block_styles, $style_definition['path'], null );

				if ( ! static::is_valid_style_value( $style_value ) ) {
					continue;
				}

				$parsed_styles['classnames']   = array_merge( $parsed_styles['classnames'], static::get_classnames( $style_value, $style_definition ) );
				$parsed_styles['declarations'] = array_merge( $parsed_styles['declarations'], static::get_css_declarations( $style_value, $style_definition, $options ) );
			}
		}

		return $parsed_styles;
	}

	/**
	 * Returns classnames, and generates classname(s) from a CSS preset property pattern,
	 * e.g. `var:preset|&lt;PRESET_TYPE&gt;|&lt;PRESET_SLUG&gt;`.
	 *
	 * @since 6.1.0
	 *
	 * @param string $style_value      A single raw style value or CSS preset property
	 *                                 from the `$block_styles` array.
	 * @param array  $style_definition A single style definition from BLOCK_STYLE_DEFINITIONS_METADATA.
	 * @return string[] An array of CSS classnames, or empty array if there are none.
	 */
	protected static function get_classnames( $style_value, $style_definition ) {
		if ( empty( $style_value ) ) {
			return array();
		}

		$classnames = array();
		if ( ! empty( $style_definition['classnames'] ) ) {
			foreach ( $style_definition['classnames'] as $classname =&gt; $property_key ) {
				if ( true === $property_key ) {
					$classnames[] = $classname;
					continue;
				}

				$slug = static::get_slug_from_preset_value( $style_value, $property_key );

				if ( $slug ) {
					/*
					 * Right now we expect a classname pattern to be stored in BLOCK_STYLE_DEFINITIONS_METADATA.
					 * One day, if there are no stored schemata, we could allow custom patterns or
					 * generate classnames based on other properties
					 * such as a path or a value or a prefix passed in options.
					 */
					$classnames[] = strtr( $classname, array( '$slug' =&gt; $slug ) );
				}
			}
		}

		return $classnames;
	}

	/**
	 * Returns an array of CSS declarations based on valid block style values.
	 *
	 * @since 6.1.0
	 *
	 * @param mixed $style_value      A single raw style value from $block_styles array.
	 * @param array $style_definition A single style definition from BLOCK_STYLE_DEFINITIONS_METADATA.
	 * @param array $options          {
	 *     Optional. An array of options. Default empty array.
	 *
	 *     @type bool $convert_vars_to_classnames Whether to skip converting incoming CSS var patterns,
	 *                                            e.g. `var:preset|&lt;PRESET_TYPE&gt;|&lt;PRESET_SLUG&gt;`,
	 *                                            to `var( --wp--preset--* )` values. Default false.
	 * }
	 * @return string[] An associative array of CSS definitions, e.g. `array( "$property" =&gt; "$value", "$property" =&gt; "$value" )`.
	 */
	protected static function get_css_declarations( $style_value, $style_definition, $options = array() ) {
		if ( isset( $style_definition['value_func'] ) &amp;&amp; is_callable( $style_definition['value_func'] ) ) {
			return call_user_func( $style_definition['value_func'], $style_value, $style_definition, $options );
		}

		$css_declarations     = array();
		$style_property_keys  = $style_definition['property_keys'];
		$should_skip_css_vars = isset( $options['convert_vars_to_classnames'] ) &amp;&amp; true === $options['convert_vars_to_classnames'];

		/*
		 * Build CSS var values from `var:preset|&lt;PRESET_TYPE&gt;|&lt;PRESET_SLUG&gt;` values, e.g, `var(--wp--css--rule-slug )`.
		 * Check if the value is a CSS preset and there's a corresponding css_var pattern in the style definition.
		 */
		if ( is_string( $style_value ) &amp;&amp; str_contains( $style_value, 'var:' ) ) {
			if ( ! $should_skip_css_vars &amp;&amp; ! empty( $style_definition['css_vars'] ) ) {
				$css_var = static::get_css_var_value( $style_value, $style_definition['css_vars'] );
				if ( static::is_valid_style_value( $css_var ) ) {
					$css_declarations[ $style_property_keys['default'] ] = $css_var;
				}
			}
			return $css_declarations;
		}

		/*
		 * Default rule builder.
		 * If the input contains an array, assume box model-like properties
		 * for styles such as margins and padding.
		 */
		if ( is_array( $style_value ) ) {
			// Bail out early if the `'individual'` property is not defined.
			if ( ! isset( $style_property_keys['individual'] ) ) {
				return $css_declarations;
			}

			foreach ( $style_value as $key =&gt; $value ) {
				if ( is_string( $value ) &amp;&amp; str_contains( $value, 'var:' ) &amp;&amp; ! $should_skip_css_vars &amp;&amp; ! empty( $style_definition['css_vars'] ) ) {
					$value = static::get_css_var_value( $value, $style_definition['css_vars'] );
				}

				$individual_property = sprintf( $style_property_keys['individual'], _wp_to_kebab_case( $key ) );

				if ( $individual_property &amp;&amp; static::is_valid_style_value( $value ) ) {
					$css_declarations[ $individual_property ] = $value;
				}
			}

			return $css_declarations;
		}

		$css_declarations[ $style_property_keys['default'] ] = $style_value;
		return $css_declarations;
	}

	/**
	 * Style value parser that returns a CSS definition array comprising style properties
	 * that have keys representing individual style properties, otherwise known as longhand CSS properties.
	 *
	 * Example:
	 *
	 *     "$style_property-$individual_feature: $value;"
	 *
	 * Which could represent the following:
	 *
	 *     "border-{top|right|bottom|left}-{color|width|style}: {value};"
	 *
	 * or:
	 *
	 *     "border-image-{outset|source|width|repeat|slice}: {value};"
	 *
	 * @since 6.1.0
	 *
	 * @param array $style_value                    A single raw style value from `$block_styles` array.
	 * @param array $individual_property_definition A single style definition from BLOCK_STYLE_DEFINITIONS_METADATA
	 *                                              representing an individual property of a CSS property,
	 *                                              e.g. 'top' in 'border-top'.
	 * @param array $options                        {
	 *     Optional. An array of options. Default empty array.
	 *
	 *     @type bool $convert_vars_to_classnames Whether to skip converting incoming CSS var patterns,
	 *                                            e.g. `var:preset|&lt;PRESET_TYPE&gt;|&lt;PRESET_SLUG&gt;`,
	 *                                            to `var( --wp--preset--* )` values. Default false.
	 * }
	 * @return string[] An associative array of CSS definitions, e.g. `array( "$property" =&gt; "$value", "$property" =&gt; "$value" )`.
	 */
	protected static function get_individual_property_css_declarations( $style_value, $individual_property_definition, $options = array() ) {
		if ( ! is_array( $style_value ) || empty( $style_value ) || empty( $individual_property_definition['path'] ) ) {
			return array();
		}

		/*
		 * The first item in $individual_property_definition['path'] array
		 * tells us the style property, e.g. "border". We use this to get a corresponding
		 * CSS style definition such as "color" or "width" from the same group.
		 *
		 * The second item in $individual_property_definition['path'] array
		 * refers to the individual property marker, e.g. "top".
		 */
		$definition_group_key    = $individual_property_definition['path'][0];
		$individual_property_key = $individual_property_definition['path'][1];
		$should_skip_css_vars    = isset( $options['convert_vars_to_classnames'] ) &amp;&amp; true === $options['convert_vars_to_classnames'];
		$css_declarations        = array();

		foreach ( $style_value as $css_property =&gt; $value ) {
			if ( empty( $value ) ) {
				continue;
			}

			// Build a path to the individual rules in definitions.
			$style_definition_path = array( $definition_group_key, $css_property );
			$style_definition      = _wp_array_get( static::BLOCK_STYLE_DEFINITIONS_METADATA, $style_definition_path, null );

			if ( $style_definition &amp;&amp; isset( $style_definition['property_keys']['individual'] ) ) {
				// Set a CSS var if there is a valid preset value.
				if ( is_string( $value ) &amp;&amp; str_contains( $value, 'var:' )
					&amp;&amp; ! $should_skip_css_vars &amp;&amp; ! empty( $individual_property_definition['css_vars'] )
				) {
					$value = static::get_css_var_value( $value, $individual_property_definition['css_vars'] );
				}

				$individual_css_property = sprintf( $style_definition['property_keys']['individual'], $individual_property_key );

				$css_declarations[ $individual_css_property ] = $value;
			}
		}
		return $css_declarations;
	}

	/**
	 * Style value parser that constructs a CSS definition array comprising a single CSS property and value.
	 * If the provided value is an array containing a `url` property, the function will return a CSS definition array
	 * with a single property and value, with `url` escaped and injected into a CSS `url()` function,
	 * e.g., array( 'background-image' =&gt; "url( '...' )" ).
	 *
	 * @since 6.4.0
	 *
	 * @param array $style_value      A single raw style value from $block_styles array.
	 * @param array $style_definition A single style definition from BLOCK_STYLE_DEFINITIONS_METADATA.
	 * @return string[] An associative array of CSS definitions, e.g., array( "$property" =&gt; "$value", "$property" =&gt; "$value" ).
	 */
	protected static function get_url_or_value_css_declaration( $style_value, $style_definition ) {
		if ( empty( $style_value ) ) {
			return array();
		}

		$css_declarations = array();

		if ( isset( $style_definition['property_keys']['default'] ) ) {
			$value = null;

			if ( ! empty( $style_value['url'] ) ) {
				$value = "url('" . $style_value['url'] . "')";
			} elseif ( is_string( $style_value ) ) {
				$value = $style_value;
			}

			if ( null !== $value ) {
				$css_declarations[ $style_definition['property_keys']['default'] ] = $value;
			}
		}

		return $css_declarations;
	}

	/**
	 * Returns compiled CSS from CSS declarations.
	 *
	 * @since 6.1.0
	 *
	 * @param string[] $css_declarations An associative array of CSS definitions,
	 *                                   e.g. `array( "$property" =&gt; "$value", "$property" =&gt; "$value" )`.
	 * @param string   $css_selector     When a selector is passed, the function will return
	 *                                   a full CSS rule `$selector { ...rules }`,
	 *                                   otherwise a concatenated string of properties and values.
	 * @return string A compiled CSS string.
	 */
	public static function compile_css( $css_declarations, $css_selector ) {
		if ( empty( $css_declarations ) || ! is_array( $css_declarations ) ) {
			return '';
		}

		// Return an entire rule if there is a selector.
		if ( $css_selector ) {
			$css_rule = new WP_Style_Engine_CSS_Rule( $css_selector, $css_declarations );
			return $css_rule-&gt;get_css();
		}

		$css_declarations = new WP_Style_Engine_CSS_Declarations( $css_declarations );
		return $css_declarations-&gt;get_declarations_string();
	}

	/**
	 * Returns a compiled stylesheet from stored CSS rules.
	 *
	 * @since 6.1.0
	 *
	 * @param WP_Style_Engine_CSS_Rule[] $css_rules An array of WP_Style_Engine_CSS_Rule objects
	 *                                              from a store or otherwise.
	 * @param array                      $options   {
	 *     Optional. An array of options. Default empty array.
	 *
	 *     @type string|null $context  An identifier describing the origin of the style object,
	 *                                 e.g. 'block-supports' or 'global-styles'. Default 'block-supports'.
	 *                                 When set, the style engine will attempt to store the CSS rules.
	 *     @type bool        $optimize Whether to optimize the CSS output, e.g. combine rules.
	 *                                 Default false.
	 *     @type bool        $prettify Whether to add new lines and indents to output.
	 *                                 Defaults to whether the `SCRIPT_DEBUG` constant is defined.
	 * }
	 * @return string A compiled stylesheet from stored CSS rules.
	 */
	public static function compile_stylesheet_from_css_rules( $css_rules, $options = array() ) {
		$processor = new WP_Style_Engine_Processor();
		$processor-&gt;add_rules( $css_rules );
		return $processor-&gt;get_css( $options );
	}
}
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/style-engine/class-wp-style-engine.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/style-engine/class-wp-style-engine.php#L31">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/style-engine/class-wp-style-engine.php#L31-L737">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.7.0/">6.7.0</a></td><td><span class="since-description">Added support for typography.writingMode.</span></td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.5.0/">6.5.0</a></td><td><span class="since-description">Added support for background.backgroundPosition,              background.backgroundRepeat and dimensions.aspectRatio.</span></td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.4.0/">6.4.0</a></td><td><span class="since-description">Added support for background.backgroundImage.</span></td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.3.0/">6.3.0</a></td><td><span class="since-description">Added support for text-columns.</span></td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.1.0/">6.1.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
