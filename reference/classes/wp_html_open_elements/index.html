
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/classes/">Classes</a></span><span class="is-current-page">WP_HTML_Open_Elements</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>WP_HTML_Open_Elements</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="keyword">class</span> WP_HTML_Open_Elements {}</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Core class used by the HTML processor during HTML parsing for managing the stack of open elements.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>This class is designed for internal use by the HTML processor.</p>
<blockquote>
<p>Initially, the stack of open elements is empty. The stack grows downwards; the topmost node on the stack is the first one added to the stack, and the bottommost node of the stack is the most recently added node in the stack (notwithstanding when the stack is manipulated in a random access fashion as part of the handling for misnested tags).</p>
</blockquote>
<h3 class="is-toc-heading has-heading-5-font-size" id="see-also" tabindex="-1"><a href="#see-also">See also</a></h3><ul><li><a href="https://html.spec.whatwg.org/#stack-of-open-elements">https://html.spec.whatwg.org/#stack-of-open-elements</a></li>
<li><a href="https://developer.notmatt.press/reference/classes/wp_html_processor">WP_HTML_Processor</a></li>
</ul></section>
<section class="wp-block-wporg-code-reference-methods"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="methods" tabindex="-1"><a href="#methods">Methods</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Name</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/after_element_pop/">WP_HTML_Open_Elements::after_element_pop</a></td><td>Updates internal flags after removing an element.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/after_element_push/">WP_HTML_Open_Elements::after_element_push</a></td><td>Updates internal flags after adding an element.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/contains_node/">WP_HTML_Open_Elements::contains_node</a></td><td>Reports if a specific node is in the stack of open elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/count/">WP_HTML_Open_Elements::count</a></td><td>Returns how many nodes are currently in the stack of open elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/current_node/">WP_HTML_Open_Elements::current_node</a></td><td>Returns the node at the end of the stack of open elements, if one exists. If the stack is empty, returns null.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/has_element_in_button_scope/">WP_HTML_Open_Elements::has_element_in_button_scope</a></td><td>Returns whether a particular element is in button scope.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/has_element_in_list_item_scope/">WP_HTML_Open_Elements::has_element_in_list_item_scope</a></td><td>Returns whether a particular element is in list item scope.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/has_element_in_scope/">WP_HTML_Open_Elements::has_element_in_scope</a></td><td>Returns whether a particular element is in scope.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/has_element_in_select_scope/">WP_HTML_Open_Elements::has_element_in_select_scope</a></td><td>Returns whether a particular element is in select scope.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/has_element_in_specific_scope/">WP_HTML_Open_Elements::has_element_in_specific_scope</a></td><td>Returns whether an element is in a specific scope.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/has_element_in_table_scope/">WP_HTML_Open_Elements::has_element_in_table_scope</a></td><td>Returns whether a particular element is in table scope.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/has_p_in_button_scope/">WP_HTML_Open_Elements::has_p_in_button_scope</a></td><td>Returns whether a P is in BUTTON scope.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/pop/">WP_HTML_Open_Elements::pop</a></td><td>Pops a node off of the stack of open elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/pop_until/">WP_HTML_Open_Elements::pop_until</a></td><td>Pops nodes off of the stack of open elements until one with the given tag name has been popped.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/push/">WP_HTML_Open_Elements::push</a></td><td>Pushes a node onto the stack of open elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/remove_node/">WP_HTML_Open_Elements::remove_node</a></td><td>Removes a specific node from the stack of open elements.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/walk_down/">WP_HTML_Open_Elements::walk_down</a></td><td>Steps through the stack of open elements, starting with the top element (added first) and walking downwards to the one added last.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_html_open_elements/walk_up/">WP_HTML_Open_Elements::walk_up</a></td><td>Steps through the stack of open elements, starting with the bottom element (added last) and walking upwards to the one added first.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="30"><code class="language-php line-numbers" id="wporg-source-code" lang="php">class WP_HTML_Open_Elements {
	/**
	 * Holds the stack of open element references.
	 *
	 * @since 6.4.0
	 *
	 * @var WP_HTML_Token[]
	 */
	public $stack = array();

	/**
	 * Whether a P element is in button scope currently.
	 *
	 * This class optimizes scope lookup by pre-calculating
	 * this value when elements are added and removed to the
	 * stack of open elements which might change its value.
	 * This avoids frequent iteration over the stack.
	 *
	 * @since 6.4.0
	 *
	 * @var bool
	 */
	private $has_p_in_button_scope = false;

	/**
	 * A function that will be called when an item is popped off the stack of open elements.
	 *
	 * The function will be called with the popped item as its argument.
	 *
	 * @since 6.6.0
	 *
	 * @var Closure|null
	 */
	private $pop_handler = null;

	/**
	 * A function that will be called when an item is pushed onto the stack of open elements.
	 *
	 * The function will be called with the pushed item as its argument.
	 *
	 * @since 6.6.0
	 *
	 * @var Closure|null
	 */
	private $push_handler = null;

	/**
	 * Sets a pop handler that will be called when an item is popped off the stack of
	 * open elements.
	 *
	 * The function will be called with the pushed item as its argument.
	 *
	 * @since 6.6.0
	 *
	 * @param Closure $handler The handler function.
	 */
	public function set_pop_handler( Closure $handler ): void {
		$this-&gt;pop_handler = $handler;
	}

	/**
	 * Sets a push handler that will be called when an item is pushed onto the stack of
	 * open elements.
	 *
	 * The function will be called with the pushed item as its argument.
	 *
	 * @since 6.6.0
	 *
	 * @param Closure $handler The handler function.
	 */
	public function set_push_handler( Closure $handler ): void {
		$this-&gt;push_handler = $handler;
	}

	/**
	 * Returns the name of the node at the nth position on the stack
	 * of open elements, or `null` if no such position exists.
	 *
	 * Note that this uses a 1-based index, which represents the
	 * "nth item" on the stack, counting from the top, where the
	 * top-most element is the 1st, the second is the 2nd, etc...
	 *
	 * @since 6.7.0
	 *
	 * @param int $nth Retrieve the nth item on the stack, with 1 being
	 *                 the top element, 2 being the second, etc...
	 * @return WP_HTML_Token|null Name of the node on the stack at the given location,
	 *                            or `null` if the location isn't on the stack.
	 */
	public function at( int $nth ): ?WP_HTML_Token {
		foreach ( $this-&gt;walk_down() as $item ) {
			if ( 0 === --$nth ) {
				return $item;
			}
		}

		return null;
	}

	/**
	 * Reports if a node of a given name is in the stack of open elements.
	 *
	 * @since 6.7.0
	 *
	 * @param string $node_name Name of node for which to check.
	 * @return bool Whether a node of the given name is in the stack of open elements.
	 */
	public function contains( string $node_name ): bool {
		foreach ( $this-&gt;walk_up() as $item ) {
			if ( $node_name === $item-&gt;node_name ) {
				return true;
			}
		}

		return false;
	}

	/**
	 * Reports if a specific node is in the stack of open elements.
	 *
	 * @since 6.4.0
	 *
	 * @param WP_HTML_Token $token Look for this node in the stack.
	 * @return bool Whether the referenced node is in the stack of open elements.
	 */
	public function contains_node( WP_HTML_Token $token ): bool {
		foreach ( $this-&gt;walk_up() as $item ) {
			if ( $token === $item ) {
				return true;
			}
		}

		return false;
	}

	/**
	 * Returns how many nodes are currently in the stack of open elements.
	 *
	 * @since 6.4.0
	 *
	 * @return int How many node are in the stack of open elements.
	 */
	public function count(): int {
		return count( $this-&gt;stack );
	}

	/**
	 * Returns the node at the end of the stack of open elements,
	 * if one exists. If the stack is empty, returns null.
	 *
	 * @since 6.4.0
	 *
	 * @return WP_HTML_Token|null Last node in the stack of open elements, if one exists, otherwise null.
	 */
	public function current_node(): ?WP_HTML_Token {
		$current_node = end( $this-&gt;stack );

		return $current_node ? $current_node : null;
	}

	/**
	 * Indicates if the current node is of a given type or name.
	 *
	 * It's possible to pass either a node type or a node name to this function.
	 * In the case there is no current element it will always return `false`.
	 *
	 * Example:
	 *
	 *     // Is the current node a text node?
	 *     $stack-&gt;current_node_is( '#text' );
	 *
	 *     // Is the current node a DIV element?
	 *     $stack-&gt;current_node_is( 'DIV' );
	 *
	 *     // Is the current node any element/tag?
	 *     $stack-&gt;current_node_is( '#tag' );
	 *
	 * @see WP_HTML_Tag_Processor::get_token_type
	 * @see WP_HTML_Tag_Processor::get_token_name
	 *
	 * @since 6.7.0
	 *
	 * @access private
	 *
	 * @param string $identity Check if the current node has this name or type (depending on what is provided).
	 * @return bool Whether there is a current element that matches the given identity, whether a token name or type.
	 */
	public function current_node_is( string $identity ): bool {
		$current_node = end( $this-&gt;stack );
		if ( false === $current_node ) {
			return false;
		}

		$current_node_name = $current_node-&gt;node_name;

		return (
			$current_node_name === $identity ||
			( '#doctype' === $identity &amp;&amp; 'html' === $current_node_name ) ||
			( '#tag' === $identity &amp;&amp; ctype_upper( $current_node_name ) )
		);
	}

	/**
	 * Returns whether an element is in a specific scope.
	 *
	 * @since 6.4.0
	 *
	 * @see https://html.spec.whatwg.org/#has-an-element-in-the-specific-scope
	 *
	 * @param string   $tag_name         Name of tag check.
	 * @param string[] $termination_list List of elements that terminate the search.
	 * @return bool Whether the element was found in a specific scope.
	 */
	public function has_element_in_specific_scope( string $tag_name, $termination_list ): bool {
		foreach ( $this-&gt;walk_up() as $node ) {
			$namespaced_name = 'html' === $node-&gt;namespace
				? $node-&gt;node_name
				: "{$node-&gt;namespace} {$node-&gt;node_name}";

			if ( $namespaced_name === $tag_name ) {
				return true;
			}

			if (
				'(internal: H1 through H6 - do not use)' === $tag_name &amp;&amp;
				in_array( $namespaced_name, array( 'H1', 'H2', 'H3', 'H4', 'H5', 'H6' ), true )
			) {
				return true;
			}

			if ( in_array( $namespaced_name, $termination_list, true ) ) {
				return false;
			}
		}

		return false;
	}

	/**
	 * Returns whether a particular element is in scope.
	 *
	 * &gt; The stack of open elements is said to have a particular element in
	 * &gt; scope when it has that element in the specific scope consisting of
	 * &gt; the following element types:
	 * &gt;
	 * &gt;   - applet
	 * &gt;   - caption
	 * &gt;   - html
	 * &gt;   - table
	 * &gt;   - td
	 * &gt;   - th
	 * &gt;   - marquee
	 * &gt;   - object
	 * &gt;   - template
	 * &gt;   - MathML mi
	 * &gt;   - MathML mo
	 * &gt;   - MathML mn
	 * &gt;   - MathML ms
	 * &gt;   - MathML mtext
	 * &gt;   - MathML annotation-xml
	 * &gt;   - SVG foreignObject
	 * &gt;   - SVG desc
	 * &gt;   - SVG title
	 *
	 * @since 6.4.0
	 * @since 6.7.0 Full support.
	 *
	 * @see https://html.spec.whatwg.org/#has-an-element-in-scope
	 *
	 * @param string $tag_name Name of tag to check.
	 * @return bool Whether given element is in scope.
	 */
	public function has_element_in_scope( string $tag_name ): bool {
		return $this-&gt;has_element_in_specific_scope(
			$tag_name,
			array(
				'APPLET',
				'CAPTION',
				'HTML',
				'TABLE',
				'TD',
				'TH',
				'MARQUEE',
				'OBJECT',
				'TEMPLATE',

				'math MI',
				'math MO',
				'math MN',
				'math MS',
				'math MTEXT',
				'math ANNOTATION-XML',

				'svg FOREIGNOBJECT',
				'svg DESC',
				'svg TITLE',
			)
		);
	}

	/**
	 * Returns whether a particular element is in list item scope.
	 *
	 * &gt; The stack of open elements is said to have a particular element
	 * &gt; in list item scope when it has that element in the specific scope
	 * &gt; consisting of the following element types:
	 * &gt;
	 * &gt;   - All the element types listed above for the has an element in scope algorithm.
	 * &gt;   - ol in the HTML namespace
	 * &gt;   - ul in the HTML namespace
	 *
	 * @since 6.4.0
	 * @since 6.5.0 Implemented: no longer throws on every invocation.
	 * @since 6.7.0 Supports all required HTML elements.
	 *
	 * @see https://html.spec.whatwg.org/#has-an-element-in-list-item-scope
	 *
	 * @param string $tag_name Name of tag to check.
	 * @return bool Whether given element is in scope.
	 */
	public function has_element_in_list_item_scope( string $tag_name ): bool {
		return $this-&gt;has_element_in_specific_scope(
			$tag_name,
			array(
				'APPLET',
				'BUTTON',
				'CAPTION',
				'HTML',
				'TABLE',
				'TD',
				'TH',
				'MARQUEE',
				'OBJECT',
				'OL',
				'TEMPLATE',
				'UL',

				'math MI',
				'math MO',
				'math MN',
				'math MS',
				'math MTEXT',
				'math ANNOTATION-XML',

				'svg FOREIGNOBJECT',
				'svg DESC',
				'svg TITLE',
			)
		);
	}

	/**
	 * Returns whether a particular element is in button scope.
	 *
	 * &gt; The stack of open elements is said to have a particular element
	 * &gt; in button scope when it has that element in the specific scope
	 * &gt; consisting of the following element types:
	 * &gt;
	 * &gt;   - All the element types listed above for the has an element in scope algorithm.
	 * &gt;   - button in the HTML namespace
	 *
	 * @since 6.4.0
	 * @since 6.7.0 Supports all required HTML elements.
	 *
	 * @see https://html.spec.whatwg.org/#has-an-element-in-button-scope
	 *
	 * @param string $tag_name Name of tag to check.
	 * @return bool Whether given element is in scope.
	 */
	public function has_element_in_button_scope( string $tag_name ): bool {
		return $this-&gt;has_element_in_specific_scope(
			$tag_name,
			array(
				'APPLET',
				'BUTTON',
				'CAPTION',
				'HTML',
				'TABLE',
				'TD',
				'TH',
				'MARQUEE',
				'OBJECT',
				'TEMPLATE',

				'math MI',
				'math MO',
				'math MN',
				'math MS',
				'math MTEXT',
				'math ANNOTATION-XML',

				'svg FOREIGNOBJECT',
				'svg DESC',
				'svg TITLE',
			)
		);
	}

	/**
	 * Returns whether a particular element is in table scope.
	 *
	 * &gt; The stack of open elements is said to have a particular element
	 * &gt; in table scope when it has that element in the specific scope
	 * &gt; consisting of the following element types:
	 * &gt;
	 * &gt;   - html in the HTML namespace
	 * &gt;   - table in the HTML namespace
	 * &gt;   - template in the HTML namespace
	 *
	 * @since 6.4.0
	 * @since 6.7.0 Full implementation.
	 *
	 * @see https://html.spec.whatwg.org/#has-an-element-in-table-scope
	 *
	 * @param string $tag_name Name of tag to check.
	 * @return bool Whether given element is in scope.
	 */
	public function has_element_in_table_scope( string $tag_name ): bool {
		return $this-&gt;has_element_in_specific_scope(
			$tag_name,
			array(
				'HTML',
				'TABLE',
				'TEMPLATE',
			)
		);
	}

	/**
	 * Returns whether a particular element is in select scope.
	 *
	 * This test differs from the others like it, in that its rules are inverted.
	 * Instead of arriving at a match when one of any tag in a termination group
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/html-api/class-wp-html-open-elements.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/html-api/class-wp-html-open-elements.php#L30">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/html-api/class-wp-html-open-elements.php#L30-L462">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/6.4.0/">6.4.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
