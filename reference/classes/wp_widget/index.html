
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/classes/">Classes</a></span><span class="is-current-page">WP_Widget</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>WP_Widget</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="keyword">class</span> WP_Widget {}</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Core base class extended to register widgets.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>This class must be extended for each widget, and <a href="https://developer.notmatt.press/reference/classes/wp_widget/widget/" rel="method">WP_Widget::widget()</a> must be overridden.</p>
<p>If adding widget options, <a href="https://developer.notmatt.press/reference/classes/wp_widget/update/" rel="method">WP_Widget::update()</a> and <a href="https://developer.notmatt.press/reference/classes/wp_widget/form/" rel="method">WP_Widget::form()</a> should also be overridden.</p>
</section>
<section class="wp-block-wporg-code-reference-methods"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="methods" tabindex="-1"><a href="#methods">Methods</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Name</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/__construct/">WP_Widget::__construct</a></td><td>PHP5 constructor.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/_get_display_callback/">WP_Widget::_get_display_callback</a></td><td>Retrieves the widget display callback.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/_get_form_callback/">WP_Widget::_get_form_callback</a></td><td>Retrieves the form callback.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/_get_update_callback/">WP_Widget::_get_update_callback</a></td><td>Retrieves the widget update callback.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/_register/">WP_Widget::_register</a></td><td>Register all widget instances of this widget class.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/_register_one/">WP_Widget::_register_one</a></td><td>Registers an instance of the widget class.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/_set/">WP_Widget::_set</a></td><td>Sets the internal order number for the widget instance.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/display_callback/">WP_Widget::display_callback</a></td><td>Generates the actual widget content (Do NOT override).</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/form/">WP_Widget::form</a></td><td>Outputs the settings update form.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/form_callback/">WP_Widget::form_callback</a></td><td>Generates the widget control form (Do NOT override).</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/get_field_id/">WP_Widget::get_field_id</a></td><td>Constructs id attributes for use in <a href="https://developer.notmatt.press/reference/classes/wp_widget/form/" rel="method">WP_Widget::form()</a> fields.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/get_field_name/">WP_Widget::get_field_name</a></td><td>Constructs name attributes for use in form() fields</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/get_settings/">WP_Widget::get_settings</a></td><td>Retrieves the settings for all instances of the widget class.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/is_preview/">WP_Widget::is_preview</a></td><td>Determines whether the current request is inside the Customizer preview.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/save_settings/">WP_Widget::save_settings</a></td><td>Saves the settings for all instances of the widget class.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/update/">WP_Widget::update</a></td><td>Updates a particular instance of a widget.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/update_callback/">WP_Widget::update_callback</a></td><td>Handles changed settings (Do NOT override).</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/widget/">WP_Widget::widget</a></td><td>Echoes the widget content.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget/wp_widget/">WP_Widget::WP_Widget</a></td><td>PHP4 constructor. â€” <span class="deprecated-method">deprecated</span></td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="21"><code class="language-php line-numbers" id="wporg-source-code" lang="php">class WP_Widget {

	/**
	 * Root ID for all widgets of this type.
	 *
	 * @since 2.8.0
	 * @var mixed|string
	 */
	public $id_base;

	/**
	 * Name for this widget type.
	 *
	 * @since 2.8.0
	 * @var string
	 */
	public $name;

	/**
	 * Option name for this widget type.
	 *
	 * @since 2.8.0
	 * @var string
	 */
	public $option_name;

	/**
	 * Alt option name for this widget type.
	 *
	 * @since 2.8.0
	 * @var string
	 */
	public $alt_option_name;

	/**
	 * Option array passed to wp_register_sidebar_widget().
	 *
	 * @since 2.8.0
	 * @var array
	 */
	public $widget_options;

	/**
	 * Option array passed to wp_register_widget_control().
	 *
	 * @since 2.8.0
	 * @var array
	 */
	public $control_options;

	/**
	 * Unique ID number of the current instance.
	 *
	 * @since 2.8.0
	 * @var bool|int
	 */
	public $number = false;

	/**
	 * Unique ID string of the current instance (id_base-number).
	 *
	 * @since 2.8.0
	 * @var bool|string
	 */
	public $id = false;

	/**
	 * Whether the widget data has been updated.
	 *
	 * Set to true when the data is updated after a POST submit - ensures it does
	 * not happen twice.
	 *
	 * @since 2.8.0
	 * @var bool
	 */
	public $updated = false;

	//
	// Member functions that must be overridden by subclasses.
	//

	/**
	 * Echoes the widget content.
	 *
	 * Subclasses should override this function to generate their widget code.
	 *
	 * @since 2.8.0
	 *
	 * @param array $args     Display arguments including 'before_title', 'after_title',
	 *                        'before_widget', and 'after_widget'.
	 * @param array $instance The settings for the particular instance of the widget.
	 */
	public function widget( $args, $instance ) {
		die( 'function WP_Widget::widget() must be overridden in a subclass.' );
	}

	/**
	 * Updates a particular instance of a widget.
	 *
	 * This function should check that `$new_instance` is set correctly. The newly-calculated
	 * value of `$instance` should be returned. If false is returned, the instance won't be
	 * saved/updated.
	 *
	 * @since 2.8.0
	 *
	 * @param array $new_instance New settings for this instance as input by the user via
	 *                            WP_Widget::form().
	 * @param array $old_instance Old settings for this instance.
	 * @return array Settings to save or bool false to cancel saving.
	 */
	public function update( $new_instance, $old_instance ) {
		return $new_instance;
	}

	/**
	 * Outputs the settings update form.
	 *
	 * @since 2.8.0
	 *
	 * @param array $instance The settings for the particular instance of the widget.
	 * @return string Default return is 'noform'.
	 */
	public function form( $instance ) {
		echo '&lt;p class="no-options-widget"&gt;' . __( 'There are no options for this widget.' ) . '&lt;/p&gt;';
		return 'noform';
	}

	// Functions you'll need to call.

	/**
	 * PHP5 constructor.
	 *
	 * @since 2.8.0
	 *
	 * @param string $id_base         Base ID for the widget, lowercase and unique. If left empty,
	 *                                a portion of the widget's PHP class name will be used. Has to be unique.
	 * @param string $name            Name for the widget displayed on the configuration page.
	 * @param array  $widget_options  Optional. Widget options. See wp_register_sidebar_widget() for
	 *                                information on accepted arguments. Default empty array.
	 * @param array  $control_options Optional. Widget control options. See wp_register_widget_control() for
	 *                                information on accepted arguments. Default empty array.
	 */
	public function __construct( $id_base, $name, $widget_options = array(), $control_options = array() ) {
		if ( ! empty( $id_base ) ) {
			$id_base = strtolower( $id_base );
		} else {
			$id_base = preg_replace( '/(wp_)?widget_/', '', strtolower( get_class( $this ) ) );
		}

		$this-&gt;id_base         = $id_base;
		$this-&gt;name            = $name;
		$this-&gt;option_name     = 'widget_' . $this-&gt;id_base;
		$this-&gt;widget_options  = wp_parse_args(
			$widget_options,
			array(
				'classname'                   =&gt; str_replace( '\\', '_', $this-&gt;option_name ),
				'customize_selective_refresh' =&gt; false,
			)
		);
		$this-&gt;control_options = wp_parse_args( $control_options, array( 'id_base' =&gt; $this-&gt;id_base ) );
	}

	/**
	 * PHP4 constructor.
	 *
	 * @since 2.8.0
	 * @deprecated 4.3.0 Use __construct() instead.
	 *
	 * @see WP_Widget::__construct()
	 *
	 * @param string $id_base         Base ID for the widget, lowercase and unique. If left empty,
	 *                                a portion of the widget's PHP class name will be used. Has to be unique.
	 * @param string $name            Name for the widget displayed on the configuration page.
	 * @param array  $widget_options  Optional. Widget options. See wp_register_sidebar_widget() for
	 *                                information on accepted arguments. Default empty array.
	 * @param array  $control_options Optional. Widget control options. See wp_register_widget_control() for
	 *                                information on accepted arguments. Default empty array.
	 */
	public function WP_Widget( $id_base, $name, $widget_options = array(), $control_options = array() ) {
		_deprecated_constructor( 'WP_Widget', '4.3.0', get_class( $this ) );
		WP_Widget::__construct( $id_base, $name, $widget_options, $control_options );
	}

	/**
	 * Constructs name attributes for use in form() fields
	 *
	 * This function should be used in form() methods to create name attributes for fields
	 * to be saved by update()
	 *
	 * @since 2.8.0
	 * @since 4.4.0 Array format field names are now accepted.
	 *
	 * @param string $field_name Field name.
	 * @return string Name attribute for `$field_name`.
	 */
	public function get_field_name( $field_name ) {
		$pos = strpos( $field_name, '[' );

		if ( false !== $pos ) {
			// Replace the first occurrence of '[' with ']['.
			$field_name = '[' . substr_replace( $field_name, '][', $pos, strlen( '[' ) );
		} else {
			$field_name = '[' . $field_name . ']';
		}

		return 'widget-' . $this-&gt;id_base . '[' . $this-&gt;number . ']' . $field_name;
	}

	/**
	 * Constructs id attributes for use in WP_Widget::form() fields.
	 *
	 * This function should be used in form() methods to create id attributes
	 * for fields to be saved by WP_Widget::update().
	 *
	 * @since 2.8.0
	 * @since 4.4.0 Array format field IDs are now accepted.
	 *
	 * @param string $field_name Field name.
	 * @return string ID attribute for `$field_name`.
	 */
	public function get_field_id( $field_name ) {
		$field_name = str_replace( array( '[]', '[', ']' ), array( '', '-', '' ), $field_name );
		$field_name = trim( $field_name, '-' );

		return 'widget-' . $this-&gt;id_base . '-' . $this-&gt;number . '-' . $field_name;
	}

	/**
	 * Register all widget instances of this widget class.
	 *
	 * @since 2.8.0
	 */
	public function _register() {
		$settings = $this-&gt;get_settings();
		$empty    = true;

		// When $settings is an array-like object, get an intrinsic array for use with array_keys().
		if ( $settings instanceof ArrayObject || $settings instanceof ArrayIterator ) {
			$settings = $settings-&gt;getArrayCopy();
		}

		if ( is_array( $settings ) ) {
			foreach ( array_keys( $settings ) as $number ) {
				if ( is_numeric( $number ) ) {
					$this-&gt;_set( $number );
					$this-&gt;_register_one( $number );
					$empty = false;
				}
			}
		}

		if ( $empty ) {
			// If there are none, we register the widget's existence with a generic template.
			$this-&gt;_set( 1 );
			$this-&gt;_register_one();
		}
	}

	/**
	 * Sets the internal order number for the widget instance.
	 *
	 * @since 2.8.0
	 *
	 * @param int $number The unique order number of this widget instance compared to other
	 *                    instances of the same class.
	 */
	public function _set( $number ) {
		$this-&gt;number = $number;
		$this-&gt;id     = $this-&gt;id_base . '-' . $number;
	}

	/**
	 * Retrieves the widget display callback.
	 *
	 * @since 2.8.0
	 *
	 * @return callable Display callback.
	 */
	public function _get_display_callback() {
		return array( $this, 'display_callback' );
	}

	/**
	 * Retrieves the widget update callback.
	 *
	 * @since 2.8.0
	 *
	 * @return callable Update callback.
	 */
	public function _get_update_callback() {
		return array( $this, 'update_callback' );
	}

	/**
	 * Retrieves the form callback.
	 *
	 * @since 2.8.0
	 *
	 * @return callable Form callback.
	 */
	public function _get_form_callback() {
		return array( $this, 'form_callback' );
	}

	/**
	 * Determines whether the current request is inside the Customizer preview.
	 *
	 * If true -- the current request is inside the Customizer preview, then
	 * the object cache gets suspended and widgets should check this to decide
	 * whether they should store anything persistently to the object cache,
	 * to transients, or anywhere else.
	 *
	 * @since 3.9.0
	 *
	 * @global WP_Customize_Manager $wp_customize
	 *
	 * @return bool True if within the Customizer preview, false if not.
	 */
	public function is_preview() {
		global $wp_customize;
		return ( isset( $wp_customize ) &amp;&amp; $wp_customize-&gt;is_preview() );
	}

	/**
	 * Generates the actual widget content (Do NOT override).
	 *
	 * Finds the instance and calls WP_Widget::widget().
	 *
	 * @since 2.8.0
	 *
	 * @param array     $args        Display arguments. See WP_Widget::widget() for information
	 *                               on accepted arguments.
	 * @param int|array $widget_args {
	 *     Optional. Internal order number of the widget instance, or array of multi-widget arguments.
	 *     Default 1.
	 *
	 *     @type int $number Number increment used for multiples of the same widget.
	 * }
	 */
	public function display_callback( $args, $widget_args = 1 ) {
		if ( is_numeric( $widget_args ) ) {
			$widget_args = array( 'number' =&gt; $widget_args );
		}

		$widget_args = wp_parse_args( $widget_args, array( 'number' =&gt; -1 ) );
		$this-&gt;_set( $widget_args['number'] );
		$instances = $this-&gt;get_settings();

		if ( isset( $instances[ $this-&gt;number ] ) ) {
			$instance = $instances[ $this-&gt;number ];

			/**
			 * Filters the settings for a particular widget instance.
			 *
			 * Returning false will effectively short-circuit display of the widget.
			 *
			 * @since 2.8.0
			 *
			 * @param array     $instance The current widget instance's settings.
			 * @param WP_Widget $widget   The current widget instance.
			 * @param array     $args     An array of default widget arguments.
			 */
			$instance = apply_filters( 'widget_display_callback', $instance, $this, $args );

			if ( false === $instance ) {
				return;
			}

			$was_cache_addition_suspended = wp_suspend_cache_addition();
			if ( $this-&gt;is_preview() &amp;&amp; ! $was_cache_addition_suspended ) {
				wp_suspend_cache_addition( true );
			}

			$this-&gt;widget( $args, $instance );

			if ( $this-&gt;is_preview() ) {
				wp_suspend_cache_addition( $was_cache_addition_suspended );
			}
		}
	}

	/**
	 * Handles changed settings (Do NOT override).
	 *
	 * @since 2.8.0
	 *
	 * @global array $wp_registered_widgets
	 *
	 * @param int $deprecated Not used.
	 */
	public function update_callback( $deprecated = 1 ) {
		global $wp_registered_widgets;

		$all_instances = $this-&gt;get_settings();

		// We need to update the data.
		if ( $this-&gt;updated ) {
			return;
		}

		if ( isset( $_POST['delete_widget'] ) &amp;&amp; $_POST['delete_widget'] ) {
			// Delete the settings for this instance of the widget.
			if ( isset( $_POST['the-widget-id'] ) ) {
				$del_id = $_POST['the-widget-id'];
			} else {
				return;
			}

			if ( isset( $wp_registered_widgets[ $del_id ]['params'][0]['number'] ) ) {
				$number = $wp_registered_widgets[ $del_id ]['params'][0]['number'];

				if ( $this-&gt;id_base . '-' . $number === $del_id ) {
					unset( $all_instances[ $number ] );
				}
			}
		} else {
			if ( isset( $_POST[ 'widget-' . $this-&gt;id_base ] ) &amp;&amp; is_array( $_POST[ 'widget-' . $this-&gt;id_base ] ) ) {
				$settings = $_POST[ 'widget-' . $this-&gt;id_base ];
			} elseif ( isset( $_POST['id_base'] ) &amp;&amp; $_POST['id_base'] === $this-&gt;id_base ) {
				$num      = $_POST['multi_number'] ? (int) $_POST['multi_number'] : (int) $_POST['widget_number'];
				$settings = array( $num =&gt; array() );
			} else {
				return;
			}

			foreach ( $settings as $number =&gt; $new_instance ) {
				$new_instance = stripslashes_deep( $new_instance );
				$this-&gt;_set( $number );

				$old_instance = isset( $all_instances[ $number ] ) ? $all_instances[ $number ] : array();

				$was_cache_addition_suspended = wp_suspend_cache_addition();
				if ( $this-&gt;is_preview() &amp;&amp; ! $was_cache_addition_suspended ) {
					wp_suspend_cache_addition( true );
				}

				$instance = $this-&gt;update( $new_instance, $old_instance );

				if ( $this-&gt;is_preview() ) {
					wp_suspend_cache_addition( $was_cache_addition_suspended );
				}

				/**
				 * Filters a widget's settings before saving.
				 *
				 * Returning false will effectively short-circuit the widget's ability
				 * to update settings.
				 *
				 * @since 2.8.0
				 *
				 * @param array     $instance     The current widget instance's settings.
				 * @param array     $new_instance Array of new widget settings.
				 * @param array     $old_instance Array of old widget settings.
				 * @param WP_Widget $widget       The current widget instance.
				 */
				$instance = apply_filters( 'widget_update_callback', $instance, $new_instance, $old_instance, $this );

				if ( false !== $instance ) {
					$all_instances[ $number ] = $instance;
				}

				break; // Run only once.
			}
		}

		$this-&gt;save_settings( $all_instances );
		$this-&gt;updated = true;
	}

	/**
	 * Generates the widget control form (Do NOT override).
	 *
	 * @since 2.8.0
	 *
	 * @param int|array $widget_args {
	 *     Optional. Internal order number of the widget instance, or array of multi-widget arguments.
	 *     Default 1.
	 *
	 *     @type int $number Number increment used for multiples of the same widget.
	 * }
	 * @return string|null
	 */
	public function form_callback( $widget_args = 1 ) {
		if ( is_numeric( $widget_args ) ) {
			$widget_args = array( 'number' =&gt; $widget_args );
		}

		$widget_args   = wp_parse_args( $widget_args, array( 'number' =&gt; -1 ) );
		$all_instances = $this-&gt;get_settings();

		if ( -1 === $widget_args['number'] ) {
			// We echo out a form where 'number' can be set later.
			$this-&gt;_set( '__i__' );
			$instance = array();
		} else {
			$this-&gt;_set( $widget_args['number'] );
			$instance = $all_instances[ $widget_args['number'] ];
		}

		/**
		 * Filters the widget instance's settings before displaying the control form.
		 *
		 * Returning false effectively short-circuits display of the control form.
		 *
		 * @since 2.8.0
		 *
		 * @param array     $instance The current widget instance's settings.
		 * @param WP_Widget $widget   The current widget instance.
		 */
		$instance = apply_filters( 'widget_form_callback', $instance, $this );

		$return = null;

		if ( false !== $instance ) {
			$return = $this-&gt;form( $instance );

			/**
			 * Fires at the end of the widget control form.
			 *
			 * Use this hook to add extra fields to the widget form. The hook
			 * is only fired if the value passed to the 'widget_form_callback'
			 * hook is not false.
			 *
			 * Note: If the widget has no form, the text echoed from the default
			 * form method can be hidden using CSS.
			 *
			 * @since 2.8.0
			 *
			 * @param WP_Widget $widget   The widget instance (passed by reference).
			 * @param null      $return   Return null if new fields are added.
			 * @param array     $instance An array of the widget's settings.
			 */
			do_action_ref_array( 'in_widget_form', array( &amp;$this, &amp;$return, $instance ) );
		}

		return $return;
	}

	/**
	 * Registers an instance of the widget class.
	 *
	 * @since 2.8.0
	 *
	 * @param int $number Optional. The unique order number of this widget instance
	 *                    compared to other instances of the same class. Default -1.
	 */
	public function _register_one( $number = -1 ) {
		wp_register_sidebar_widget(
			$this-&gt;id,
			$this-&gt;name,
			$this-&gt;_get_display_callback(),
			$this-&gt;widget_options,
			array( 'number' =&gt; $number )
		);

		_register_widget_update_callback(
			$this-&gt;id_base,
			$this-&gt;_get_update_callback(),
			$this-&gt;control_options,
			array( 'number' =&gt; -1 )
		);

		_register_widget_form_callback(
			$this-&gt;id,
			$this-&gt;name,
			$this-&gt;_get_form_callback(),
			$this-&gt;control_options,
			array( 'number' =&gt; $number )
		);
	}

	/**
	 * Saves the settings for all instances of the widget class.
	 *
	 * @since 2.8.0
	 *
	 * @param array $settings Multi-dimensional array of widget instance settings.
	 */
	public function save_settings( $settings ) {
		$settings['_multiwidget'] = 1;
		update_option( $this-&gt;option_name, $settings );
	}

	/**
	 * Retrieves the settings for all instances of the widget class.
	 *
	 * @since 2.8.0
	 *
	 * @return array Multi-dimensional array of widget instance settings.
	 */
	public function get_settings() {

		$settings = get_option( $this-&gt;option_name );

		if ( false === $settings ) {
			$settings = array();
			if ( isset( $this-&gt;alt_option_name ) ) {
				// Get settings from alternative (legacy) option.
				$settings = get_option( $this-&gt;alt_option_name, array() );

				// Delete the alternative (legacy) option as the new option will be created using `$this-&gt;option_name`.
				delete_option( $this-&gt;alt_option_name );
			}
			// Save an option so it can be autoloaded next time.
			$this-&gt;save_settings( $settings );
		}

		if ( ! is_array( $settings ) &amp;&amp; ! ( $settings instanceof ArrayObject || $settings instanceof ArrayIterator ) ) {
			$settings = array();
		}

		if ( ! empty( $settings ) &amp;&amp; ! isset( $settings['_multiwidget'] ) ) {
			// Old format, convert if single widget.
			$settings = wp_convert_widget_settings( $this-&gt;id_base, $this-&gt;option_name, $settings );
		}

		unset( $settings['_multiwidget'], $settings['__i__'] );

		return $settings;
	}
}
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/class-wp-widget.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/class-wp-widget.php#L21">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/class-wp-widget.php#L21-L641">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-related" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="related" tabindex="-1"><a href="#related">Related</a></h2> <section class="wp-block-wporg-code-table" id="used-by" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Used by</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_block/">WP_Widget_Block</a><code>wp-includes/widgets/class-wp-widget-block.php</code></td><td><p>Core class used to implement a Block widget.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_custom_html/">WP_Widget_Custom_HTML</a><code>wp-includes/widgets/class-wp-widget-custom-html.php</code></td><td><p>Core class used to implement a Custom HTML widget.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_media/">WP_Widget_Media</a><code>wp-includes/widgets/class-wp-widget-media.php</code></td><td><p>Core class that implements a media widget.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_tag_cloud/">WP_Widget_Tag_Cloud</a><code>wp-includes/widgets/class-wp-widget-tag-cloud.php</code></td><td><p>Core class used to implement a Tag cloud widget.</p>
</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_nav_menu_widget/">WP_Nav_Menu_Widget</a><code>wp-includes/widgets/class-wp-nav-menu-widget.php</code></td><td><p>Core class used to implement the Navigation Menu widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_rss/">WP_Widget_RSS</a><code>wp-includes/widgets/class-wp-widget-rss.php</code></td><td><p>Core class used to implement a RSS widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_recent_posts/">WP_Widget_Recent_Posts</a><code>wp-includes/widgets/class-wp-widget-recent-posts.php</code></td><td><p>Core class used to implement a Recent Posts widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_recent_comments/">WP_Widget_Recent_Comments</a><code>wp-includes/widgets/class-wp-widget-recent-comments.php</code></td><td><p>Core class used to implement a Recent Comments widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_calendar/">WP_Widget_Calendar</a><code>wp-includes/widgets/class-wp-widget-calendar.php</code></td><td><p>Core class used to implement the Calendar widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_text/">WP_Widget_Text</a><code>wp-includes/widgets/class-wp-widget-text.php</code></td><td><p>Core class used to implement a Text widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_categories/">WP_Widget_Categories</a><code>wp-includes/widgets/class-wp-widget-categories.php</code></td><td><p>Core class used to implement a Categories widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_archives/">WP_Widget_Archives</a><code>wp-includes/widgets/class-wp-widget-archives.php</code></td><td><p>Core class used to implement the Archives widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_meta/">WP_Widget_Meta</a><code>wp-includes/widgets/class-wp-widget-meta.php</code></td><td><p>Core class used to implement a Meta widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_pages/">WP_Widget_Pages</a><code>wp-includes/widgets/class-wp-widget-pages.php</code></td><td><p>Core class used to implement a Pages widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_links/">WP_Widget_Links</a><code>wp-includes/widgets/class-wp-widget-links.php</code></td><td><p>Core class used to implement a Links widget.</p>
</td></tr><tr class="wporg-hidden"><td><a href="https://developer.notmatt.press/reference/classes/wp_widget_search/">WP_Widget_Search</a><code>wp-includes/widgets/class-wp-widget-search.php</code></td><td><p>Core class used to implement a Search widget.</p>
</td></tr></tbody></table></figure><a class="wp-block-wporg-code-table-show-more" href="#">Show 11 more</a><a class="wp-block-wporg-code-table-show-less" href="#">Show less</a></section> </section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/4.4.0/">4.4.0</a></td><td><span class="since-description">Moved to its own file from wp-includes/widgets.php</span></td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/since/2.8.0/">2.8.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-andy-schmidt odd alt thread-odd thread-alt depth-1" data-comment-id="2513" id="comment-2513">
<article class="comment-body" id="div-comment-2513">
<a class="screen-reader-text" href="#comment-content-2513">Skip to note 2 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-2513">
<p>When a plug-in is deactivated and then deleted, then the wp_options table might continue to hold data about this uninstalled widget. Here is a purge() class method that can be called during plug-in uninstall to clean-up the database.</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">const PLUGIN_SLUG			= 'My_Plugin';			// Short display name for this plug-in, not localized.

class My_Widget extends \WP_Widget 
{
	private const BASE_ID 			= 'my_widget';		// Unique, lowercase base ID within WordPress.
	
	/*
	 * Destroys subclass options (for plug-in uninstall).
	 */
	public static function purge()
	{
		// Purge all settings for this widget.
		if ( ! \delete_option( 'widget_' . self::BASE_ID ) )
			error_log( __FILE__.': "delete_option()" failed for '.self::BASE_ID );

		// Purge any occurrences of this widget from sidebars.
		$occurrences = get_option( 'sidebars_widgets' );
		if ( is_array( $occurrences ) )  {
			foreach ( $occurrences as $sidebar =&gt; $instances ) {
				if ( is_array( $instances ) ) foreach ( $instances as $key =&gt; $widget ) {
					if ( 1 == preg_match( '/^' . self::BASE_ID . '(?:-\\d+)?$/', $widget ) )
						// This instance matches the widget's naming pattern.
						unset( $occurrences[ $sidebar ][ $key ] );
				}

			}
			// Rewrite sidebars without occurrences of this widget.
			update_option( 'sidebars_widgets' , $occurrences );
		}
	}

// ... rest of widget code 
}

/**
 * "uninstall" Action Handler.
 * 
 * @see <a href="https://codex.wordpress.org/Function_Reference/register_uninstall_hook" rel="nofollow ugc">https://codex.wordpress.org/Function_Reference/register_uninstall_hook</a>
 */
function on_uninstall(): void 
{
	if ( ! \current_user_can( 'activate_plugins' ) ) {
		\wp_die( __( 'You do not have sufficient permissions to access this page.', PLUGIN_SLUG ), PLUGIN_SLUG );
	}

	if ( ! \delete_option( PLUGIN_SLUG ) )
		error_log( __FILE__.': "delete_option()" failed' );
	
	My_Widget::purge();
}

/**
 * "activate" Action Handler.
 *
 * @see <a href="https://codex.wordpress.org/Function_Reference/register_activation_hook" rel="nofollow ugc">https://codex.wordpress.org/Function_Reference/register_activation_hook</a>
 */
function on_activate(): void
{
	// Register an uninstall hook for clean-up purposes.
	\register_uninstall_hook( __FILE__,  __NAMESPACE__.'\on_uninstall' );
}

/*
 * API Registrations
 */
if ( \is_blog_admin() ) {
	// Back-End registrations
	\register_activation_hook( __FILE__,  __NAMESPACE__.'\on_activate' );
	\register_deactivation_hook( __FILE__,  __NAMESPACE__.'\on_deactivate' );

// ... add other action/filter hooks
}</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-2513">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
