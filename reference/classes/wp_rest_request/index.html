
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Untitled Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@3.3.5/dist/tailwind.min.css" rel="stylesheet">
    <style>
        body {
            background-color: white;
            color: black;
            font-family: 'Quicksand', 'Open Sans', 'Helvetica', 'Arial', san-serif;
        }
        a, h1, h2, h3, h4, h5, h6 {
            color: #0073aa;
        }
        .container {
            max-width: 800px;
            margin: auto;
            padding: 20px;
        }
        .has-small-font-size.is-link-to-top {
            position: absolute;
            bottom: 10px;
            right: 10px;
        }
        .entry-content {
            position:relative;
        }
        .entry-content img {
            max-width: 100%;
        }
    </style>
</head>
<body>
<div class='container'>
    
    <div class="page-metadata" data-published="" data-last-updated=""></div>
    
    <div aria-label="Breadcrumbs" class="wp-block-wporg-site-breadcrumbs has-small-font-size" role="navigation"><div class="wporg-site-breadcrumbs__wrapper"><span><a href="https://developer.wordpress.org">Home</a></span><span><a href="https://developer.wordpress.org/reference/">Reference</a></span><span><a href="https://developer.wordpress.org/reference/classes/">Classes</a></span><span class="is-current-page">WP_REST_Request</span></div></div>  <!-- Full breadcrumbs HTML -->
    <h1>WP_REST_Request</h1>
    <h1 class="wp-block-wporg-code-reference-title" style="margin-bottom:40px;"><span class="keyword">class</span> WP_REST_Request {}</h1>
    
    <div class="content"><div class="entry-content wp-block-post-content is-layout-flow wp-container-core-post-content-is-layout-1 wp-block-post-content-is-layout-flow">
<section class="wp-block-wporg-code-reference-summary"><p>Core class used to implement a REST request object.</p>
</section>
<section class="wp-block-wporg-code-reference-description"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="description" tabindex="-1"><a href="#description">Description</a></h2> <p>Contains data from the request, to be passed to the callback.</p>
<p>Note: This implements ArrayAccess, and acts as an array of parameters when used in that manner. It does not use ArrayObject (as we cannot rely on SPL), so be aware it may have non-array behavior in some cases.</p>
<p>Note: When using features provided by ArrayAccess, be aware that WordPress deliberately does not distinguish between arguments of the same name for different request methods.<br/>For instance, in a request with <code>GET id=1</code> and <code>POST id=2</code>, <code>$request['id']</code> will equal 2 (<code>POST</code>) not 1 (<code>GET</code>). For more precision between request methods, use <a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_body_params/" rel="method">WP_REST_Request::get_body_params()</a>, <a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_url_params/" rel="method">WP_REST_Request::get_url_params()</a>, etc.</p>
</section>
<section class="wp-block-wporg-code-reference-methods"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="methods" tabindex="-1"><a href="#methods">Methods</a></h2> <section class="wp-block-wporg-code-table" id="uses" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Name</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/__construct/">WP_REST_Request::__construct</a></td><td>Constructor.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/add_header/">WP_REST_Request::add_header</a></td><td>Appends a header value for the given header.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/canonicalize_header_name/">WP_REST_Request::canonicalize_header_name</a></td><td>Canonicalizes the header name.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/from_url/">WP_REST_Request::from_url</a></td><td>Retrieves a <a href="https://developer.notmatt.press/reference/classes/wp_rest_request/" rel="class">WP_REST_Request</a> object from a full URL.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_attributes/">WP_REST_Request::get_attributes</a></td><td>Retrieves the attributes for the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_body/">WP_REST_Request::get_body</a></td><td>Retrieves the request body content.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_body_params/">WP_REST_Request::get_body_params</a></td><td>Retrieves parameters from the body.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_content_type/">WP_REST_Request::get_content_type</a></td><td>Retrieves the Content-Type of the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_default_params/">WP_REST_Request::get_default_params</a></td><td>Retrieves the default parameters.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_file_params/">WP_REST_Request::get_file_params</a></td><td>Retrieves multipart file parameters from the body.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_header/">WP_REST_Request::get_header</a></td><td>Retrieves the given header from the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_header_as_array/">WP_REST_Request::get_header_as_array</a></td><td>Retrieves header values from the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_headers/">WP_REST_Request::get_headers</a></td><td>Retrieves all headers from the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_json_params/">WP_REST_Request::get_json_params</a></td><td>Retrieves the parameters from a JSON-formatted body.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_method/">WP_REST_Request::get_method</a></td><td>Retrieves the HTTP method for the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_param/">WP_REST_Request::get_param</a></td><td>Retrieves a parameter from the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_parameter_order/">WP_REST_Request::get_parameter_order</a></td><td>Retrieves the parameter priority order.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_params/">WP_REST_Request::get_params</a></td><td>Retrieves merged parameters from the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_query_params/">WP_REST_Request::get_query_params</a></td><td>Retrieves parameters from the query string.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_route/">WP_REST_Request::get_route</a></td><td>Retrieves the route that matched the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/get_url_params/">WP_REST_Request::get_url_params</a></td><td>Retrieves parameters from the route itself.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/has_param/">WP_REST_Request::has_param</a></td><td>Checks if a parameter exists in the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/has_valid_params/">WP_REST_Request::has_valid_params</a></td><td>Checks whether this request is valid according to its attributes.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/is_json_content_type/">WP_REST_Request::is_json_content_type</a></td><td>Checks if the request has specified a JSON Content-Type.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/offsetexists/">WP_REST_Request::offsetExists</a></td><td>–</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/offsetget/">WP_REST_Request::offsetGet</a></td><td>–</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/offsetset/">WP_REST_Request::offsetSet</a></td><td>–</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/offsetunset/">WP_REST_Request::offsetUnset</a></td><td>–</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/parse_body_params/">WP_REST_Request::parse_body_params</a></td><td>Parses the request body parameters.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/parse_json_params/">WP_REST_Request::parse_json_params</a></td><td>Parses the JSON parameters.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/remove_header/">WP_REST_Request::remove_header</a></td><td>Removes all values for a header.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/sanitize_params/">WP_REST_Request::sanitize_params</a></td><td>Sanitizes (where possible) the params on the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_attributes/">WP_REST_Request::set_attributes</a></td><td>Sets the attributes for the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_body/">WP_REST_Request::set_body</a></td><td>Sets body content.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_body_params/">WP_REST_Request::set_body_params</a></td><td>Sets parameters from the body.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_default_params/">WP_REST_Request::set_default_params</a></td><td>Sets default parameters.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_file_params/">WP_REST_Request::set_file_params</a></td><td>Sets multipart file parameters from the body.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_header/">WP_REST_Request::set_header</a></td><td>Sets the header on request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_headers/">WP_REST_Request::set_headers</a></td><td>Sets headers on the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_method/">WP_REST_Request::set_method</a></td><td>Sets HTTP method for the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_param/">WP_REST_Request::set_param</a></td><td>Sets a parameter on the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_query_params/">WP_REST_Request::set_query_params</a></td><td>Sets parameters from the query string.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_route/">WP_REST_Request::set_route</a></td><td>Sets the route that matched the request.</td></tr><tr class=""><td><a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_url_params/">WP_REST_Request::set_url_params</a></td><td>Sets parameters from the route.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-source"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="source" tabindex="-1"><a href="#source">Source</a></h2> <pre aria-label="Function source code" class="wp-block-code" data-start="30"><code class="language-php line-numbers" id="wporg-source-code" lang="php">class WP_REST_Request implements ArrayAccess {

	/**
	 * HTTP method.
	 *
	 * @since 4.4.0
	 * @var string
	 */
	protected $method = '';

	/**
	 * Parameters passed to the request.
	 *
	 * These typically come from the `$_GET`, `$_POST` and `$_FILES`
	 * superglobals when being created from the global scope.
	 *
	 * @since 4.4.0
	 * @var array Contains GET, POST and FILES keys mapping to arrays of data.
	 */
	protected $params;

	/**
	 * HTTP headers for the request.
	 *
	 * @since 4.4.0
	 * @var array Map of key to value. Key is always lowercase, as per HTTP specification.
	 */
	protected $headers = array();

	/**
	 * Body data.
	 *
	 * @since 4.4.0
	 * @var string Binary data from the request.
	 */
	protected $body = null;

	/**
	 * Route matched for the request.
	 *
	 * @since 4.4.0
	 * @var string
	 */
	protected $route;

	/**
	 * Attributes (options) for the route that was matched.
	 *
	 * This is the options array used when the route was registered, typically
	 * containing the callback as well as the valid methods for the route.
	 *
	 * @since 4.4.0
	 * @var array Attributes for the request.
	 */
	protected $attributes = array();

	/**
	 * Used to determine if the JSON data has been parsed yet.
	 *
	 * Allows lazy-parsing of JSON data where possible.
	 *
	 * @since 4.4.0
	 * @var bool
	 */
	protected $parsed_json = false;

	/**
	 * Used to determine if the body data has been parsed yet.
	 *
	 * @since 4.4.0
	 * @var bool
	 */
	protected $parsed_body = false;

	/**
	 * Constructor.
	 *
	 * @since 4.4.0
	 *
	 * @param string $method     Optional. Request method. Default empty.
	 * @param string $route      Optional. Request route. Default empty.
	 * @param array  $attributes Optional. Request attributes. Default empty array.
	 */
	public function __construct( $method = '', $route = '', $attributes = array() ) {
		$this-&gt;params = array(
			'URL'      =&gt; array(),
			'GET'      =&gt; array(),
			'POST'     =&gt; array(),
			'FILES'    =&gt; array(),

			// See parse_json_params.
			'JSON'     =&gt; null,

			'defaults' =&gt; array(),
		);

		$this-&gt;set_method( $method );
		$this-&gt;set_route( $route );
		$this-&gt;set_attributes( $attributes );
	}

	/**
	 * Retrieves the HTTP method for the request.
	 *
	 * @since 4.4.0
	 *
	 * @return string HTTP method.
	 */
	public function get_method() {
		return $this-&gt;method;
	}

	/**
	 * Sets HTTP method for the request.
	 *
	 * @since 4.4.0
	 *
	 * @param string $method HTTP method.
	 */
	public function set_method( $method ) {
		$this-&gt;method = strtoupper( $method );
	}

	/**
	 * Retrieves all headers from the request.
	 *
	 * @since 4.4.0
	 *
	 * @return array Map of key to value. Key is always lowercase, as per HTTP specification.
	 */
	public function get_headers() {
		return $this-&gt;headers;
	}

	/**
	 * Canonicalizes the header name.
	 *
	 * Ensures that header names are always treated the same regardless of
	 * source. Header names are always case-insensitive.
	 *
	 * Note that we treat `-` (dashes) and `_` (underscores) as the same
	 * character, as per header parsing rules in both Apache and nginx.
	 *
	 * @link https://stackoverflow.com/q/18185366
	 * @link https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/#missing-disappearing-http-headers
	 * @link https://nginx.org/en/docs/http/ngx_http_core_module.html#underscores_in_headers
	 *
	 * @since 4.4.0
	 *
	 * @param string $key Header name.
	 * @return string Canonicalized name.
	 */
	public static function canonicalize_header_name( $key ) {
		$key = strtolower( $key );
		$key = str_replace( '-', '_', $key );

		return $key;
	}

	/**
	 * Retrieves the given header from the request.
	 *
	 * If the header has multiple values, they will be concatenated with a comma
	 * as per the HTTP specification. Be aware that some non-compliant headers
	 * (notably cookie headers) cannot be joined this way.
	 *
	 * @since 4.4.0
	 *
	 * @param string $key Header name, will be canonicalized to lowercase.
	 * @return string|null String value if set, null otherwise.
	 */
	public function get_header( $key ) {
		$key = $this-&gt;canonicalize_header_name( $key );

		if ( ! isset( $this-&gt;headers[ $key ] ) ) {
			return null;
		}

		return implode( ',', $this-&gt;headers[ $key ] );
	}

	/**
	 * Retrieves header values from the request.
	 *
	 * @since 4.4.0
	 *
	 * @param string $key Header name, will be canonicalized to lowercase.
	 * @return array|null List of string values if set, null otherwise.
	 */
	public function get_header_as_array( $key ) {
		$key = $this-&gt;canonicalize_header_name( $key );

		if ( ! isset( $this-&gt;headers[ $key ] ) ) {
			return null;
		}

		return $this-&gt;headers[ $key ];
	}

	/**
	 * Sets the header on request.
	 *
	 * @since 4.4.0
	 *
	 * @param string $key   Header name.
	 * @param string $value Header value, or list of values.
	 */
	public function set_header( $key, $value ) {
		$key   = $this-&gt;canonicalize_header_name( $key );
		$value = (array) $value;

		$this-&gt;headers[ $key ] = $value;
	}

	/**
	 * Appends a header value for the given header.
	 *
	 * @since 4.4.0
	 *
	 * @param string $key   Header name.
	 * @param string $value Header value, or list of values.
	 */
	public function add_header( $key, $value ) {
		$key   = $this-&gt;canonicalize_header_name( $key );
		$value = (array) $value;

		if ( ! isset( $this-&gt;headers[ $key ] ) ) {
			$this-&gt;headers[ $key ] = array();
		}

		$this-&gt;headers[ $key ] = array_merge( $this-&gt;headers[ $key ], $value );
	}

	/**
	 * Removes all values for a header.
	 *
	 * @since 4.4.0
	 *
	 * @param string $key Header name.
	 */
	public function remove_header( $key ) {
		$key = $this-&gt;canonicalize_header_name( $key );
		unset( $this-&gt;headers[ $key ] );
	}

	/**
	 * Sets headers on the request.
	 *
	 * @since 4.4.0
	 *
	 * @param array $headers  Map of header name to value.
	 * @param bool  $override If true, replace the request's headers. Otherwise, merge with existing.
	 */
	public function set_headers( $headers, $override = true ) {
		if ( true === $override ) {
			$this-&gt;headers = array();
		}

		foreach ( $headers as $key =&gt; $value ) {
			$this-&gt;set_header( $key, $value );
		}
	}

	/**
	 * Retrieves the Content-Type of the request.
	 *
	 * @since 4.4.0
	 *
	 * @return array|null Map containing 'value' and 'parameters' keys
	 *                    or null when no valid Content-Type header was
	 *                    available.
	 */
	public function get_content_type() {
		$value = $this-&gt;get_header( 'Content-Type' );
		if ( empty( $value ) ) {
			return null;
		}

		$parameters = '';
		if ( strpos( $value, ';' ) ) {
			list( $value, $parameters ) = explode( ';', $value, 2 );
		}

		$value = strtolower( $value );
		if ( ! str_contains( $value, '/' ) ) {
			return null;
		}

		// Parse type and subtype out.
		list( $type, $subtype ) = explode( '/', $value, 2 );

		$data = compact( 'value', 'type', 'subtype', 'parameters' );
		$data = array_map( 'trim', $data );

		return $data;
	}

	/**
	 * Checks if the request has specified a JSON Content-Type.
	 *
	 * @since 5.6.0
	 *
	 * @return bool True if the Content-Type header is JSON.
	 */
	public function is_json_content_type() {
		$content_type = $this-&gt;get_content_type();

		return isset( $content_type['value'] ) &amp;&amp; wp_is_json_media_type( $content_type['value'] );
	}

	/**
	 * Retrieves the parameter priority order.
	 *
	 * Used when checking parameters in WP_REST_Request::get_param().
	 *
	 * @since 4.4.0
	 *
	 * @return string[] Array of types to check, in order of priority.
	 */
	protected function get_parameter_order() {
		$order = array();

		if ( $this-&gt;is_json_content_type() ) {
			$order[] = 'JSON';
		}

		$this-&gt;parse_json_params();

		// Ensure we parse the body data.
		$body = $this-&gt;get_body();

		if ( 'POST' !== $this-&gt;method &amp;&amp; ! empty( $body ) ) {
			$this-&gt;parse_body_params();
		}

		$accepts_body_data = array( 'POST', 'PUT', 'PATCH', 'DELETE' );
		if ( in_array( $this-&gt;method, $accepts_body_data, true ) ) {
			$order[] = 'POST';
		}

		$order[] = 'GET';
		$order[] = 'URL';
		$order[] = 'defaults';

		/**
		 * Filters the parameter priority order for a REST API request.
		 *
		 * The order affects which parameters are checked when using WP_REST_Request::get_param()
		 * and family. This acts similarly to PHP's `request_order` setting.
		 *
		 * @since 4.4.0
		 *
		 * @param string[]        $order   Array of types to check, in order of priority.
		 * @param WP_REST_Request $request The request object.
		 */
		return apply_filters( 'rest_request_parameter_order', $order, $this );
	}

	/**
	 * Retrieves a parameter from the request.
	 *
	 * @since 4.4.0
	 *
	 * @param string $key Parameter name.
	 * @return mixed|null Value if set, null otherwise.
	 */
	public function get_param( $key ) {
		$order = $this-&gt;get_parameter_order();

		foreach ( $order as $type ) {
			// Determine if we have the parameter for this type.
			if ( isset( $this-&gt;params[ $type ][ $key ] ) ) {
				return $this-&gt;params[ $type ][ $key ];
			}
		}

		return null;
	}

	/**
	 * Checks if a parameter exists in the request.
	 *
	 * This allows distinguishing between an omitted parameter,
	 * and a parameter specifically set to null.
	 *
	 * @since 5.3.0
	 *
	 * @param string $key Parameter name.
	 * @return bool True if a param exists for the given key.
	 */
	public function has_param( $key ) {
		$order = $this-&gt;get_parameter_order();

		foreach ( $order as $type ) {
			if ( is_array( $this-&gt;params[ $type ] ) &amp;&amp; array_key_exists( $key, $this-&gt;params[ $type ] ) ) {
				return true;
			}
		}

		return false;
	}

	/**
	 * Sets a parameter on the request.
	 *
	 * If the given parameter key exists in any parameter type an update will take place,
	 * otherwise a new param will be created in the first parameter type (respecting
	 * get_parameter_order()).
	 *
	 * @since 4.4.0
	 *
	 * @param string $key   Parameter name.
	 * @param mixed  $value Parameter value.
	 */
	public function set_param( $key, $value ) {
		$order     = $this-&gt;get_parameter_order();
		$found_key = false;

		foreach ( $order as $type ) {
			if ( 'defaults' !== $type &amp;&amp; is_array( $this-&gt;params[ $type ] ) &amp;&amp; array_key_exists( $key, $this-&gt;params[ $type ] ) ) {
				$this-&gt;params[ $type ][ $key ] = $value;
				$found_key                     = true;
			}
		}

		if ( ! $found_key ) {
			$this-&gt;params[ $order[0] ][ $key ] = $value;
		}
	}

	/**
	 * Retrieves merged parameters from the request.
	 *
	 * The equivalent of get_param(), but returns all parameters for the request.
	 * Handles merging all the available values into a single array.
	 *
	 * @since 4.4.0
	 *
	 * @return array Map of key to value.
	 */
	public function get_params() {
		$order = $this-&gt;get_parameter_order();
		$order = array_reverse( $order, true );

		$params = array();
		foreach ( $order as $type ) {
			/*
			 * array_merge() / the "+" operator will mess up
			 * numeric keys, so instead do a manual foreach.
			 */
			foreach ( (array) $this-&gt;params[ $type ] as $key =&gt; $value ) {
				$params[ $key ] = $value;
			}
		}

		return $params;
	}

	/**
	 * Retrieves parameters from the route itself.
	 *
	 * These are parsed from the URL using the regex.
	 *
	 * @since 4.4.0
	 *
	 * @return array Parameter map of key to value.
	 */
	public function get_url_params() {
		return $this-&gt;params['URL'];
	}

	/**
	 * Sets parameters from the route.
	 *
	 * Typically, this is set after parsing the URL.
	 *
	 * @since 4.4.0
	 *
	 * @param array $params Parameter map of key to value.
	 */
	public function set_url_params( $params ) {
		$this-&gt;params['URL'] = $params;
	}

	/**
	 * Retrieves parameters from the query string.
	 *
	 * These are the parameters you'd typically find in `$_GET`.
	 *
	 * @since 4.4.0
	 *
	 * @return array Parameter map of key to value
	 */
	public function get_query_params() {
		return $this-&gt;params['GET'];
	}

	/**
	 * Sets parameters from the query string.
	 *
	 * Typically, this is set from `$_GET`.
	 *
	 * @since 4.4.0
	 *
	 * @param array $params Parameter map of key to value.
	 */
	public function set_query_params( $params ) {
		$this-&gt;params['GET'] = $params;
	}

	/**
	 * Retrieves parameters from the body.
	 *
	 * These are the parameters you'd typically find in `$_POST`.
	 *
	 * @since 4.4.0
	 *
	 * @return array Parameter map of key to value.
	 */
	public function get_body_params() {
		return $this-&gt;params['POST'];
	}

	/**
	 * Sets parameters from the body.
	 *
	 * Typically, this is set from `$_POST`.
	 *
	 * @since 4.4.0
	 *
	 * @param array $params Parameter map of key to value.
	 */
	public function set_body_params( $params ) {
		$this-&gt;params['POST'] = $params;
	}

	/**
	 * Retrieves multipart file parameters from the body.
	 *
	 * These are the parameters you'd typically find in `$_FILES`.
	 *
	 * @since 4.4.0
	 *
	 * @return array Parameter map of key to value
	 */
	public function get_file_params() {
		return $this-&gt;params['FILES'];
	}

	/**
	 * Sets multipart file parameters from the body.
	 *
	 * Typically, this is set from `$_FILES`.
	 *
	 * @since 4.4.0
	 *
	 * @param array $params Parameter map of key to value.
	 */
	public function set_file_params( $params ) {
		$this-&gt;params['FILES'] = $params;
	}

	/**
	 * Retrieves the default parameters.
	 *
	 * These are the parameters set in the route registration.
	 *
	 * @since 4.4.0
	 *
	 * @return array Parameter map of key to value
	 */
	public function get_default_params() {
		return $this-&gt;params['defaults'];
	}

	/**
	 * Sets default parameters.
	 *
	 * These are the parameters set in the route registration.
	 *
	 * @since 4.4.0
	 *
	 * @param array $params Parameter map of key to value.
	 */
	public function set_default_params( $params ) {
		$this-&gt;params['defaults'] = $params;
	}

	/**
	 * Retrieves the request body content.
	 *
	 * @since 4.4.0
	 *
	 * @return string Binary data from the request body.
	 */
	public function get_body() {
		return $this-&gt;body;
	}

	/**
	 * Sets body content.
	 *
	 * @since 4.4.0
	 *
	 * @param string $data Binary data from the request body.
	 */
	public function set_body( $data ) {
		$this-&gt;body = $data;

		// Enable lazy parsing.
		$this-&gt;parsed_json    = false;
		$this-&gt;parsed_body    = false;
		$this-&gt;params['JSON'] = null;
	}

	/**
	 * Retrieves the parameters from a JSON-formatted body.
	 *
	 * @since 4.4.0
	 *
	 * @return array Parameter map of key to value.
	 */
	public function get_json_params() {
		// Ensure the parameters have been parsed out.
		$this-&gt;parse_json_params();

		return $this-&gt;params['JSON'];
	}

	/**
	 * Parses the JSON parameters.
	 *
	 * Avoids parsing the JSON data until we need to access it.
	 *
	 * @since 4.4.0
	 * @since 4.7.0 Returns error instance if value cannot be decoded.
	 * @return true|WP_Error True if the JSON data was passed or no JSON data was provided, WP_Error if invalid JSON was passed.
	 */
	protected function parse_json_params() {
		if ( $this-&gt;parsed_json ) {
			return true;
		}

		$this-&gt;parsed_json = true;

		// Check that we actually got JSON.
		if ( ! $this-&gt;is_json_content_type() ) {
			return true;
		}

		$body = $this-&gt;get_body();
		if ( empty( $body ) ) {
			return true;
		}

		$params = json_decode( $body, true );

		/*
		 * Check for a parsing error.
		 */
		if ( null === $params &amp;&amp; JSON_ERROR_NONE !== json_last_error() ) {
			// Ensure subsequent calls receive error instance.
			$this-&gt;parsed_json = false;

			$error_data = array(
				'status'             =&gt; WP_Http::BAD_REQUEST,
				'json_error_code'    =&gt; json_last_error(),
				'json_error_message' =&gt; json_last_error_msg(),
			);

			return new WP_Error( 'rest_invalid_json', __( 'Invalid JSON body passed.' ), $error_data );
		}

		$this-&gt;params['JSON'] = $params;

		return true;
	}

	/**
	 * Parses the request body parameters.
	 *
	 * Parses out URL-encoded bodies for request methods that aren't supported
	 * natively by PHP.
	 *
	 * @since 4.4.0
	 */
	protected function parse_body_params() {
		if ( $this-&gt;parsed_body ) {
			return;
		}

		$this-&gt;parsed_body = true;

		/*
		 * Check that we got URL-encoded. Treat a missing Content-Type as
		 * URL-encoded for maximum compatibility.
		 */
		$content_type = $this-&gt;get_content_type();

		if ( ! empty( $content_type ) &amp;&amp; 'application/x-www-form-urlencoded' !== $content_type['value'] ) {
			return;
		}

		parse_str( $this-&gt;get_body(), $params );

		/*
		 * Add to the POST parameters stored internally. If a user has already
		 * set these manually (via `set_body_params`), don't override them.
		 */
		$this-&gt;params['POST'] = array_merge( $params, $this-&gt;params['POST'] );
	}

	/**
	 * Retrieves the route that matched the request.
	 *
	 * @since 4.4.0
	 *
	 * @return string Route matching regex.
	 */
	public function get_route() {
		return $this-&gt;route;
	}

	/**
	 * Sets the route that matched the request.
	 *
	 * @since 4.4.0
	 *
	 * @param string $route Route matching regex.
	 */
	public function set_route( $route ) {
		$this-&gt;route = $route;
	}

	/**
	 * Retrieves the attributes for the request.
	 *
	 * These are the options for the route that was matched.
	 *
	 * @since 4.4.0
	 *
	 * @return array Attributes for the request.
	 */
	public function get_attributes() {
		return $this-&gt;attributes;
	}

	/**
	 * Sets the attributes for the request.
	 *
	 * @since 4.4.0
	 *
	 * @param array $attributes Attributes for the request.
	 */
	public function set_attributes( $attributes ) {
		$this-&gt;attributes = $attributes;
	}

	/**
	 * Sanitizes (where possible) the params on the request.
	 *
	 * This is primarily based off the sanitize_callback param on each registered
	 * argument.
	 *
	 * @since 4.4.0
	 *
	 * @return true|WP_Error True if parameters were sanitized, WP_Error if an error occurred during sanitization.
	 */
	public function sanitize_params() {
		$attributes = $this-&gt;get_attributes();

		// No arguments set, skip sanitizing.
		if ( empty( $attributes['args'] ) ) {
			return true;
		}

		$order = $this-&gt;get_parameter_order();

		$invalid_params  = array();
		$invalid_details = array();

		foreach ( $order as $type ) {
			if ( empty( $this-&gt;params[ $type ] ) ) {
				continue;
			}

			foreach ( $this-&gt;params[ $type ] as $key =&gt; $value ) {
				if ( ! isset( $attributes['args'][ $key ] ) ) {
					continue;
				}

				$param_args = $attributes['args'][ $key ];

				// If the arg has a type but no sanitize_callback attribute, default to rest_parse_request_arg.
				if ( ! array_key_exists( 'sanitize_callback', $param_args ) &amp;&amp; ! empty( $param_args['type'] ) ) {
					$param_args['sanitize_callback'] = 'rest_parse_request_arg';
				}
				// If there's still no sanitize_callback, nothing to do here.
				if ( empty( $param_args['sanitize_callback'] ) ) {
					continue;
				}

				/** @var mixed|WP_Error $sanitized_value */
				$sanitized_value = call_user_func( $param_args['sanitize_callback'], $value, $this, $key );

				if ( is_wp_error( $sanitized_value ) ) {
					$invalid_params[ $key ]  = implode( ' ', $sanitized_value-&gt;get_error_messages() );
					$invalid_details[ $key ] = rest_convert_error_to_response( $sanitized_value )-&gt;get_data();
				} else {
					$this-&gt;params[ $type ][ $key ] = $sanitized_value;
				}
			}
		}

		if ( $invalid_params ) {
			return new WP_Error(
				'rest_invalid_param',
				/* translators: %s: List of invalid parameters. */
				sprintf( __( 'Invalid parameter(s): %s' ), implode( ', ', array_keys( $invalid_params ) ) ),
				array(
					'status'  =&gt; 400,
					'params'  =&gt; $invalid_params,
					'details' =&gt; $invalid_details,
				)
			);
		}

		return true;
	}

	/**
	 * Checks whether this request is valid according to its attributes.
	 *
	 * @since 4.4.0
	 *
	 * @return true|WP_Error True if there are no parameters to validate or if all pass validation,
	 *                       WP_Error if required parameters are missing.
	 */
	public function has_valid_params() {
		// If JSON data was passed, check for errors.
		$json_error = $this-&gt;parse_json_params();
		if ( is_wp_error( $json_error ) ) {
			return $json_error;
		}

		$attributes = $this-&gt;get_attributes();
		$required   = array();

		$args = empty( $attributes['args'] ) ? array() : $attributes['args'];

		foreach ( $args as $key =&gt; $arg ) {
			$param = $this-&gt;get_param( $key );
			if ( isset( $arg['required'] ) &amp;&amp; true === $arg['required'] &amp;&amp; null === $param ) {
				$required[] = $key;
			}
		}

		if ( ! empty( $required ) ) {
			return new WP_Error(
				'rest_missing_callback_param',
				/* translators: %s: List of required parameters. */
				sprintf( __( 'Missing parameter(s): %s' ), implode( ', ', $required ) ),
				array(
					'status' =&gt; 400,
					'params' =&gt; $required,
				)
			);
		}

		/*
		 * Check the validation callbacks for each registered arg.
		 *
		 * This is done after required checking as required checking is cheaper.
		 */
		$invalid_params  = array();
		$invalid_details = array();

		foreach ( $args as $key =&gt; $arg ) {

			$param = $this-&gt;get_param( $key );

			if ( null !== $param &amp;&amp; ! empty( $arg['validate_callback'] ) ) {
				/** @var bool|\WP_Error $valid_check */
				$valid_check = call_user_func( $arg['validate_callback'], $param, $this, $key );

				if ( false === $valid_check ) {
					$invalid_params[ $key ] = __( 'Invalid parameter.' );
				}

				if ( is_wp_error( $valid_check ) ) {
					$invalid_params[ $key ]  = implode( ' ', $valid_check-&gt;get_error_messages() );
					$invalid_details[ $key ] = rest_convert_error_to_response( $valid_check )-&gt;get_data();
				}
			}
		}

		if ( $invalid_params ) {
			return new WP_Error(
				'rest_invalid_param',
				/* translators: %s: List of invalid parameters. */
				sprintf( __( 'Invalid parameter(s): %s' ), implode( ', ', array_keys( $invalid_params ) ) ),
				array(
					'status'  =&gt; 400,
					'params'  =&gt; $invalid_params,
					'details' =&gt; $invalid_details,
				)
			);
		}

		if ( isset( $attributes['validate_callback'] ) ) {
			$valid_check = call_user_func( $attributes['validate_callback'], $this );

			if ( is_wp_error( $valid_check ) ) {
				return $valid_check;
			}

			if ( false === $valid_check ) {
				// A WP_Error instance is preferred, but false is supported for parity with the per-arg validate_callback.
				return new WP_Error( 'rest_invalid_params', __( 'Invalid parameters.' ), array( 'status' =&gt; 400 ) );
			}
		}

		return true;
	}

	/**
	 * Checks if a parameter is set.
	 *
	 * @since 4.4.0
	 *
	 * @param string $offset Parameter name.
	 * @return bool Whether the parameter is set.
	 */
	#[ReturnTypeWillChange]
	public function offsetExists( $offset ) {
		$order = $this-&gt;get_parameter_order();

		foreach ( $order as $type ) {
			if ( isset( $this-&gt;params[ $type ][ $offset ] ) ) {
				return true;
			}
		}

		return false;
	}

	/**
	 * Retrieves a parameter from the request.
	 *
	 * @since 4.4.0
	 *
	 * @param string $offset Parameter name.
	 * @return mixed|null Value if set, null otherwise.
	 */
	#[ReturnTypeWillChange]
	public function offsetGet( $offset ) {
		return $this-&gt;get_param( $offset );
	}

	/**
	 * Sets a parameter on the request.
	 *
	 * @since 4.4.0
	 *
	 * @param string $offset Parameter name.
	 * @param mixed  $value  Parameter value.
	 */
	#[ReturnTypeWillChange]
	public function offsetSet( $offset, $value ) {
		$this-&gt;set_param( $offset, $value );
	}

	/**
	 * Removes a parameter from the request.
	 *
	 * @since 4.4.0
	 *
	 * @param string $offset Parameter name.
	 */
	#[ReturnTypeWillChange]
	public function offsetUnset( $offset ) {
		$order = $this-&gt;get_parameter_order();

		// Remove the offset from every group.
		foreach ( $order as $type ) {
			unset( $this-&gt;params[ $type ][ $offset ] );
		}
	}

	/**
	 * Retrieves a WP_REST_Request object from a full URL.
	 *
	 * @since 4.5.0
	 *
	 * @param string $url URL with protocol, domain, path and query args.
	 * @return WP_REST_Request|false WP_REST_Request object on success, false on failure.
	 */
	public static function from_url( $url ) {
		$bits         = parse_url( $url );
		$query_params = array();

		if ( ! empty( $bits['query'] ) ) {
			wp_parse_str( $bits['query'], $query_params );
		}

		$api_root = rest_url();
		if ( get_option( 'permalink_structure' ) &amp;&amp; str_starts_with( $url, $api_root ) ) {
			// Pretty permalinks on, and URL is under the API root.
			$api_url_part = substr( $url, strlen( untrailingslashit( $api_root ) ) );
			$route        = parse_url( $api_url_part, PHP_URL_PATH );
		} elseif ( ! empty( $query_params['rest_route'] ) ) {
			// ?rest_route=... set directly.
			$route = $query_params['rest_route'];
			unset( $query_params['rest_route'] );
		}

		$request = false;
		if ( ! empty( $route ) ) {
			$request = new WP_REST_Request( 'GET', $route );
			$request-&gt;set_query_params( $query_params );
		}

		/**
		 * Filters the REST API request generated from a URL.
		 *
		 * @since 4.5.0
		 *
		 * @param WP_REST_Request|false $request Generated request object, or false if URL
		 *                                       could not be parsed.
		 * @param string                $url     URL the request was generated from.
		 */
		return apply_filters( 'rest_request_from_url', $request, $url );
	}
}
</code></pre><p class="wporg-dot-link-list"><a href="https://developer.notmatt.press/reference/files/wp-includes/rest-api/class-wp-rest-request.php/">View all references</a> <a href="https://core.trac.wordpress.org/browser/tags/6.7/src/wp-includes/rest-api/class-wp-rest-request.php#L30">View on Trac</a> <a href="https://github.com/WordPress/wordpress-develop/blob/6.7/src/wp-includes/rest-api/class-wp-rest-request.php#L30-L1063">View on GitHub</a></p></section>
<section class="wp-block-wporg-code-reference-changelog"><h2 class="is-toc-heading wp-block-heading has-heading-5-font-size" id="changelog" tabindex="-1"><a href="#changelog">Changelog</a></h2> <section class="wp-block-wporg-code-table" style="margin-top:var(--wp--preset--spacing--20);"><figure class="wp-block-table"><table><thead><tr><th scope="col">Version</th><th scope="col">Description</th></tr></thead><tbody><tr class=""><td><a href="https://developer.notmatt.press/reference/since/4.4.0/">4.4.0</a></td><td>Introduced.</td></tr></tbody></table></figure></section> </section>
<section class="wp-block-wporg-code-reference-comments" data-nosnippet="true"><h2 class="is-toc-heading wp-block-heading" id="user-contributed-notes" tabindex="-1"><a href="#user-contributed-notes">User Contributed Notes</a></h2> <ol class="comment-list"> <li class="comment byuser comment-author-naveen17797 odd alt thread-odd thread-alt depth-1" data-comment-id="3535" id="comment-3535">
<article class="comment-body" id="div-comment-3535">
<a class="screen-reader-text" href="#comment-content-3535">Skip to note 6 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-3535">
<p>If you want to supply json data to request manually (since your js client might do the same, you can emulate the same behaviour in your test ), you can do it like this way.</p>
<pre class="wp-block-code"><code class="language-php" lang="php">$request   = new WP_REST_Request( 'POST', 'your route here' );
		$request-&gt;set_header( 'content-type', 'application/json' );
		$request-&gt;set_body( $json_data );</code></pre>
<p>and get the data by</p>
<pre class="wp-block-code"><code class="language-php" lang="php">$request-&gt;get_params();</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-3535">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-rmccue even thread-even depth-1" data-comment-id="1888" id="comment-1888">
<article class="comment-body" id="div-comment-1888">
<a class="screen-reader-text" href="#comment-content-1888">Skip to note 7 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-1888">
<p>Request objects can be created in one of two ways: manually, or from a URL.</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">// Manual creation:
$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );

// From a URL (if your site is at <a href="http://example.com/" rel="nofollow ugc">http://example.com/</a>):
$request = WP_REST_Request::from_url( 'http://example.com/wp-json/wp/v2/posts' );
// GET by default; to change the method, you can then run:
$request-&gt;set_method( 'POST' );</code></pre>
<p>The <code>from_url</code> method is a convenience method to create the object for you, and is recommended when you have the full URL for an endpoint. The constructor is recommended in all other cases.</p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-1888">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-luisherranz odd alt thread-odd thread-alt depth-1" data-comment-id="2264" id="comment-2264">
<article class="comment-body" id="div-comment-2264">
<a class="screen-reader-text" href="#comment-content-2264">Skip to note 8 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-2264">
<p>You can add params using the <code>set_query_params</code> method:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
$request-&gt;set_query_params(array(
  'categories' =&gt; 10,
  'per_page' =&gt; 30
));</code></pre>
<p>More info here: <a href="https://developer.notmatt.press/reference/classes/wp_rest_request/set_query_params/" rel="ugc">https://developer.notmatt.press/reference/classes/wp_rest_request/set_query_params/</a></p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-2264">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-jasonny even thread-even depth-1" data-comment-id="6480" id="comment-6480">
<article class="comment-body" id="div-comment-6480">
<a class="screen-reader-text" href="#comment-content-6480">Skip to note 9 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-6480">
<p>To send data with a <code>POST</code>, use <code>set_body_params()</code> for the body values:</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">$data = array(
   'foo' =&gt; 1,
   'bar' =&gt; 2,
);

$request = new WP_REST_Request( 'POST', '/wpdocs/v1/post_endpoint' );
$request-&gt;set_body_params( $data );
$response = rest_do_request( $request );</code></pre>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-6480">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
<li class="comment byuser comment-author-ionurboz odd alt thread-odd thread-alt depth-1" data-comment-id="4712" id="comment-4712">
<article class="comment-body" id="div-comment-4712">
<a class="screen-reader-text" href="#comment-content-4712">Skip to note 10 content</a>

<!-- .comment-metadata -->
<div class="wporg-has-embedded-code comment-content" id="comment-content-4712">
<p>A complete request and response code</p>
<pre class="wp-block-code"><code class="language-php line-numbers" lang="php">$request = new WP_REST_Request( 'GET', '/wp/v2/posts' );
$response = rest_do_request( $request );
 
if ( $response-&gt;is_error() ) {
    // Convert to a WP_Error object.
    $error = $response-&gt;as_error();
    $message = $error-&gt;get_error_message();
    $error_data = $error-&gt;get_error_data();
    $status = isset( $error_data['status'] ) ? $error_data['status'] : 500;
    wp_die( sprintf( 'An error occurred: %s (%d)', $message, $error_data ) );
}
 
$data = $response-&gt;get_data();
$headers = $response-&gt;get_headers();
echo "&lt;p&gt;Success! Here's the data:&lt;/p&gt;";
var_dump( $data );</code></pre>
<p><em>Comment edited by <a href="https://profiles.wordpress.org/audrasjb/" rel="nofollow ugc">@audrasjb</a> on November 18, 2022, to address an issue in the code snippet, reported by <a href="https://profiles.wordpress.org/leprincenoir/" rel="nofollow ugc">@leprincenoir</a>.</em></p>
</div><!-- .comment-content -->
<section class="wporg-has-embedded-code feedback hide-if-js" data-comment-count="0" id="feedback-4712">
</section><!-- .feedback -->

</article><!-- .comment-body -->
</li>
</ol></section>
</div></div>
    </div>
<footer class="text-center mt-10 py-5">
    <p class="text-sm"><a href="https://notmatt.press">NotMattPress</a>.</p>
</footer>
</body>
</html>
